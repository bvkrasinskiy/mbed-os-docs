<!DOCTYPE html>
<html>
    
<!-- Mirrored from os.mbed.com/docs/mbed-os/v6.16/debug-test/utest-asynchronous-c-test-harness.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 16 Sep 2024 14:16:32 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
        
        <meta charset="utf-8"/>
        <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
        
        
        <title>utest: asynchronous C++ test harness - Debugging and testing | Mbed OS 6 Documentation</title>
        <link href="../static/css/vendor/foundation-6.2.4.min.mbed-cache-4c48f6c816971070eb1e4eca75f0ec30.css" rel="stylesheet"/>
        <link href="../static/css/vendor/font-awesome-4.7.0/css/font-awesome.min.mbed-cache-269550530cc127b6aa5a35925a7de6ce.css" rel="stylesheet"/>
        <link href="../static/css/app.mbed-cache-23ac288f803d41065f3596e4c6b08e94.css" rel="stylesheet"/>
    
        

<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','../../../../../www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-1447836-8');
ga('require', 'GTM-WXMLD4S')
</script>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'../../../../../www.googletagmanager.com/gtm5445.html?id='+i+dl+'&gtm_auth=SMYNPwM0ICsV00c1ZHETqQ&gtm_preview=env-2&gtm_cookies_win=x';f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-M6FZ495');</script>


    <script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:971746,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>



<!-- Favicons -->
<link rel="apple-touch-icon" sizes="57x57" href="../../../../static/img/favicons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../../../static/img/favicons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../../../static/img/favicons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../../../static/img/favicons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../../../static/img/favicons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../../../static/img/favicons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../../../../static/img/favicons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../../../../static/img/favicons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../../../../static/img/favicons/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="../../../../static/img/favicons/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../../../static/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="../../../../static/img/favicons/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../../../static/img/favicons/favicon-16x16.png">
<link rel="manifest" href="https://os.mbed.com/static/img/favicons/manifest.json">
<link rel="shortcut icon" href="https://os.mbed.com/static/img/favicon.ico?">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/static/img/favicons/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,700">

<link rel="stylesheet" href="../../../../static/CACHE/css/output.811e2930ab34.css" type="text/css">

<link href="../../../../static/docs/css/doc_viewer.css" rel="stylesheet">
<link href="../../../../static/fonts.css" rel="stylesheet">
<link href="../../../../static/docs-nav-and-footer1b26.css?v2" rel="stylesheet">


<link rel="canonical" href="utest-asynchronous-c-test-harness.html">
<script src="../../../../static/mbed-nav-vertical-menu.js"></script>


    </head>
    <body>
        








<div class="mbed-nav">
    <div class="mbed-nav__mobile-menu-control">
        <i class="mbed-nav__mobile-menu-control-open fas fa-bars fa-fw"></i>
        <i class="mbed-nav__mobile-menu-control-close fas fa-times is-hidden fa-fw"></i>
        <i class="mbed-nav__mobile-menu-control-back fas fa-angle-left is-hidden fa-fw"></i>
    </div>
    <div class="mbed-nav__logo">
        <a href="https://os.mbed.com/">
            <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#logo"></use></svg>
        </a>
    </div>
    <div class="mbed-nav__menu">

        <!-- Main menu -->
        <nav class="mbed-nav__main-menu">
            <ul class="mbed-nav__dropdown-menu">
                <li class="has-dropdown">
                    Overview

                    <div class="mbed-nav__dropdown-menu-content">

                        <!-- Overview dropdown menu -->
                        <div class="mbed-nav__overview-menu">
                            <section>
                                <p>Operating system</p>
                                <ul>
                                    <li>
                                        <a href="https://os.mbed.com/mbed-os/" class="mbed-nav__icon-link-detail">
                                            <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#mbed_os"></use></svg>
                                            <div>
                                                <p>Mbed OS</p>
                                                <p>The open source OS for Cortex-M devices</p>
                                            </div>
                                        </a>
                                    </li>
                                </ul>
                            </section>

                            <section>
                                <p>Development tools</p>
                                <ul>
                                    <li>
                                        <a href="https://www.keil.arm.com/mbed/?utm_source=mbed_com&amp;utm_medium=compiler_button&amp;utm_campaign=mbed_com_promo" class="mbed-nav__icon-link-detail">
                                             <svg><use href="https://os.mbed.com/static/img/keil_studio_icon.2c56c28014c6.svg?#keil_studio_icon"></use></svg>
                                            <div>
                                                <p>Keil Studio Cloud</p>
                                                <p>Arm's IDE for IoT, embedded and Mbed development</p>
                                            </div>
                                         </a>
                                     </li>
                                    <li>
                                        <a href="https://os.mbed.com/studio/" class="mbed-nav__icon-link-detail">
                                            <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#mbed_studio"></use></svg>
                                            <div>
                                                <p>Mbed Studio</p>
                                                <p>Download the desktop IDE for Mbed OS</p>
                                            </div>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="https://os.mbed.com/docs/mbed-os/latest/quick-start/offline-with-mbed-cli.html" class="mbed-nav__icon-link-detail">

                                            <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#mbed_cli"></use></svg>
                                            <div>
                                               <p>Mbed CLI</p>
                                               <p>Command line access to Mbed tools and services</p>
                                            </div>
                                        </a>
                                    </li>
                                </ul>
                            </section>

                            <section>
                                <p>Security and Connectivity</p>
                                <ul>
                                    <li>
                                        <a href="https://tls.mbed.org/" class="mbed-nav__icon-link-detail">
                                            <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#mbed_tls_crypto"></use></svg>
                                            <div>
                                                <p>Mbed TLS and Mbed Crypto</p>
                                                <p>Industry standard TLS stack and crypto library</p>
                                            </div>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="https://os.mbed.com/connectivity-technologies/" class="mbed-nav__icon-link-detail">
                                            <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#connectivity"></use></svg>
                                            <div>
                                                <p>Connectivity</p>
                                                <p>BLE, WiFi, Cellular, LoRaWAN and more</p>
                                            </div>
                                        </a>
                                    </li>
                                </ul>
                            </section>
                        </div>
                    </div>
                </li>
                <li class="has-dropdown">
                    Hardware

                    <!-- Hardware dropdown menu -->
                    <div class="mbed-nav__dropdown-menu-content">
                        <div class="mbed-nav__hardware-dropdown">
                            <ul class="mbed-nav__hardware-menu">
                                <li>
                                    <a href="https://os.mbed.com/platforms/" class="mbed-nav__icon-link-detail">
                                        <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#boards"></use></svg>
                                        <div>
                                            <p>Boards</p>
                                            <p>Build your Mbed projects with development boards for Arm Cortex processors and MCUs</p>
                                        </div>
                                    </a>
                                </li>
                                <li>
                                    <a href="https://os.mbed.com/modules/" class="mbed-nav__icon-link-detail">
                                        <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#modules"></use></svg>
                                        <div>
                                            <p>Modules</p>
                                            <p>Modules include a MCU, connectivity and onboard memory, making them ideal for designing IoT products for mass production</p>
                                        </div>
                                    </a>
                                </li>
                                <li>
                                    <a href="https://os.mbed.com/components/" class="mbed-nav__icon-link-detail">
                                        <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#components"></use></svg>
                                        <div>
                                            <p>Components</p>
                                            <p>The component database hosts libraries for different sensors, actuators, radios, inputs, middleware and IoT services</p>
                                        </div>
                                    </a>
                                </li>
                                <li>
                                    <a href="https://os.mbed.com/hardware/" class="mbed-nav__icon-link-detail">
                                        <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#hardware_overview"></use></svg>
                                        <div>
                                            <p>Hardware overview & Mbed Enabled</p>
                                            <p>Learn about hardware support for Mbed, as well as the Mbed Enabled program, which identifies Mbed compatible products</p>
                                        </div>
                                    </a>
                                </li>
                                <li>
                                    <a href="https://os.mbed.com/docs/mbed-os/latest/porting/arm-mbed-hdk.html" class="mbed-nav__icon-link-detail">
                                        <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#mbed_hdk"></use></svg>
                                        <div>
                                            <p>Mbed HDK</p>
                                            <p>Reference designs, schematics and board layouts to develop production hardware and Mbed-compatible development boards</p>
                                        </div>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>

                </li>
                <li><a href="https://os.mbed.com/code/">Code</a></li>
                <li class="has-dropdown">
                    Documentation

                    <!-- Documentation dropdown menu -->
                    <div class="mbed-nav__dropdown-menu-content">
                        <div class="mbed-nav__documentation-dropdown">
                            <ul class="mbed-nav__documentation-menu">
                                <li>
                                    <a href="https://os.mbed.com/docs/mbed-os/">Mbed OS</a>
                                </li>
                                <li>
                                    <a
                                        href="https://developer.arm.com/documentation/102497/latest/Arm-Keil-Studio-Cloud">
                                        Keil Studio
                                    </a>
                                </li>
                                <li>
                                    <a href="https://os.mbed.com/docs/mbed-studio/">Mbed Studio</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </li>
                <li><a href="https://os.mbed.com/built-with-mbed/">Case studies</a></li>
                <li class="has-dropdown">
                    Community

                    <!-- Community dropdown menu -->
                    <div class="mbed-nav__dropdown-menu-content">
                        <div class="mbed-nav__community-dropdown">
                            <ul class="mbed-nav__community-menu">
                                <li>
                                    <a href="https://forums.mbed.com/">Forum</a>
                                </li>
                                <li>
                                    <a href="https://os.mbed.com/docs/mbed-os/latest/contributing/index.html">Contribute</a>
                                </li>
                                <li>
                                    <a href="https://www.youtube.com/playlist?list=PLKjl7IFAwc4R4plIZe4IuHlsn8zW7rvKh">Mbed OS Tech Forum</a>
                                </li>
                                <li>
                                    <a href="https://os.mbed.com/support/">Report a problem</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </li>
                <li>
                    <a href="https://os.mbed.com/blog/">Blog</a>
                </li>
            </ul>
        </nav>
    </div>
    <div class="mbed-nav__user-controls">
        <div class="mbed-nav__user-controls-top">
            <div class="mbed-nav__search">
                <form id="mbed-nav__search-box" class="is-hidden" action="https://os.mbed.com/search" method="GET">
                    <div class="mbed-nav__search-box">
                        <input type="search" name="q" placeholder="Search...">
                        <button type="submit">
                            <svg class="stroke-white"><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#search"></use></svg>
                        </button>
                    </div>
                </form>
                <i class="mbed-nav__search-close fas fa-times is-hidden"></i>
                <svg class="mbed-nav__search-open stroke-white"><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#search"></use></svg>
            </div>
            <a class="mbed-nav__cta" href="https://studio.keil.arm.com/mbed" target="_blank">
                Keil Studio Cloud
            </a>

            
                
                <nav class="mbed-nav__logged-out-nav">
                    <ul class="mbed-nav__dropdown-menu">
                        <li>
                            <svg class="stroke-white"><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#profile"></use></svg>

                            <!-- Logged out dropdown menu -->
                            <div class="mbed-nav__dropdown-menu-content">
                                <div class="mbed-nav__logged-out-dropdown">
                                    <ul class="mbed-nav__logged-out-menu">
                                        <li><a href="https://os.mbed.com/account/login/?next=/docs/mbed-os/v6.16/debug-test/utest-asynchronous-c-test-harness.html">Log in or Sign up</a></li>
                                    </ul>
                                </div>
                            </div>
                        </li>
                    </ul>
                </nav>
                
            
        </div>
    </div>
    <div class="mbed-nav__spacer"></div>
</div>
<div class="mbed-nav__mobile-menu-cover is-hidden">
    <div class="mbed-nav__mobile-menu">

        <div id="mbed-nav__main-menu-mobile">
            <div class="mbed-nav__user-controls-mobile">
                <div class="mbed-nav__user-controls-top-mobile">
                    <form action="https://os.mbed.com/search" method="GET">
                        <div class="mbed-nav__search-box mbed-nav__search-box--light">
                            <input type="search" name="q" placeholder="Search...">
                            <button type="submit">
                                <svg class="stroke-dark-grey"><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#search"></use></svg>
                            </button>
                        </div>
                    </form>
                    
                        
                        <a href="https://os.mbed.com/account/login/?next=/docs/mbed-os/v6.16/debug-test/utest-asynchronous-c-test-harness.html">Log in or Sign up</a>
                        
                    
                </div>
            </div>

            <ul class="mbed-nav__side-menu">
                <li>
                    <input type="checkbox" name="accordion-toggle" id="overview-accordion">
                    <label for="overview-accordion">Overview</label>
                    <div class="accordion_content">
                        <ul class="overview-menu-mobile">
                            <li>
                                <p>Operating system</p>
                                <ul>
                                    <li>
                                        <a href="https://os.mbed.com/mbed-os/" class="mbed-nav__icon-link">
                                            <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#mbed_os"></use></svg>
                                            <p>Mbed OS</p>
                                        </a>
                                    </li>
                                    

                                </ul>
                            </li>
                            <li>
                                <p>Development tools</p>
                                <ul>
                                    <li>
                                        <a href="https://os.mbed.com/studio/" class="mbed-nav__icon-link">
                                            <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#mbed_studio"></use></svg>
                                            <p>Mbed Studio</p>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="https://www.keil.arm.com/mbed/?utm_source=mbed_com&amp;utm_medium=compiler_button&amp;utm_campaign=mbed_com_promo" class="mbed-nav__icon-link">
                                             <svg><use href="https://os.mbed.com/static/img/keil_studio_icon.2c56c28014c6.svg?#keil_studio_icon"></use></svg>
                                            <p>Keil Studio</p>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="https://os.mbed.com/docs/mbed-os/latest/quick-start/offline-with-mbed-cli.html" class="mbed-nav__icon-link">
                                            <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#mbed_cli"></use></svg>
                                            <p>Mbed CLI</p>
                                        </a>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <p>Security and connectivity</p>
                                <ul>
                                    <li>
                                        <a href="https://tls.mbed.org/" class="mbed-nav__icon-link">
                                            <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#mbed_tls_crypto"></use></svg>
                                            <p>Mbed TLS and Mbed Crypto</p>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="https://os.mbed.com/connectivity-technologies/" class="mbed-nav__icon-link">
                                            <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#connectivity"></use></svg>
                                            <p>Connectivity</p>
                                        </a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </li>
                <li>
                    <input type="checkbox" name="accordion-toggle" id="hardware-accordion">
                    <label for="hardware-accordion">Hardware</label>
                    <div class="accordion_content">
                        <ul>
                            <li>
                                <a href="https://os.mbed.com/platforms/" class="mbed-nav__icon-link">
                                    <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#boards"></use></svg>
                                    <p>Boards</p>
                                </a>
                            </li>
                            <li>
                                <a href="https://os.mbed.com/modules/" class="mbed-nav__icon-link">
                                    <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#modules"></use></svg>
                                    <p>Modules</p>
                                </a>
                            </li>
                            <li>
                                <a href="https://os.mbed.com/components/" class="mbed-nav__icon-link">
                                    <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#components"></use></svg>
                                    <p>Components</p>
                                </a>
                            </li>
                            <li>
                                <a href="https://os.mbed.com/hardware/" class="mbed-nav__icon-link">
                                    <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#hardware_overview"></use></svg>
                                    <p>Hardware overview & Mbed Enabled</p>
                                </a>
                            </li>
                            <li>
                                <a href="https://os.mbed.com/docs/mbed-os/latest/porting/arm-mbed-hdk.html" class="mbed-nav__icon-link">
                                    <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#mbed_hdk"></use></svg>
                                    <p>Mbed HDK</p>
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li><a href="https://os.mbed.com/code/">Code</a></li>
                <li>
                    <input type="checkbox" name="accordion-toggle" id="documentation-accordion">
                    <label for="documentation-accordion">Documentation</label>
                    <div class="accordion_content">
                        <ul>
                            <li><a href="https://os.mbed.com/docs/mbed-os/">Mbed OS</a></li>
                            <li><a href="https://os.mbed.com/docs/mbed-studio/">Mbed Studio</a></li>
                            <li>
                              <a
                                href="https://developer.arm.com/documentation/102497/1-5/Arm-Keil-Studio/?utm_source=mbed_com&amp;utm_medium=nav_docs_link&amp;utm_campaign=mbed_com_promo">
                                Keil Studio
                              </a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li><a href="https://os.mbed.com/built-with-mbed/">Case studies</a></li>
                <li>
                    <input type="checkbox" name="accordion-toggle" id="community-accordion">
                    <label for="community-accordion">Community</label>
                    <div class="accordion_content">
                        <ul>
                            <li><a href="https://forums.mbed.com/">Forum</a></li>
                            <li><a href="https://os.mbed.com/docs/mbed-os/latest/contributing/index.html">Contribute</a></li>
                            <li><a href="https://www.youtube.com/playlist?list=PLKjl7IFAwc4R4plIZe4IuHlsn8zW7rvKh">Mbed OS Tech Forum</a></li>
                            <li><a href="https://os.mbed.com/support/">Report a problem</a></li>
                        </ul>
                    </div>
                </li>
                <li><a href="https://os.mbed.com/blog/">Blog</a></li>
            </ul>
        </div>

        
    </div>
</div>



<div class="version-picker-container">
    
    <select class="version-picker" onchange="goToVersion(this.value)">
        
            <option
                value="v6.16"
                selected
            >
                v6.16
            </option>
        
            <option
                value="v6.15"
                
            >
                v6.15
            </option>
        
            <option
                value="v6.14"
                
            >
                v6.14
            </option>
        
            <option
                value="v6.13"
                
            >
                v6.13
            </option>
        
            <option
                value="v6.12"
                
            >
                v6.12
            </option>
        
            <option
                value="v6.11"
                
            >
                v6.11
            </option>
        
            <option
                value="v6.10"
                
            >
                v6.10
            </option>
        
            <option
                value="v6.9"
                
            >
                v6.9
            </option>
        
            <option
                value="v6.8"
                
            >
                v6.8
            </option>
        
            <option
                value="v6.7"
                
            >
                v6.7
            </option>
        
            <option
                value="v6.6"
                
            >
                v6.6
            </option>
        
            <option
                value="v6.5"
                
            >
                v6.5
            </option>
        
            <option
                value="v5.15"
                
            >
                v5.15
            </option>
        
    </select>
    

    <div class="contact-us">
        Mistake on this page?
        
            <br>
            <a href="https://github.com/ARMmbed/mbed-os-5-docs/issues">
                Report an issue in GitHub
                <i class="fab fa-github"></i>
            </a>
            or
            <a href="mailto:mbed-support@arm.com">
                email us
                <i class="fas fa-envelope"></i>
            </a>
        
    </div>
</div>

<script>
    function goToVersion(version) {
        window.location.href = window.location.href.replace(
            "v6.16",
            version
        )
    }
</script>

        
        <div class="off-canvas-wrapper" id="docs-content">
            <div class="off-canvas-wrapper-inner full-height" data-off-canvas-wrapper="">
                <div class="off-canvas-content" data-off-canvas-content="">
                    <a href="#" id="nav-button">
                        <span>
                            <i class="fa fa-bars"></i>
                        </span>
                    </a>

                    <div class="toc-wrapper" id="navbar">
                        <div id="toc">
    
        
        <div class="toc-level top">
            <a class="toc-item introduction" href="../introduction/index.html">Introduction to Mbed OS 6</a>
        </div>
        

        

    
        
        <div class="toc-level top">
            <a class="toc-item bare-metal" href="../bare-metal/index.html">Mbed OS bare metal profile</a>
        </div>
        

        

    
        
        <div class="toc-level top">
            <a class="toc-item quick-start" href="../quick-start/index.html">Quick start</a>
        </div>
        

        

    
        
        <div class="toc-level top">
            <a class="toc-item apis" href="../apis/index.html">API references and tutorials</a>
        </div>
        

        

    
        
        <div class="toc-level top">
            <a class="toc-item program-setup" href="../program-setup/index.html">Program setup</a>
        </div>
        

        

    
        
        <div class="toc-level top">
            <a class="toc-item build-tools" href="../build-tools/index.html">Build tools</a>
        </div>
        

        

    
        
        <div class="toc-level top">
            <a class="toc-item debug-test active-doc" href="index.html">Debugging and testing</a>
        </div>
        

        
            <div class="toc-level one">
                <a class="toc-item" href="index.html">Debugging</a>
                
                <div class="toc-level two sub">
                    
                    <a class="toc-item" href="index.html">Methods</a>
                    
                    <div class="toc-level three sub closed">
                        
                        <a class="toc-item" href="index.html">Debugging methods for Arm Mbed OS applications</a>
                        
                        <a class="toc-item" href="setting-up-a-local-debug-toolchain.html">Setting up a local debug toolchain</a>
                        
                        <a class="toc-item" href="memap.html">Static memory map analysis</a>
                        
                        <a class="toc-item" href="daplink.html">DAPLink</a>
                        
                        <a class="toc-item" href="troubleshooting-common-issues.html">Troubleshooting common issues</a>
                        
                        <a class="toc-item" href="analyzing-mbed-os-crash-dump.html">Analyzing Mbed OS crash dump</a>
                        
                        <a class="toc-item" href="compile-time-errors.html">Compile time errors</a>
                        
                        <a class="toc-item" href="debugging-using-printf-statements.html">Debugging using printf() statements</a>
                        
                        <a class="toc-item" href="debug-microbit.html">Debugging the BBC micro:bit with pyOCD and GDB</a>
                        
                    </div>
                    
                    
                    <a class="toc-item" href="third-party-tools.html">Third party tools</a>
                    
                    <div class="toc-level three sub closed">
                        
                        <a class="toc-item" href="eclipse.html">Eclipse</a>
                        
                        <a class="toc-item" href="keil-uvision.html">Keil uVision</a>
                        
                        <a class="toc-item" href="visual-studio-code.html">Visual Studio Code</a>
                        
                    </div>
                    
                    
                </div>
                
            </div>
        
            <div class="toc-level one">
                <a class="toc-item" href="test-tools.html">Test tools</a>
                
                <div class="toc-level two sub">
                    
                    <a class="toc-item" href="test-tools.html">Testing</a>
                    
                    <div class="toc-level three sub closed">
                        
                        <a class="toc-item" href="unit-testing.html">Unit testing</a>
                        
                        <a class="toc-item" href="greentea-for-testing-applications.html">Greentea for testing applications</a>
                        
                        <a class="toc-item" href="utest-asynchronous-c-test-harness.html">utest: asynchronous C++ test harness</a>
                        
                        <a class="toc-item" href="fast-models.html">Fast Models</a>
                        
                    </div>
                    
                    
                </div>
                
            </div>
        

    
        
        <div class="toc-level top">
            <a class="toc-item tutorials" href="../tutorials/index.html">Tutorials and examples</a>
        </div>
        

        

    
        
        <div class="toc-level top">
            <a class="toc-item contributing" href="../contributing/index.html">Contributing</a>
        </div>
        

        

    
        
        <div class="toc-level top">
            <a class="toc-item porting" href="../porting/index.html">Porting</a>
        </div>
        

        

    
        
        <div class="toc-level top">
            <a class="toc-item mbed-os-pelion" href="../mbed-os-pelion/index.html">Reference designs and end-to-end information</a>
        </div>
        

        

    
</div>
                    </div>

                    <div class="page-wrapper" id="page">
                        <div class="row">
                            <div class="content large-12 medium-12 columns" id="content">
                                <div class="breadcrumbs">
                                    
                                    <a href="../index.html">Docs</a>
                                     › 
                                    
                                    <a href="index.html">Debugging and testing</a>
                                     › 
                                    
                                    <a href="test-tools.html">Test tools</a>
                                     › 
                                    
                                    <a href="test-tools.html">Testing</a>
                                     › 
                                    
                                    <a href="utest-asynchronous-c-test-harness.html">utest: asynchronous C++ test harness</a>
                                    
                                    
                                </div>
                                <h1>utest: asynchronous C++ test harness</h1><p>This test harness allows you to execute a specified series of (asynchronous) C++ test cases with sensible default reporting and useful customization options.</p><p>Please note that this is a purposefully lean test harness that only deals with test execution and provides default reporting handlers. For autodiscovery of test cases, test macros and other convenience functions, you can use the macros in the <a href="https://github.com/ARMmbed/mbed-os/tree/master/features/frameworks/unity">unity module</a>. However, you are not required to use these and can use your own macros.</p><h2 id="theory">Theory</h2><p>A test specification contains a setup handler, several test cases and a teardown handler. Each test case contains a textual description, setup, teardown and failure handler, as well as the actual test handler.</p><p>The order of handler execution is:</p><ol>
<li>Test setup handler.</li>
<li>For each test case:
<ol>
<li>Test case setup handler.</li>
<li>Test case execution handler.</li>
<li>(Wait for timeout or callback validation in case of an asynchronous test case.)</li>
<li>(Repeat test case execution handler if specified.)</li>
<li>Test case teardown handler.</li>
</ol>
</li>
<li>Test teardown handler.</li>
</ol><h2 id="example">Example</h2><p>This example showcases functionality and proper integration with the <a href="greentea-for-testing-applications.html">Greentea testing automation framework</a>, while making use of the <a href="https://github.com/ARMmbed/mbed-os/tree/master/features/frameworks/unity">unity test macros</a>:</p><div class="code-include-block">
<div class="code-header">
<a href="https://github.com/ARMmbed/mbed-os-snippet-Utest_Ex_1/blob/v6.7/main.cpp" target="_blank"><i class="fa fa-file-code-o"></i> <b class="filename">main.cpp</b></a><a class="button" href="https://studio.keil.arm.com/?import=https://github.com/ARMmbed/mbed-os-snippet-Utest_Ex_1" target="_blank">Import into Keil Studio Cloud</a>
</div>
<pre><code>/*
 * Copyright (c) 2020 Arm Limited and affiliates.
 * SPDX-License-Identifier: Apache-2.0
 */

#include "greentea-client/test_env.h"
#include "unity.h"
#include "utest.h"

using namespace utest::v1;

void test_simple()
{
    TEST_ASSERT_EQUAL(0, 0);
    printf("Simple test called\n");
}

utest::v1::status_t test_repeats_setup(const Case *const source, const size_t index_of_case)
{
    // Call the default handler for proper reporting
    utest::v1::status_t status = greentea_case_setup_handler(source, index_of_case);
    printf("Setting up for '%s'\n", source-&gt;get_description());
    return status;
}
control_t test_repeats(const size_t call_count)
{
    printf("Called for the %u. time\n", call_count);
    TEST_ASSERT_NOT_EQUAL(3, call_count);
    // Specify how often this test is repeated i.e. n total calls
    return (call_count &lt; 2) ? CaseRepeatAll : CaseNext;
}

void test_callback_validate()
{
    // You may also use assertions here
    TEST_ASSERT_EQUAL_PTR(0, 0);
    // Validate the callback
    Harness::validate_callback();
}

// Specify all your test cases here
Case cases[] = {
    Case("Simple Test", test_simple),
    Case("Repeating Test", test_repeats_setup, test_repeats)
};

// Custom setup handler required for proper Greentea support
utest::v1::status_t greentea_setup(const size_t number_of_cases)
{
    GREENTEA_SETUP(20, "default_auto");
    // Call the default reporting function
    return greentea_test_setup_handler(number_of_cases);
}

// Declare your test specification with a custom setup handler
Specification specification(greentea_setup, cases);

int main()
{
    // Run the test specification
    Harness::run(specification);
}

</code></pre>
</div><p>Running this test will output the following:</p><pre><code>{{__version;1.3.0}}
{{__timeout;20}}
{{__host_test_name;default_auto}}
{{__testcase_count;2}}
&gt;&gt;&gt; Running 2 test cases...
{{__testcase_name;Simple Test}}
{{__testcase_name;Repeating Test}}

&gt;&gt;&gt; Running case #1: 'Simple Test'...
{{__testcase_start;Simple Test}}
Simple test called
{{__testcase_finish;Simple Test;1;0}}
&gt;&gt;&gt; 'Simple Test': 1 passed, 0 failed

&gt;&gt;&gt; Running case #2: 'Repeating Test'...
{{__testcase_start;Repeating Test}}
Setting up for 'Repeating Test'
Called for the 1. time
{{__testcase_finish;Repeating Test;1;0}}
&gt;&gt;&gt; 'Repeating Test': 1 passed, 0 failed

&gt;&gt;&gt; Running case #2: 'Repeating Test'...
{{__testcase_start;Repeating Test}}
Setting up for 'Repeating Test'
Called for the 2. time
{{__testcase_finish;Repeating Test;2;0}}
&gt;&gt;&gt; 'Repeating Test': 2 passed, 0 failed

&gt;&gt;&gt; Test cases: 2 passed, 0 failed
{{__testcase_summary;2;0}}
{{max_heap_usage;0}}
{{reserved_heap;0}}
{{end;success}}
{{__exit;0}}
</code></pre><h2 id="handlers">Handlers</h2><p>There are six handler types you can, but do not have to, override to customize operation. Please see the <code>utest/types.h</code> file for a detailed description.</p><ol>
<li><code>status_t test_setup_handler_t(const size_t number_of_cases)</code>: called before execution of any test case.</li>
<li><code>void test_teardown_handler_t(const size_t passed, const size_t failed, const failure_t failure)</code>: called after execution of all test cases and if testing is aborted.</li>
<li><code>void test_failure_handler_t(const failure_t failure)</code>: called whenever a failure occurs anywhere in the specification.</li>
<li><code>status_t case_setup_handler_t(const Case *const source, const size_t index_of_case)</code>: called before execution of each test case.</li>
<li><code>status_t case_teardown_handler_t(const Case *const source, const size_t passed, const size_t failed, const failure_t reason)</code>: called after execution of each test case and if testing is aborted.</li>
<li><code>status_t case_failure_handler_t(const Case *const source, const failure_t reason)</code>: called whenever a failure occurs during the execution of a test case.</li>
</ol><p>All handlers are defaulted for integration with the Greentea testing automation framework.</p><h2 id="test-case-handlers">Test case handlers</h2><p>There are three test case handlers:</p><ol>
<li><code>void case_handler_t(void)</code>: executes once if the case setup succeeded.</li>
<li><code>control_t case_control_handler_t(void)</code>: executes (asynchronously) as many times as you specify if the case setup succeeded.</li>
<li><code>control_t case_call_count_handler_t(const size_t call_count)</code>: executes (asynchronously) as many times as you specify if the case setup succeeded.</li>
</ol><p>To specify a test case, wrap it into a <code>Case</code> class: <code>Case("mandatory description", case_handler)</code>. You may override the setup, teardown and failure handlers in this wrapper class as well. The <code>Case</code> constructor is overloaded to allow you a comfortable declaration of all your callbacks. The order of arguments is:</p><ol>
<li>Description (required).</li>
<li>Setup handler (optional).</li>
<li>Test case handler (required).</li>
<li>Teardown handler (optional).</li>
<li>Failure handler (optional).</li>
</ol><h3 id="test-case-attributes">Test case attributes</h3><p>Modify test case behavior by returning <code>control_t</code> modifiers:</p><ul>
<li><code>CaseNext</code>: never repeats and immediately moves to next test case.</li>
<li><code>CaseNoRepeat</code>: never repeats.</li>
<li><code>CaseRepeatAll</code>: repeats test case <strong>with</strong> setup and teardown handlers.</li>
<li><code>CaseRepeatHandler</code>: repeats test case <strong>without</strong> set and teardown handlers.</li>
<li><code>CaseNoTimeout</code>: immediately moves to next test case.</li>
<li><code>CaseAwait</code>: waits indefinitely for callback validation (<em>use with caution</em>).</li>
<li><code>CaseTimeout(uint32_t ms)</code>: waits for callback validation for <code>ms</code> milliseconds, times out after that (fails with <code>REASON_TIMEOUT</code>).</li>
<li><code>CaseRepeatAllOnTimeout(uint32_t ms)</code>: waits for callback validation for <code>ms</code> milliseconds, repeats test case <strong>with</strong> setup and teardown handlers on time out.</li>
<li><code>CaseRepeatHandlerOnTimeout(uint32_t ms)</code>: waits for callback validation for <code>ms</code> milliseconds, repeats test case <strong>without</strong> setup and teardown handlers on time out.</li>
</ul><p>Returning <code>CaseRepeatAll</code> from your test case handler tells the test harness to repeat the test handler. You can use the <code>call_count</code> (starts counting at 1) to decide when to stop. By default, the setup and teardown handlers are called on every repeated test case, however, you may only repeat the case handler by returning <code>CaseRepeatHandler</code>. To stop the harness from repeating the test case, return <code>CaseNext</code>.</p><p>For asynchronous test cases, you must return a <code>CaseTimeout(uint32_t ms)</code>. If you want to automatically repeat the test case on a timeout, use <code>CaseRepeatAllOnTimeout(uint32_t ms)</code> and <code>CaseRepeatHandlerOnTimeout(uint32_t ms)</code>.</p><p>To validate your callback, you must call <code>Harness::validate_callback()</code> in your asynchronous callback before the timeout fires. This will schedule the execution of the next test case.</p><p>For repeating asynchronous cases, you can "add" both attributes together: <code>CaseTimeout(200) + CaseRepeatAll</code> will wait for 200 ms for the callback validation and then repeat the test case. See the section on <a href="#test-case-attribute-arbitration">arbitration logic</a> for more details.</p><p>You can also add attributes during callback validation; however, only repeat attributes are considered. This allows you to return <code>CaseTimeout(500)</code> to wait up to 500 ms for the callback validation and delegate the decision to repeat to the time the callback occurs: <code>Harness::validate_callback(CaseRepeatHandler)</code>.</p><p>You can only validate a callback once. If you need to wait for several callbacks, you need to write your own helper function that validates the expected callback only when all your custom callbacks arrive. This custom functionality is not part of this test harness; you can achieve it externally with additional code.</p><h2 id="failure-handlers">Failure handlers</h2><p>A failure may occur during any phase of the test. The appropriate failure handler is then called with <code>failure_t</code>, which contains the failure reason and location.</p><p>The failure reasons are:</p><ul>
<li><code>REASON_NONE</code>: No failure occurred.</li>
<li><code>REASON_UNKNOWN</code>: An unknown failure occurred.</li>
<li><code>REASON_CASES</code>: A failure occurred in at least one test case.</li>
<li><code>REASON_EMPTY_CASE</code>: The test case contains only empty handlers.</li>
<li><code>REASON_TIMEOUT</code>: An expected asynchronous call timed out.</li>
<li><code>REASON_ASSERTION</code>: An assertion failed.</li>
<li><code>REASON_TEST_SETUP</code>: Test setup failed.</li>
<li><code>REASON_TEST_TEARDOWN</code>: Test teardown failed.</li>
<li><code>REASON_CASE_SETUP</code>: Case setup failed.</li>
<li><code>REASON_CASE_HANDLER</code>: Case handler failed.</li>
<li><code>REASON_CASE_TEARDOWN</code>: Case teardown failed.</li>
<li><code>REASON_CASE_INDEX</code>: Case index returned from test setup or case teardown handler is invalid.</li>
<li><code>REASON_SCHEDULER</code>: Underlying scheduler is not asynchronous.</li>
</ul><p>The failure locations are:</p><ul>
<li><code>LOCATION_NONE</code>: No location information.</li>
<li><code>LOCATION_UNKNOWN</code>: A failure occurred in an unknown location.</li>
<li><code>LOCATION_TEST_SETUP</code>: A failure occurred in the test setup.</li>
<li><code>LOCATION_TEST_TEARDOWN</code>: A failure occurred in the test teardown.</li>
<li><code>LOCATION_CASE_SETUP</code>: A failure occurred in the case setup.</li>
<li><code>LOCATION_CASE_HANDLER</code>: A failure occurred in the case handler.</li>
<li><code>LOCATION_CASE_TEARDOWN</code>: A failure occurred in the case teardown.</li>
</ul><p>If the setup or teardown handlers fail, they may return a <code>STATUS_ABORT</code> code, which will call the failure handler with the appropriate failure reason (<code>REASON_CASE_{SETUP|TEARDOWN}</code>) and failure location (<code>LOCATION_CASE_{SETUP|TEARDOWN}</code>).
If the setup handler fails, the test case never executes. Instead, the teardown handler is called in an attempt to salvage the situation. Please note that if a teardown handler fails, the system can be too unstable to continue testing.</p><p>You may also raise a failure manually by calling <code>Harness::raise_failure(failure_reason_t reason)</code>. In fact, this is how you can integrate assertion failures from custom test macros, as with the unity macros, which raise a failure with the <code>REASON_ASSERTION</code> reason.</p><p>When waiting for an asynchronous callback, if the timeout fires, <code>REASON_TIMEOUT</code> is raised.</p><p>The failure handler decides whether to continue or abort testing by returning <code>STATUS_CONTINUE</code> or <code>STATUS_ABORT</code> respectively. You can also ignore any raised failure by returning <code>STATUS_IGNORE</code>, and the harness will then not count this failure. In case of an abort, the test harness dies by busy waiting in a forever loop. This is necessary because you cannot unwind the stack without exception support, and the asynchronous nature of the test harness breaks with <code>longjmp</code>s.</p><p>When <code>REASON_IGNORE</code> is <code>OR</code>ed into the failure reason, the failure handler returns <code>STATUS_IGNORE</code>. This is automatic for test cases repeating after a timeout, and the default failure handlers also report this failure but tell the harness to ignore it. The unity macros may decide to ignore assertion failures as well, in which case the assertion is ignored intentionally.</p><h2 id="default-handlers">Default handlers</h2><p>Four sets of default handlers with different behaviors are provided for your convenience:</p><ol>
<li><code>greentea_abort_handlers</code> (default): Greentea-style reporting, aborts on the first failure, but requires custom test setup handler.</li>
<li><code>greentea_continue_handlers</code>: Greentea-style reporting, always continues testing, but requires custom test setup handler.</li>
<li><code>verbose_continue_handlers</code>: always continues testing and reporting, except when a teardown failed.</li>
<li><code>selftest_handlers</code>: Greentea-style reporting, but aborts on the first assertion failure raised. This allows the use of unity macros for self testing without recursive failure handler calls.</li>
</ol><p>These default handlers are called when you have not overridden a custom handler, and they only contain reporting functionality and do not modify global state.</p><p>You can specify which default handlers you want to use when wrapping your test cases in the <code>Specification</code> class:</p><pre lang="cpp"><code>// Declare your test specification with a custom setup handler
// and set the default handlers to the predefined “greentea continue” behavior
Specification specification(greentea_setup, cases, greentea_continue_handlers);
</code></pre><h2 id="custom-handlers">Custom handlers</h2><p>You may override any of the default handlers with your own custom handler.</p><p>To ignore a handler completely and not call a custom or default handler, use the <code>ignore_handler</code> hint.
To explicitly invoke the default handler, use the <code>default_handler</code> hint.</p><p>To use your own custom handler, provide a function with the correct signature for the handler that you want to customize, and provide it in your test case wrapper or specification wrapper. To turn a <code>failure_t</code> into a meaningful string, use the <code>stringify(failure_t)</code> method.</p><p><strong>We strongly recommend that you call the predefined <code>greentea_*</code> handlers inside your custom callback, as they report the current condition in a properly formatted fashion.</strong> By calling these handlers inside your custom callback, your unit test does not need to be modified if the test logging needs to be changed in the future.</p><p>For the <code>Specification</code> class the order of arguments is:</p><ol>
<li>Test setup handler (optional).</li>
<li>Array of test cases (required).</li>
<li>Test teardown handler (optional).</li>
<li>Test failure handler (optional).</li>
<li>Default handlers (optional).</li>
</ol><h2 id="test-case-attribute-arbitration">Test case attribute arbitration</h2><p>When adding conflicting modifiers together:</p><ul>
<li>The more restrictive (=shorter) timeout is chosen, but <code>CaseNoTimeout</code> always wins arbitration: <code>CaseNoTimeout</code> &gt; <code>CaseTimeout(100)</code> &gt; <code>CaseTimeout(200)</code> &gt; <code>CaseAwait</code>.</li>
<li>The more invasive repeat method is chosen, but <code>CaseNoRepeat</code> always wins arbitration: <code>CaseNoRepeat</code> &gt; <code>CaseRepeatAll</code>/<code>CaseRepeatAllOnTimeout(ms)</code> &gt; <code>CaseRepeatHandler</code>/<code>CaseRepeatHandlerOnTimeout(ms)</code>.</li>
<li><code>CaseNext</code> always wins arbitration.</li>
</ul><p>The following table shows this arbitration logic in detail:</p><table>
<thead>
<tr>
<th align="center">+</th>
<th align="center"><code>CaseNext</code></th>
<th align="center"><code>CaseNoRepeat</code></th>
<th align="center"><code>CaseRepeatAll</code></th>
<th align="center"><code>CaseRepeatHandler</code></th>
<th align="center"><code>CaseNoTimeout</code></th>
<th align="center"><code>CaseAwait</code></th>
<th align="center"><code>CaseTimeout(aa)</code></th>
<th align="center"><code>CaseRepeatAllOnTimeout(aa)</code></th>
<th align="center"><code>CaseRepeatHandlerOnTimeout(aa)</code></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>CaseNext</code></td>
<td align="center">no repeat &amp;<br/> no timeout<br/></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><code>CaseNoRepeat</code></td>
<td align="center">no repeat &amp;<br/> no timeout<br/></td>
<td align="center">no repeat</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><code>CaseRepeatAll</code></td>
<td align="center">no repeat &amp;<br/> no timeout<br/></td>
<td align="center">no repeat</td>
<td align="center">repeat all</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><code>CaseRepeatHandler</code></td>
<td align="center">no repeat &amp;<br/> no timeout<br/></td>
<td align="center">no repeat</td>
<td align="center">repeat all</td>
<td align="center">repeat handler</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><code>CaseNoTimeout</code></td>
<td align="center">no repeat &amp;<br/> no timeout<br/></td>
<td align="center">no repeat &amp;<br/> no timeout<br/></td>
<td align="center">repeat all &amp;<br/> no timeout<br/></td>
<td align="center">repeat handler &amp;<br/> no timeout<br/></td>
<td align="center">no timeout</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><code>CaseAwait</code></td>
<td align="center">no repeat &amp;<br/> no timeout<br/></td>
<td align="center">no repeat &amp;<br/> infinite timeout<br/></td>
<td align="center">repeat all &amp;<br/> infinite timeout<br/></td>
<td align="center">repeat handler &amp;<br/> infinite timeout<br/></td>
<td align="center">no timeout</td>
<td align="center">infinite timeout</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><code>CaseTimeout(bb)</code></td>
<td align="center">no repeat &amp;<br/> no timeout<br/></td>
<td align="center">no repeat &amp;<br/> <code>bb</code>ms timeout<br/></td>
<td align="center">repeat all &amp;<br/> <code>bb</code>ms timeout<br/></td>
<td align="center">repeat handler &amp;<br/> <code>bb</code>ms timeout<br/></td>
<td align="center">no timeout</td>
<td align="center"><code>bb</code>ms timeout</td>
<td align="center"><code>min(aa,bb)</code>ms timeout</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><code>CaseRepeatAllOnTimeout(bb)</code></td>
<td align="center">no repeat &amp;<br/> no timeout<br/></td>
<td align="center">no repeat &amp;<br/> <code>bb</code>ms timeout<br/></td>
<td align="center">repeat all on validate &amp; repeat all on <code>bb</code>ms timeout</td>
<td align="center">repeat all on validate &amp; repeat all on <code>bb</code>ms timeout</td>
<td align="center">repeat all &amp; no timeout</td>
<td align="center">repeat all on <code>bb</code>ms timeout</td>
<td align="center">repeat all on <code>min(aa,bb)</code>ms timeout</td>
<td align="center">repeat all on <code>min(aa,bb)</code>ms timeout</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><code>CaseRepeatHandlerOnTimeout(bb)</code></td>
<td align="center">no repeat &amp;<br/> no timeout<br/></td>
<td align="center">no repeat &amp;<br/> <code>bb</code>ms timeout<br/></td>
<td align="center">repeat all on validate &amp; repeat all on <code>bb</code>ms timeout</td>
<td align="center">repeat handler on validate &amp; repeat handler on <code>bb</code>ms timeout</td>
<td align="center">repeat handler &amp; no timeout</td>
<td align="center">repeat handler on <code>bb</code>ms timeout</td>
<td align="center">repeat handler on <code>min(aa,bb)</code>ms timeout</td>
<td align="center">repeat all on <code>min(aa,bb)</code>ms timeout</td>
<td align="center">repeat handler on <code>min(aa,bb)</code>ms timeout</td>
</tr>
</tbody>
</table><h2 id="atomicity">Atomicity</h2><p>All handlers execute with interrupts enabled, <strong>except the case failure handler!</strong>. This means you can write test cases that poll for interrupts to be completed inside any handler except the failure handler.</p><p>If you set up an interrupt that validates its callback using <code>Harness::validate_callback()</code> inside a test case and it fires before the test case completed, the validation will be buffered. If the test case then returns a timeout value, but the callback is already validated, the test harness just continues normally.</p><h2 id="custom-scheduler">Custom scheduler</h2><p>By default, a Timeout object is used for scheduling the harness operations. If this is not available, you can provide your own custom scheduler implementation and make the harness use it with the <code>Harness::set_schedule (your_custom_implementation)</code> function.</p><p>The scheduler requirements are very simple: Execute a <code>void(void)</code> function in your main loop (with a delay of <em>N</em> ms). The harness only schedules one function <em>at any given time</em>. Note that you do not need to implement the delay functionality if your tests do not require timeouts. You will still be able to use repeating test cases, but an error will occur if your tests attempt to use a timeout when your underlying scheduler does not support it.</p><p>There are two functions you need to implement:</p><ul>
<li><code>void* post_callback(const utest_v1_harness_callback_t callback, const uint32_t delay_ms)</code>: schedules a <code>void(void)</code> callback function in <em>N</em> ms.</li>
<li><code>int32_t cancel_callback_t(void *handle)</code>: cancels an asynchronous callback.</li>
</ul><h2 id="example-synchronous-scheduler">Example synchronous scheduler</h2><p>Here is the most basic scheduler implementation without any asynchronous support. Note that this does not require any hardware support at all, but you cannot use timeouts in your test cases.</p><pre lang="cpp"><code>volatile utest_v1_harness_callback_t minimal_callback;

static void* utest_minimal_post(const utest_v1_harness_callback_t callback, const uint32_t delay_ms) {
    minimal_callback = callback;
    // this scheduler does not support asynchronous callbacks
    return (delay_ms ? NULL : (void*)1);
}
static int32_t utest_minimal_cancel(void*) {
    return -1;  // canceling not supported either
}
static const utest_v1_scheduler_t utest_minimal_scheduler = {utest_minimal_post, utest_minimal_cancel};

// [...] Add your test cases and specification here

void main() // or whatever your custom entry point is
{
    // You must set the custom scheduler before running the specification
    Harness::set_scheduler(utest_minimal_scheduler);
    Harness::run(specification);

    while(1) {
        if (minimal_callback) {
            // copy the callback and reset the shared memory
            utest_v1_harness_callback_t callback = minimal_callback;
            minimal_callback = NULL;
            callback(); // execute the copied callback
        }
    }
}
</code></pre><h2 id="example-asynchronous-scheduler">Example asynchronous scheduler</h2><p>Here is the complete scheduler implementation with any asynchronous support. Note that this does require at least a hardware timer. This example uses <code>mbed-hal/us_ticker</code>. Note that you must not execute the callback in the timer interrupt context, but in the main loop context.</p><pre lang="cpp"><code>volatile utest_v1_harness_callback_t minimal_callback;
volatile utest_v1_harness_callback_t ticker_callback;
const ticker_data_t *ticker_data;
ticker_event_t ticker_event;

static void ticker_handler(uint32_t) {
    minimal_callback = ticker_callback; // interrupt context
}
static void* utest_minimal_post(const utest_v1_harness_callback_t callback, const uint32_t delay_ms) {
    if (delay_ms) {
        ticker_callback = callback;
        ticker_insert_event(ticker_data, &amp;ticker_event, ticker_read(ticker_data) + delay_ms * 1000, 0);
    }
    else minimal_callback = callback;
    return (void*)1;
}
static int32_t utest_minimal_cancel(void*) {
    ticker_remove_event(ticker_data, &amp;ticker_event);
    return 0;   // canceling is supported
}
static const utest_v1_scheduler_t utest_minimal_scheduler = {utest_minimal_post, utest_minimal_cancel};

// [...] Add your test cases and specification here

void main() // or whatever your custom entry point is
{
    ticker_data = get_us_ticker_data(); // initialize the ticker data.
    ticker_set_handler(ticker_data, ticker_handler);
    // You must set the custom scheduler before running the specification
    Harness::set_scheduler(utest_minimal_scheduler);
    Harness::run(specification);

    while(1) {
        if (minimal_callback) {
            // copy the callback and reset the shared memory
            utest_v1_harness_callback_t callback = minimal_callback;
            minimal_callback = NULL;
            callback(); // execute the copied callback
        }
    }
}
</code></pre>
                            </div>
                        </div>

                        
                        <div class="row">
                            <div class="next-prev-links large-12 medium-12 small-12 columns">
                                
                                <a class="prev-link" href="greentea-for-testing-applications.html"><i aria-hidden="true" class="fa fa-arrow-circle-left"></i> Previous</a>
                                

                                
                                <a class="next-link" href="fast-models.html">Next <i aria-hidden="true" class="fa fa-arrow-circle-right"></i></a>
                                
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
        <script src="../static/js/vendor/jquery-3.2.1.min.mbed-cache-c9f5aeeca3ad37bf2aa006139b935f0a.js"></script>
        <script src="../static/js/toc.mbed-cache-261a3b3a8a10e9d430f4bb5fdd0e5b5c.js"></script>
        <script src="../static/js/vendor/foundation-6.2.4.min.mbed-cache-9f0af735cc1c2011ddd8e8a94273129a.js"></script>
        <script>
            $('#docs-content').foundation();
            $(document).ready(function() {
                initToC();
            });
        </script>
    

        
<footer class="global-footer">
    <ul class="global-footer-media global-footer-row">
        <li>
            <a class="footer-media-icon" title="Twitter" href="https://twitter.com/ArmSoftwareDev">
                <span class="fab fa-twitter-square fa-2x"></span>
                <span class="global-footer-show-on-large-screens">Twitter</span>
            </a>
        </li>
        <li>
            <a class="footer-media-icon" title="YouTube" href="https://www.youtube.com/c/ArmSoftwareDevelopers">
                <span class="fab fa-youtube-square fa-2x"></span>
                <span class="global-footer-show-on-large-screens">YouTube</span>
            </a>
        </li>
        <li>
            <a class="footer-media-icon" title="Forum" href="http://forums.mbed.com/">
                <span class="fas fa-comments fa-2x"></span>
                <span class="global-footer-show-on-large-screens">Forum</span>
            </a>
        </li>
        <li>
            <a class="footer-media-icon" title="Blog" href="http://blog.mbed.com/">
                <span class="fas fa-pen-square fa-2x"></span>
                <span class="global-footer-show-on-large-screens">Blog</span>
            </a>
        </li>
    </ul>

    <div class="global-footer-copyright global-footer-row">
        <div class="copyright-statement">Copyright © <script>document.write(new Date().getFullYear());</script> Arm Limited (or its affiliates).</div>
        <ul class="copyright-links">
            <li><a href="https://os.mbed.com/">Home</a></li>
            <li><a href="https://www.arm.com/company/policies/terms-and-conditions">Website Terms</a></li>
            <li><a href="https://www.arm.com/company/policies/privacy">Privacy</a></li>
            <li><a href="https://www.arm.com/company/policies/cookies">Cookies</a></li>
            <li><a href="http://www.arm.com/company/policies/trademarks">Trademarks</a></li>
        </ul>
    </div>
</footer>



    <div id="cookiemodule">
    <h5>Important Information for this Arm website</h5>
    <div id="cookiecontent">
        <p>
            This site uses cookies to store information on your computer.
            By continuing to use our site, you consent to our cookies.
            If you are not happy with the use of these cookies, please review our
            <a href="https://www.arm.com/company/policies/cookies">Cookie Policy</a>
            to learn how they can be disabled.
            By disabling cookies, some features of the site will not work.
        </p>
        <button id="acceptcookie">Accept and hide this message</button>
    </div>
</div>
<script src="../../../../static/js/cookie_law.js"></script>




    </body>

<!-- Mirrored from os.mbed.com/docs/mbed-os/v6.16/debug-test/utest-asynchronous-c-test-harness.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 16 Sep 2024 14:16:32 GMT -->
</html>
