<!DOCTYPE html>
<html>
    
<!-- Mirrored from os.mbed.com/docs/mbed-os/v6.16/mbed-os-api-doxy/_t_a_r_g_e_t___t_f_m_2_t_a_r_g_e_t___t_f_m___v1__0_2include_2psa_2crypto_8h_source.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 16 Sep 2024 15:22:26 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
        
        <meta charset="utf-8"/>
        <title>Mbed OS Reference | crypto.h Source File</title>
        <link href="../static/css/vendor/foundation-6.2.4.min.mbed-cache-4c48f6c816971070eb1e4eca75f0ec30.css" rel="stylesheet"/>
        <link href="search/search.css" rel="stylesheet"/>
        <link href="../static/css/app.mbed-cache-a44289fe9f5ca07036a335d6ad7ed8ad.css" rel="stylesheet"/>
        <script src="../static/js/vendor/jquery-3.2.1.min.mbed-cache-c9f5aeeca3ad37bf2aa006139b935f0a.js"></script>
        <script src="dynsections.js"></script>
        <script src="search/searchdata.js"></script>
        <script src="search/search.js"></script>
        <script>
            $(document).ready(function() {
                init_search();
            });
        </script>
    
        

<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','../../../../../www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-1447836-8');
ga('require', 'GTM-WXMLD4S')
</script>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'../../../../../www.googletagmanager.com/gtm5445.html?id='+i+dl+'&gtm_auth=SMYNPwM0ICsV00c1ZHETqQ&gtm_preview=env-2&gtm_cookies_win=x';f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-M6FZ495');</script>


    <script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:971746,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>



<!-- Favicons -->
<link rel="apple-touch-icon" sizes="57x57" href="../../../../static/img/favicons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../../../../static/img/favicons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../../../../static/img/favicons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../../../../static/img/favicons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../../../../static/img/favicons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../../../../static/img/favicons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../../../../static/img/favicons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../../../../static/img/favicons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../../../../static/img/favicons/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="../../../../static/img/favicons/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../../../static/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="../../../../static/img/favicons/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../../../static/img/favicons/favicon-16x16.png">
<link rel="manifest" href="https://os.mbed.com/static/img/favicons/manifest.json">
<link rel="shortcut icon" href="https://os.mbed.com/static/img/favicon.ico?">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/static/img/favicons/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,700">

<link rel="stylesheet" href="../../../../static/CACHE/css/output.811e2930ab34.css" type="text/css">

<link href="../../../../static/docs/css/doc_viewer.css" rel="stylesheet">
<link href="../../../../static/fonts.css" rel="stylesheet">
<link href="../../../../static/docs-nav-and-footer1b26.css?v2" rel="stylesheet">


<link rel="canonical" href="_t_a_r_g_e_t___t_f_m_2_t_a_r_g_e_t___t_f_m___v1__0_2include_2psa_2crypto_8h_source.html">
<script src="../../../../static/mbed-nav-vertical-menu.js"></script>


    </head>
    <body>
        








<div class="mbed-nav">
    <div class="mbed-nav__mobile-menu-control">
        <i class="mbed-nav__mobile-menu-control-open fas fa-bars fa-fw"></i>
        <i class="mbed-nav__mobile-menu-control-close fas fa-times is-hidden fa-fw"></i>
        <i class="mbed-nav__mobile-menu-control-back fas fa-angle-left is-hidden fa-fw"></i>
    </div>
    <div class="mbed-nav__logo">
        <a href="https://os.mbed.com/">
            <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#logo"></use></svg>
        </a>
    </div>
    <div class="mbed-nav__menu">

        <!-- Main menu -->
        <nav class="mbed-nav__main-menu">
            <ul class="mbed-nav__dropdown-menu">
                <li class="has-dropdown">
                    Overview

                    <div class="mbed-nav__dropdown-menu-content">

                        <!-- Overview dropdown menu -->
                        <div class="mbed-nav__overview-menu">
                            <section>
                                <p>Operating system</p>
                                <ul>
                                    <li>
                                        <a href="https://os.mbed.com/mbed-os/" class="mbed-nav__icon-link-detail">
                                            <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#mbed_os"></use></svg>
                                            <div>
                                                <p>Mbed OS</p>
                                                <p>The open source OS for Cortex-M devices</p>
                                            </div>
                                        </a>
                                    </li>
                                </ul>
                            </section>

                            <section>
                                <p>Development tools</p>
                                <ul>
                                    <li>
                                        <a href="https://www.keil.arm.com/mbed/?utm_source=mbed_com&amp;utm_medium=compiler_button&amp;utm_campaign=mbed_com_promo" class="mbed-nav__icon-link-detail">
                                             <svg><use href="https://os.mbed.com/static/img/keil_studio_icon.2c56c28014c6.svg?#keil_studio_icon"></use></svg>
                                            <div>
                                                <p>Keil Studio Cloud</p>
                                                <p>Arm's IDE for IoT, embedded and Mbed development</p>
                                            </div>
                                         </a>
                                     </li>
                                    <li>
                                        <a href="https://os.mbed.com/studio/" class="mbed-nav__icon-link-detail">
                                            <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#mbed_studio"></use></svg>
                                            <div>
                                                <p>Mbed Studio</p>
                                                <p>Download the desktop IDE for Mbed OS</p>
                                            </div>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="https://os.mbed.com/docs/mbed-os/latest/quick-start/offline-with-mbed-cli.html" class="mbed-nav__icon-link-detail">

                                            <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#mbed_cli"></use></svg>
                                            <div>
                                               <p>Mbed CLI</p>
                                               <p>Command line access to Mbed tools and services</p>
                                            </div>
                                        </a>
                                    </li>
                                </ul>
                            </section>

                            <section>
                                <p>Security and Connectivity</p>
                                <ul>
                                    <li>
                                        <a href="https://tls.mbed.org/" class="mbed-nav__icon-link-detail">
                                            <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#mbed_tls_crypto"></use></svg>
                                            <div>
                                                <p>Mbed TLS and Mbed Crypto</p>
                                                <p>Industry standard TLS stack and crypto library</p>
                                            </div>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="https://os.mbed.com/connectivity-technologies/" class="mbed-nav__icon-link-detail">
                                            <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#connectivity"></use></svg>
                                            <div>
                                                <p>Connectivity</p>
                                                <p>BLE, WiFi, Cellular, LoRaWAN and more</p>
                                            </div>
                                        </a>
                                    </li>
                                </ul>
                            </section>
                        </div>
                    </div>
                </li>
                <li class="has-dropdown">
                    Hardware

                    <!-- Hardware dropdown menu -->
                    <div class="mbed-nav__dropdown-menu-content">
                        <div class="mbed-nav__hardware-dropdown">
                            <ul class="mbed-nav__hardware-menu">
                                <li>
                                    <a href="https://os.mbed.com/platforms/" class="mbed-nav__icon-link-detail">
                                        <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#boards"></use></svg>
                                        <div>
                                            <p>Boards</p>
                                            <p>Build your Mbed projects with development boards for Arm Cortex processors and MCUs</p>
                                        </div>
                                    </a>
                                </li>
                                <li>
                                    <a href="https://os.mbed.com/modules/" class="mbed-nav__icon-link-detail">
                                        <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#modules"></use></svg>
                                        <div>
                                            <p>Modules</p>
                                            <p>Modules include a MCU, connectivity and onboard memory, making them ideal for designing IoT products for mass production</p>
                                        </div>
                                    </a>
                                </li>
                                <li>
                                    <a href="https://os.mbed.com/components/" class="mbed-nav__icon-link-detail">
                                        <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#components"></use></svg>
                                        <div>
                                            <p>Components</p>
                                            <p>The component database hosts libraries for different sensors, actuators, radios, inputs, middleware and IoT services</p>
                                        </div>
                                    </a>
                                </li>
                                <li>
                                    <a href="https://os.mbed.com/hardware/" class="mbed-nav__icon-link-detail">
                                        <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#hardware_overview"></use></svg>
                                        <div>
                                            <p>Hardware overview & Mbed Enabled</p>
                                            <p>Learn about hardware support for Mbed, as well as the Mbed Enabled program, which identifies Mbed compatible products</p>
                                        </div>
                                    </a>
                                </li>
                                <li>
                                    <a href="https://os.mbed.com/docs/mbed-os/latest/porting/arm-mbed-hdk.html" class="mbed-nav__icon-link-detail">
                                        <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#mbed_hdk"></use></svg>
                                        <div>
                                            <p>Mbed HDK</p>
                                            <p>Reference designs, schematics and board layouts to develop production hardware and Mbed-compatible development boards</p>
                                        </div>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>

                </li>
                <li><a href="https://os.mbed.com/code/">Code</a></li>
                <li class="has-dropdown">
                    Documentation

                    <!-- Documentation dropdown menu -->
                    <div class="mbed-nav__dropdown-menu-content">
                        <div class="mbed-nav__documentation-dropdown">
                            <ul class="mbed-nav__documentation-menu">
                                <li>
                                    <a href="https://os.mbed.com/docs/mbed-os/">Mbed OS</a>
                                </li>
                                <li>
                                    <a
                                        href="https://developer.arm.com/documentation/102497/latest/Arm-Keil-Studio-Cloud">
                                        Keil Studio
                                    </a>
                                </li>
                                <li>
                                    <a href="https://os.mbed.com/docs/mbed-studio/">Mbed Studio</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </li>
                <li><a href="https://os.mbed.com/built-with-mbed/">Case studies</a></li>
                <li class="has-dropdown">
                    Community

                    <!-- Community dropdown menu -->
                    <div class="mbed-nav__dropdown-menu-content">
                        <div class="mbed-nav__community-dropdown">
                            <ul class="mbed-nav__community-menu">
                                <li>
                                    <a href="https://forums.mbed.com/">Forum</a>
                                </li>
                                <li>
                                    <a href="https://os.mbed.com/docs/mbed-os/latest/contributing/index.html">Contribute</a>
                                </li>
                                <li>
                                    <a href="https://www.youtube.com/playlist?list=PLKjl7IFAwc4R4plIZe4IuHlsn8zW7rvKh">Mbed OS Tech Forum</a>
                                </li>
                                <li>
                                    <a href="https://os.mbed.com/support/">Report a problem</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </li>
                <li>
                    <a href="https://os.mbed.com/blog/">Blog</a>
                </li>
            </ul>
        </nav>
    </div>
    <div class="mbed-nav__user-controls">
        <div class="mbed-nav__user-controls-top">
            <div class="mbed-nav__search">
                <form id="mbed-nav__search-box" class="is-hidden" action="https://os.mbed.com/search" method="GET">
                    <div class="mbed-nav__search-box">
                        <input type="search" name="q" placeholder="Search...">
                        <button type="submit">
                            <svg class="stroke-white"><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#search"></use></svg>
                        </button>
                    </div>
                </form>
                <i class="mbed-nav__search-close fas fa-times is-hidden"></i>
                <svg class="mbed-nav__search-open stroke-white"><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#search"></use></svg>
            </div>
            <a class="mbed-nav__cta" href="https://studio.keil.arm.com/mbed" target="_blank">
                Keil Studio Cloud
            </a>

            
                
                <nav class="mbed-nav__logged-out-nav">
                    <ul class="mbed-nav__dropdown-menu">
                        <li>
                            <svg class="stroke-white"><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#profile"></use></svg>

                            <!-- Logged out dropdown menu -->
                            <div class="mbed-nav__dropdown-menu-content">
                                <div class="mbed-nav__logged-out-dropdown">
                                    <ul class="mbed-nav__logged-out-menu">
                                        <li><a href="https://os.mbed.com/account/login/?next=/docs/mbed-os/v6.16/mbed-os-api-doxy/_t_a_r_g_e_t___t_f_m_2_t_a_r_g_e_t___t_f_m___v1__0_2include_2psa_2crypto_8h_source.html">Log in or Sign up</a></li>
                                    </ul>
                                </div>
                            </div>
                        </li>
                    </ul>
                </nav>
                
            
        </div>
    </div>
    <div class="mbed-nav__spacer"></div>
</div>
<div class="mbed-nav__mobile-menu-cover is-hidden">
    <div class="mbed-nav__mobile-menu">

        <div id="mbed-nav__main-menu-mobile">
            <div class="mbed-nav__user-controls-mobile">
                <div class="mbed-nav__user-controls-top-mobile">
                    <form action="https://os.mbed.com/search" method="GET">
                        <div class="mbed-nav__search-box mbed-nav__search-box--light">
                            <input type="search" name="q" placeholder="Search...">
                            <button type="submit">
                                <svg class="stroke-dark-grey"><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#search"></use></svg>
                            </button>
                        </div>
                    </form>
                    
                        
                        <a href="https://os.mbed.com/account/login/?next=/docs/mbed-os/v6.16/mbed-os-api-doxy/_t_a_r_g_e_t___t_f_m_2_t_a_r_g_e_t___t_f_m___v1__0_2include_2psa_2crypto_8h_source.html">Log in or Sign up</a>
                        
                    
                </div>
            </div>

            <ul class="mbed-nav__side-menu">
                <li>
                    <input type="checkbox" name="accordion-toggle" id="overview-accordion">
                    <label for="overview-accordion">Overview</label>
                    <div class="accordion_content">
                        <ul class="overview-menu-mobile">
                            <li>
                                <p>Operating system</p>
                                <ul>
                                    <li>
                                        <a href="https://os.mbed.com/mbed-os/" class="mbed-nav__icon-link">
                                            <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#mbed_os"></use></svg>
                                            <p>Mbed OS</p>
                                        </a>
                                    </li>
                                    

                                </ul>
                            </li>
                            <li>
                                <p>Development tools</p>
                                <ul>
                                    <li>
                                        <a href="https://os.mbed.com/studio/" class="mbed-nav__icon-link">
                                            <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#mbed_studio"></use></svg>
                                            <p>Mbed Studio</p>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="https://www.keil.arm.com/mbed/?utm_source=mbed_com&amp;utm_medium=compiler_button&amp;utm_campaign=mbed_com_promo" class="mbed-nav__icon-link">
                                             <svg><use href="https://os.mbed.com/static/img/keil_studio_icon.2c56c28014c6.svg?#keil_studio_icon"></use></svg>
                                            <p>Keil Studio</p>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="https://os.mbed.com/docs/mbed-os/latest/quick-start/offline-with-mbed-cli.html" class="mbed-nav__icon-link">
                                            <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#mbed_cli"></use></svg>
                                            <p>Mbed CLI</p>
                                        </a>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <p>Security and connectivity</p>
                                <ul>
                                    <li>
                                        <a href="https://tls.mbed.org/" class="mbed-nav__icon-link">
                                            <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#mbed_tls_crypto"></use></svg>
                                            <p>Mbed TLS and Mbed Crypto</p>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="https://os.mbed.com/connectivity-technologies/" class="mbed-nav__icon-link">
                                            <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#connectivity"></use></svg>
                                            <p>Connectivity</p>
                                        </a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </li>
                <li>
                    <input type="checkbox" name="accordion-toggle" id="hardware-accordion">
                    <label for="hardware-accordion">Hardware</label>
                    <div class="accordion_content">
                        <ul>
                            <li>
                                <a href="https://os.mbed.com/platforms/" class="mbed-nav__icon-link">
                                    <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#boards"></use></svg>
                                    <p>Boards</p>
                                </a>
                            </li>
                            <li>
                                <a href="https://os.mbed.com/modules/" class="mbed-nav__icon-link">
                                    <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#modules"></use></svg>
                                    <p>Modules</p>
                                </a>
                            </li>
                            <li>
                                <a href="https://os.mbed.com/components/" class="mbed-nav__icon-link">
                                    <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#components"></use></svg>
                                    <p>Components</p>
                                </a>
                            </li>
                            <li>
                                <a href="https://os.mbed.com/hardware/" class="mbed-nav__icon-link">
                                    <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#hardware_overview"></use></svg>
                                    <p>Hardware overview & Mbed Enabled</p>
                                </a>
                            </li>
                            <li>
                                <a href="https://os.mbed.com/docs/mbed-os/latest/porting/arm-mbed-hdk.html" class="mbed-nav__icon-link">
                                    <svg><use xlink:href="https://os.mbed.com/static/img/mbed_nav_spritesheet.8ac20221a123.svg?v3#mbed_hdk"></use></svg>
                                    <p>Mbed HDK</p>
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li><a href="https://os.mbed.com/code/">Code</a></li>
                <li>
                    <input type="checkbox" name="accordion-toggle" id="documentation-accordion">
                    <label for="documentation-accordion">Documentation</label>
                    <div class="accordion_content">
                        <ul>
                            <li><a href="https://os.mbed.com/docs/mbed-os/">Mbed OS</a></li>
                            <li><a href="https://os.mbed.com/docs/mbed-studio/">Mbed Studio</a></li>
                            <li>
                              <a
                                href="https://developer.arm.com/documentation/102497/1-5/Arm-Keil-Studio/?utm_source=mbed_com&amp;utm_medium=nav_docs_link&amp;utm_campaign=mbed_com_promo">
                                Keil Studio
                              </a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li><a href="https://os.mbed.com/built-with-mbed/">Case studies</a></li>
                <li>
                    <input type="checkbox" name="accordion-toggle" id="community-accordion">
                    <label for="community-accordion">Community</label>
                    <div class="accordion_content">
                        <ul>
                            <li><a href="https://forums.mbed.com/">Forum</a></li>
                            <li><a href="https://os.mbed.com/docs/mbed-os/latest/contributing/index.html">Contribute</a></li>
                            <li><a href="https://www.youtube.com/playlist?list=PLKjl7IFAwc4R4plIZe4IuHlsn8zW7rvKh">Mbed OS Tech Forum</a></li>
                            <li><a href="https://os.mbed.com/support/">Report a problem</a></li>
                        </ul>
                    </div>
                </li>
                <li><a href="https://os.mbed.com/blog/">Blog</a></li>
            </ul>
        </div>

        
    </div>
</div>



<div class="version-picker-container">
    
    <select class="version-picker" onchange="goToVersion(this.value)">
        
            <option
                value="v6.16"
                selected
            >
                v6.16
            </option>
        
            <option
                value="v6.15"
                
            >
                v6.15
            </option>
        
            <option
                value="v6.14"
                
            >
                v6.14
            </option>
        
            <option
                value="v6.13"
                
            >
                v6.13
            </option>
        
            <option
                value="v6.12"
                
            >
                v6.12
            </option>
        
            <option
                value="v6.11"
                
            >
                v6.11
            </option>
        
            <option
                value="v6.10"
                
            >
                v6.10
            </option>
        
            <option
                value="v6.9"
                
            >
                v6.9
            </option>
        
            <option
                value="v6.8"
                
            >
                v6.8
            </option>
        
            <option
                value="v6.7"
                
            >
                v6.7
            </option>
        
            <option
                value="v6.6"
                
            >
                v6.6
            </option>
        
            <option
                value="v6.5"
                
            >
                v6.5
            </option>
        
            <option
                value="v5.15"
                
            >
                v5.15
            </option>
        
    </select>
    

    <div class="contact-us">
        Mistake on this page?
        
            <br>
            <a href="https://github.com/ARMmbed/mbed-os-5-docs/issues">
                Report an issue in GitHub
                <i class="fab fa-github"></i>
            </a>
            or
            <a href="mailto:mbed-support@arm.com">
                email us
                <i class="fas fa-envelope"></i>
            </a>
        
    </div>
</div>

<script>
    function goToVersion(version) {
        window.location.href = window.location.href.replace(
            "v6.16",
            version
        )
    }
</script>

        
        <div class="topbar" id="top">
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div class="tabs" id="navrow1">
    <ul class="tablist">
      <li><a href="index.html"><span>Main Page</span></a></li>
      <li><a href="pages.html"><span>Related Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div class="MSearchBoxInactive" id="MSearchBox">
        <span class="left">
          <img alt="" id="MSearchSelect" onmouseout="return searchBox.OnSearchSelectHide()" onmouseover="return searchBox.OnSearchSelectShow()" src="search/mag_sel.png"/>
          <input accesskey="S" id="MSearchField" onblur="searchBox.OnSearchFieldFocus(false)" onfocus="searchBox.OnSearchFieldFocus(true)" onkeyup="searchBox.OnSearchFieldChange(event)" type="text" value="Search"/>
          </span><span class="right">
            <a href="javascript:searchBox.CloseResultsWindow()" id="MSearchClose"><img alt="" border="0" id="MSearchCloseImg" src="search/close.png"/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs2" id="navrow2">
    <ul class="tablist">
      <li><a href="files.html"><span>File List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow" onkeydown="return searchBox.OnSearchSelectKey(event)" onmouseout="return searchBox.OnSearchSelectHide()" onmouseover="return searchBox.OnSearchSelectShow()">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe frameborder="0" id="MSearchResults" name="MSearchResults" src="javascript:void(0)">
</iframe>
</div>

<div class="navpath" id="nav-path">
  <ul>
<li class="navelem"><a class="el" href="dir_5fdebfbd0a4b5643a5e85bf3c8b1558b.html">mbed-os</a></li><li class="navelem"><a class="el" href="dir_d00fafdb9414f6e624fcf4d73ffde065.html">platform</a></li><li class="navelem"><a class="el" href="dir_a72924067aea8bbead751f11070268f4.html">FEATURE_EXPERIMENTAL_API</a></li><li class="navelem"><a class="el" href="dir_007a19531d3d09289f9f9c2cf309e91b.html">FEATURE_PSA</a></li><li class="navelem"><a class="el" href="dir_f848b01736a8144ccc7db772a4ca6d7a.html">TARGET_TFM</a></li><li class="navelem"><a class="el" href="dir_179ed24d98e21ed857fe252ec9e77b9e.html">TARGET_TFM_V1_0</a></li><li class="navelem"><a class="el" href="dir_c3f11b31815f123df084370accf24566.html">include</a></li><li class="navelem"><a class="el" href="dir_d5d5846c8c53c719c665d2c77083ebdd.html">psa</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">TARGET_TFM/TARGET_TFM_V1_0/include/psa/crypto.h</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span> <span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span> <span class="comment"> * Copyright (c) 2018-2020, Arm Limited. All rights reserved.</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span> <span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span> <span class="comment"> * SPDX-License-Identifier: BSD-3-Clause</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span> <span class="comment"> *</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span> <span class="comment"> */</span><span class="comment"></span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span> <span class="comment">/**</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span> <span class="comment"> * \file psa/crypto.h</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span> <span class="comment"> * \brief Platform Security Architecture cryptography module</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span> <span class="comment"> */</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span> </div><div class="line"><a name="l00012"></a><span class="lineno">   12</span> <span class="preprocessor">#ifndef PSA_CRYPTO_H</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span> <span class="preprocessor">#define PSA_CRYPTO_H</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span> </div><div class="line"><a name="l00015"></a><span class="lineno">   15</span> <span class="preprocessor">#include "psa/crypto_platform.h"</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span> </div><div class="line"><a name="l00017"></a><span class="lineno">   17</span> <span class="preprocessor">#include &lt;stddef.h&gt;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span> </div><div class="line"><a name="l00019"></a><span class="lineno">   19</span> <span class="preprocessor">#ifdef __DOXYGEN_ONLY__</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span> <span class="comment">/* This __DOXYGEN_ONLY__ block contains mock definitions for things that</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span> <span class="comment"> * must be defined in the crypto_platform.h header. These mock definitions</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span> <span class="comment"> * are present in this file as a convenience to generate pretty-printed</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span> <span class="comment"> * documentation that includes those definitions. */</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span> <span class="comment"></span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span> <span class="comment">/** \defgroup platform Implementation-specific definitions</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span> <span class="comment"> * @{</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span> <span class="comment"> */</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span> <span class="comment"></span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span> <span class="comment">/** \brief Key handle.</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span> <span class="comment"> *</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span> <span class="comment"> * This type represents open handles to keys. It must be an unsigned integral</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span> <span class="comment"> * type. The choice of type is implementation-dependent.</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span> <span class="comment"> *</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span> <span class="comment"> * 0 is not a valid key handle. How other handle values are assigned is</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span> <span class="comment"> * implementation-dependent.</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span> <span class="comment"> */</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span> <span class="keyword">typedef</span> _unsigned_integral_type_ psa_key_handle_t;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span> <span class="comment"></span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span> <span class="comment">/**@}*/</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span> <span class="preprocessor">#endif </span><span class="comment">/* __DOXYGEN_ONLY__ */</span><span class="preprocessor"></span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span> </div><div class="line"><a name="l00042"></a><span class="lineno">   42</span> <span class="preprocessor">#ifdef __cplusplus</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span> <span class="keyword">extern</span> <span class="stringliteral">"C"</span> {</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span> <span class="preprocessor">#endif</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span> </div><div class="line"><a name="l00046"></a><span class="lineno">   46</span> <span class="comment">/* The file "crypto_types.h" declares types that encode errors,</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span> <span class="comment"> * algorithms, key types, policies, etc. */</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span> <span class="preprocessor">#include "psa/crypto_types.h"</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span> <span class="comment"></span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span> <span class="comment">/** \defgroup version API version</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span> <span class="comment"> * @{</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span> <span class="comment"> */</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span> <span class="comment"></span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span> <span class="comment">/**</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span> <span class="comment"> * The major version of this implementation of the PSA Crypto API</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span> <span class="comment"> */</span></div><div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="group__version.html#gac31060595fde8f06cb25184ca5689b75">   57</a></span> <span class="preprocessor">#define PSA_CRYPTO_API_VERSION_MAJOR 1</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span> <span class="comment"></span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span> <span class="comment">/**</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span> <span class="comment"> * The minor version of this implementation of the PSA Crypto API</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span> <span class="comment"> */</span></div><div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="group__version.html#ga154ccd72cff6c6c5a3a38c9a7027d3bf">   62</a></span> <span class="preprocessor">#define PSA_CRYPTO_API_VERSION_MINOR 0</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span> <span class="comment"></span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span> <span class="comment">/**@}*/</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span> </div><div class="line"><a name="l00066"></a><span class="lineno">   66</span> <span class="comment">/* The file "crypto_values.h" declares macros to build and analyze values</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span> <span class="comment"> * of integral types defined in "crypto_types.h". */</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span> <span class="preprocessor">#include "psa/crypto_values.h"</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span> <span class="comment"></span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span> <span class="comment">/** \defgroup initialization Library initialization</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span> <span class="comment"> * @{</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span> <span class="comment"> */</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span> <span class="comment"></span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span> <span class="comment">/**</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span> <span class="comment"> * \brief Library initialization.</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span> <span class="comment"> *</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span> <span class="comment"> * Applications must call this function before calling any other</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span> <span class="comment"> * function in this module.</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span> <span class="comment"> *</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span> <span class="comment"> * Applications may call this function more than once. Once a call</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span> <span class="comment"> * succeeds, subsequent calls are guaranteed to succeed.</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span> <span class="comment"> *</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span> <span class="comment"> * If the application calls other functions before calling psa_crypto_init(),</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span> <span class="comment"> * the behavior is undefined. Implementations are encouraged to either perform</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span> <span class="comment"> * the operation as if the library had been initialized or to return</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span> <span class="comment"> * #PSA_ERROR_BAD_STATE or some other applicable error. In particular,</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span> <span class="comment"> * implementations should not return a success status if the lack of</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span> <span class="comment"> * initialization may have security implications, for example due to improper</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span> <span class="comment"> * seeding of the random number generator.</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span> <span class="comment"> *</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_ENTROPY</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span> <span class="comment"> */</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__initialization.html#ga2de150803fc2f7dc6101d5af7e921dd9">psa_crypto_init</a>(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span> <span class="comment"></span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span> <span class="comment">/**@}*/</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span> <span class="comment"></span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span> <span class="comment">/** \addtogroup attributes</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span> <span class="comment"> * @{</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span> <span class="comment"> */</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span> <span class="comment"></span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span> <span class="comment">/** \def PSA_KEY_ATTRIBUTES_INIT</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span> <span class="comment"> *</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span> <span class="comment"> * This macro returns a suitable initializer for a key attribute structure</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span> <span class="comment"> * of type #psa_key_attributes_t.</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span> <span class="comment"> */</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span> <span class="preprocessor">#ifdef __DOXYGEN_ONLY__</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span> <span class="comment">/* This is an example definition for documentation purposes.</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span> <span class="comment"> * Implementations should define a suitable value in `crypto_struct.h`.</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span> <span class="comment"> */</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span> <span class="preprocessor">#define PSA_KEY_ATTRIBUTES_INIT {0}</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span> <span class="preprocessor">#endif</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span> <span class="comment"></span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span> <span class="comment">/** Return an initial value for a key attributes structure.</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span> <span class="comment"> */</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span> <span class="keyword">static</span> <a class="code" href="structpsa__key__attributes__s.html">psa_key_attributes_t</a> <a class="code" href="group__attributes.html#ga06966a8812aacd323ccdf06dbb43667d">psa_key_attributes_init</a>(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span> <span class="comment"></span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span> <span class="comment">/** Declare a key as persistent and set its key identifier.</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span> <span class="comment"> *</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span> <span class="comment"> * If the attribute structure currently declares the key as volatile (which</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span> <span class="comment"> * is the default content of an attribute structure), this function sets</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span> <span class="comment"> * the lifetime attribute to #PSA_KEY_LIFETIME_PERSISTENT.</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span> <span class="comment"> *</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span> <span class="comment"> * This function does not access storage, it merely stores the given</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span> <span class="comment"> * value in the structure.</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span> <span class="comment"> * The persistent key will be written to storage when the attribute</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span> <span class="comment"> * structure is passed to a key creation function such as</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span> <span class="comment"> * psa_import_key(), psa_generate_key(),</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span> <span class="comment"> * psa_key_derivation_output_key() or psa_copy_key().</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span> <span class="comment"> *</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span> <span class="comment"> * This function may be declared as `static` (i.e. without external</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span> <span class="comment"> * linkage). This function may be provided as a function-like macro,</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span> <span class="comment"> * but in this case it must evaluate each of its arguments exactly once.</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span> <span class="comment"> *</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span> <span class="comment"> * \param[out] attributes       The attribute structure to write to.</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span> <span class="comment"> * \param id                    The persistent identifier for the key.</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span> <span class="comment"> */</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__attributes.html#gae48fcfdc72a23e7499957d7f54ff5a64">psa_set_key_id</a>(<a class="code" href="structpsa__key__attributes__s.html">psa_key_attributes_t</a> *attributes,</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>                            <a class="code" href="group__key__lifetimes.html#ga11e986351c65bd3dc3c0fe2cd9926e4b">psa_key_id_t</a> <span class="keywordtype">id</span>);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span> <span class="comment"></span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span> <span class="comment">/** Set the location of a persistent key.</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span> <span class="comment"> *</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span> <span class="comment"> * To make a key persistent, you must give it a persistent key identifier</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span> <span class="comment"> * with psa_set_key_id(). By default, a key that has a persistent identifier</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span> <span class="comment"> * is stored in the default storage area identifier by</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span> <span class="comment"> * #PSA_KEY_LIFETIME_PERSISTENT. Call this function to choose a storage</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span> <span class="comment"> * area, or to explicitly declare the key as volatile.</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span> <span class="comment"> *</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span> <span class="comment"> * This function does not access storage, it merely stores the given</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span> <span class="comment"> * value in the structure.</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span> <span class="comment"> * The persistent key will be written to storage when the attribute</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span> <span class="comment"> * structure is passed to a key creation function such as</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span> <span class="comment"> * psa_import_key(), psa_generate_key(),</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span> <span class="comment"> * psa_key_derivation_output_key() or psa_copy_key().</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span> <span class="comment"> *</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span> <span class="comment"> * This function may be declared as `static` (i.e. without external</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span> <span class="comment"> * linkage). This function may be provided as a function-like macro,</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span> <span class="comment"> * but in this case it must evaluate each of its arguments exactly once.</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span> <span class="comment"> *</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span> <span class="comment"> * \param[out] attributes       The attribute structure to write to.</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span> <span class="comment"> * \param lifetime              The lifetime for the key.</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span> <span class="comment"> *                              If this is #PSA_KEY_LIFETIME_VOLATILE, the</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span> <span class="comment"> *                              key will be volatile, and the key identifier</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span> <span class="comment"> *                              attribute is reset to 0.</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span> <span class="comment"> */</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__attributes.html#gac03ccf09ca6d36cc3d5b43f8303db6f7">psa_set_key_lifetime</a>(<a class="code" href="structpsa__key__attributes__s.html">psa_key_attributes_t</a> *attributes,</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>                                  <a class="code" href="group__key__lifetimes.html#ga6821ff6dd39dc2bc370ded760ad8b0cf">psa_key_lifetime_t</a> lifetime);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span> <span class="comment"></span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span> <span class="comment">/** Retrieve the key identifier from key attributes.</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span> <span class="comment"> *</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span> <span class="comment"> * This function may be declared as `static` (i.e. without external</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span> <span class="comment"> * linkage). This function may be provided as a function-like macro,</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span> <span class="comment"> * but in this case it must evaluate its argument exactly once.</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span> <span class="comment"> *</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span> <span class="comment"> * \param[in] attributes        The key attribute structure to query.</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span> <span class="comment"> *</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span> <span class="comment"> * \return The persistent identifier stored in the attribute structure.</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span> <span class="comment"> *         This value is unspecified if the attribute structure declares</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span> <span class="comment"> *         the key as volatile.</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span> <span class="comment"> */</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span> <span class="keyword">static</span> <a class="code" href="group__key__lifetimes.html#ga11e986351c65bd3dc3c0fe2cd9926e4b">psa_key_id_t</a> <a class="code" href="group__attributes.html#gafd8a339ef75f9ec0f72c97edfc99a2a4">psa_get_key_id</a>(<span class="keyword">const</span> <a class="code" href="structpsa__key__attributes__s.html">psa_key_attributes_t</a> *attributes);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span> <span class="comment"></span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span> <span class="comment">/** Retrieve the lifetime from key attributes.</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span> <span class="comment"> *</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span> <span class="comment"> * This function may be declared as `static` (i.e. without external</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span> <span class="comment"> * linkage). This function may be provided as a function-like macro,</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span> <span class="comment"> * but in this case it must evaluate its argument exactly once.</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span> <span class="comment"> *</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span> <span class="comment"> * \param[in] attributes        The key attribute structure to query.</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span> <span class="comment"> *</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span> <span class="comment"> * \return The lifetime value stored in the attribute structure.</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span> <span class="comment"> */</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span> <span class="keyword">static</span> <a class="code" href="group__key__lifetimes.html#ga6821ff6dd39dc2bc370ded760ad8b0cf">psa_key_lifetime_t</a> <a class="code" href="group__attributes.html#ga9ea8eae1b81e480cc56dec858859aff9">psa_get_key_lifetime</a>(</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>     <span class="keyword">const</span> <a class="code" href="structpsa__key__attributes__s.html">psa_key_attributes_t</a> *attributes);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span> <span class="comment"></span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span> <span class="comment">/** Declare usage flags for a key.</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span> <span class="comment"> *</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span> <span class="comment"> * Usage flags are part of a key's usage policy. They encode what</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span> <span class="comment"> * kind of operations are permitted on the key. For more details,</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span> <span class="comment"> * refer to the documentation of the type #psa_key_usage_t.</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span> <span class="comment"> *</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span> <span class="comment"> * This function overwrites any usage flags</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span> <span class="comment"> * previously set in \p attributes.</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span> <span class="comment"> *</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span> <span class="comment"> * This function may be declared as `static` (i.e. without external</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span> <span class="comment"> * linkage). This function may be provided as a function-like macro,</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span> <span class="comment"> * but in this case it must evaluate each of its arguments exactly once.</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span> <span class="comment"> *</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span> <span class="comment"> * \param[out] attributes       The attribute structure to write to.</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span> <span class="comment"> * \param usage_flags           The usage flags to write.</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span> <span class="comment"> */</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__attributes.html#ga42a65b3c4522ce9b67ea5ea7720e17de">psa_set_key_usage_flags</a>(<a class="code" href="structpsa__key__attributes__s.html">psa_key_attributes_t</a> *attributes,</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>                                     <a class="code" href="group__policy.html#ga7bb9de71337e0e98de843aa7f9b55f25">psa_key_usage_t</a> usage_flags);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span> <span class="comment"></span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span> <span class="comment">/** Retrieve the usage flags from key attributes.</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span> <span class="comment"> *</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span> <span class="comment"> * This function may be declared as `static` (i.e. without external</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span> <span class="comment"> * linkage). This function may be provided as a function-like macro,</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span> <span class="comment"> * but in this case it must evaluate its argument exactly once.</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span> <span class="comment"> *</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span> <span class="comment"> * \param[in] attributes        The key attribute structure to query.</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span> <span class="comment"> *</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span> <span class="comment"> * \return The usage flags stored in the attribute structure.</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span> <span class="comment"> */</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span> <span class="keyword">static</span> <a class="code" href="group__policy.html#ga7bb9de71337e0e98de843aa7f9b55f25">psa_key_usage_t</a> <a class="code" href="group__attributes.html#gaa1af20f142ca722222c6d98678a0c448">psa_get_key_usage_flags</a>(</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>     <span class="keyword">const</span> <a class="code" href="structpsa__key__attributes__s.html">psa_key_attributes_t</a> *attributes);</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span> <span class="comment"></span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span> <span class="comment">/** Declare the permitted algorithm policy for a key.</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span> <span class="comment"> *</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span> <span class="comment"> * The permitted algorithm policy of a key encodes which algorithm or</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span> <span class="comment"> * algorithms are permitted to be used with this key. The following</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span> <span class="comment"> * algorithm policies are supported:</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span> <span class="comment"> * - 0 does not allow any cryptographic operation with the key. The key</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span> <span class="comment"> *   may be used for non-cryptographic actions such as exporting (if</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span> <span class="comment"> *   permitted by the usage flags).</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span> <span class="comment"> * - An algorithm value permits this particular algorithm.</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span> <span class="comment"> * - An algorithm wildcard built from #PSA_ALG_ANY_HASH allows the specified</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span> <span class="comment"> *   signature scheme with any hash algorithm.</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span> <span class="comment"> *</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span> <span class="comment"> * This function overwrites any algorithm policy</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span> <span class="comment"> * previously set in \p attributes.</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span> <span class="comment"> *</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span> <span class="comment"> * This function may be declared as `static` (i.e. without external</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span> <span class="comment"> * linkage). This function may be provided as a function-like macro,</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span> <span class="comment"> * but in this case it must evaluate each of its arguments exactly once.</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span> <span class="comment"> *</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span> <span class="comment"> * \param[out] attributes       The attribute structure to write to.</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span> <span class="comment"> * \param alg                   The permitted algorithm policy to write.</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span> <span class="comment"> */</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__attributes.html#gaeb8341ca52baa0279475ea3fd3bcdc98">psa_set_key_algorithm</a>(<a class="code" href="structpsa__key__attributes__s.html">psa_key_attributes_t</a> *attributes,</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>                                   <a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> alg);</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span> </div><div class="line"><a name="l00257"></a><span class="lineno">  257</span> <span class="comment"></span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span> <span class="comment">/** Retrieve the algorithm policy from key attributes.</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span> <span class="comment"> *</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span> <span class="comment"> * This function may be declared as `static` (i.e. without external</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span> <span class="comment"> * linkage). This function may be provided as a function-like macro,</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span> <span class="comment"> * but in this case it must evaluate its argument exactly once.</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span> <span class="comment"> *</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span> <span class="comment"> * \param[in] attributes        The key attribute structure to query.</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span> <span class="comment"> *</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span> <span class="comment"> * \return The algorithm stored in the attribute structure.</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span> <span class="comment"> */</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span> <span class="keyword">static</span> <a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> <a class="code" href="group__attributes.html#gac255da850a00bbed925390044f016b34">psa_get_key_algorithm</a>(</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>     <span class="keyword">const</span> <a class="code" href="structpsa__key__attributes__s.html">psa_key_attributes_t</a> *attributes);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span> <span class="comment"></span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span> <span class="comment">/** Declare the type of a key.</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span> <span class="comment"> *</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span> <span class="comment"> * This function overwrites any key type</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span> <span class="comment"> * previously set in \p attributes.</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span> <span class="comment"> *</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span> <span class="comment"> * This function may be declared as `static` (i.e. without external</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span> <span class="comment"> * linkage). This function may be provided as a function-like macro,</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span> <span class="comment"> * but in this case it must evaluate each of its arguments exactly once.</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span> <span class="comment"> *</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span> <span class="comment"> * \param[out] attributes       The attribute structure to write to.</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span> <span class="comment"> * \param type                  The key type to write.</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span> <span class="comment"> *                              If this is 0, the key type in \p attributes</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span> <span class="comment"> *                              becomes unspecified.</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span> <span class="comment"> */</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__attributes.html#ga6857ef0ecb3fa844d4536939d9c64025">psa_set_key_type</a>(<a class="code" href="structpsa__key__attributes__s.html">psa_key_attributes_t</a> *attributes,</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>                              <a class="code" href="group__crypto__types.html#ga63fce6880ca5933b5d6baa257febf1f6">psa_key_type_t</a> type);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span> </div><div class="line"><a name="l00288"></a><span class="lineno">  288</span> <span class="comment"></span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span> <span class="comment">/** Declare the size of a key.</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span> <span class="comment"> *</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span> <span class="comment"> * This function overwrites any key size previously set in \p attributes.</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span> <span class="comment"> *</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span> <span class="comment"> * This function may be declared as `static` (i.e. without external</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span> <span class="comment"> * linkage). This function may be provided as a function-like macro,</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span> <span class="comment"> * but in this case it must evaluate each of its arguments exactly once.</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span> <span class="comment"> *</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span> <span class="comment"> * \param[out] attributes       The attribute structure to write to.</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span> <span class="comment"> * \param bits                  The key size in bits.</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span> <span class="comment"> *                              If this is 0, the key size in \p attributes</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span> <span class="comment"> *                              becomes unspecified. Keys of size 0 are</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span> <span class="comment"> *                              not supported.</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span> <span class="comment"> */</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="group__attributes.html#gaf61683ac87f87687a40262b5afbfa018">psa_set_key_bits</a>(<a class="code" href="structpsa__key__attributes__s.html">psa_key_attributes_t</a> *attributes,</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>                              <span class="keywordtype">size_t</span> bits);</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span> <span class="comment"></span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span> <span class="comment">/** Retrieve the key type from key attributes.</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span> <span class="comment"> *</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span> <span class="comment"> * This function may be declared as `static` (i.e. without external</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span> <span class="comment"> * linkage). This function may be provided as a function-like macro,</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span> <span class="comment"> * but in this case it must evaluate its argument exactly once.</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span> <span class="comment"> *</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span> <span class="comment"> * \param[in] attributes        The key attribute structure to query.</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span> <span class="comment"> *</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span> <span class="comment"> * \return The key type stored in the attribute structure.</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span> <span class="comment"> */</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span> <span class="keyword">static</span> <a class="code" href="group__crypto__types.html#ga63fce6880ca5933b5d6baa257febf1f6">psa_key_type_t</a> <a class="code" href="group__attributes.html#gae4fb812af4f57aa1ad85e335a865b918">psa_get_key_type</a>(<span class="keyword">const</span> <a class="code" href="structpsa__key__attributes__s.html">psa_key_attributes_t</a> *attributes);</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span> <span class="comment"></span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span> <span class="comment">/** Retrieve the key size from key attributes.</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span> <span class="comment"> *</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span> <span class="comment"> * This function may be declared as `static` (i.e. without external</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span> <span class="comment"> * linkage). This function may be provided as a function-like macro,</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span> <span class="comment"> * but in this case it must evaluate its argument exactly once.</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span> <span class="comment"> *</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span> <span class="comment"> * \param[in] attributes        The key attribute structure to query.</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span> <span class="comment"> *</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span> <span class="comment"> * \return The key size stored in the attribute structure, in bits.</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span> <span class="comment"> */</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span> <span class="keyword">static</span> <span class="keywordtype">size_t</span> <a class="code" href="group__attributes.html#ga5bee85c2164ad3d4c0d42501241eeb06">psa_get_key_bits</a>(<span class="keyword">const</span> <a class="code" href="structpsa__key__attributes__s.html">psa_key_attributes_t</a> *attributes);</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span> <span class="comment"></span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span> <span class="comment">/** Retrieve the attributes of a key.</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span> <span class="comment"> *</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span> <span class="comment"> * This function first resets the attribute structure as with</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span> <span class="comment"> * psa_reset_key_attributes(). It then copies the attributes of</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span> <span class="comment"> * the given key into the given attribute structure.</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span> <span class="comment"> *</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span> <span class="comment"> * \note This function may allocate memory or other resources.</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span> <span class="comment"> *       Once you have called this function on an attribute structure,</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span> <span class="comment"> *       you must call psa_reset_key_attributes() to free these resources.</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span> <span class="comment"> *</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span> <span class="comment"> * \param[in] handle            Handle to the key to query.</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span> <span class="comment"> * \param[in,out] attributes    On success, the attributes of the key.</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span> <span class="comment"> *                              On failure, equivalent to a</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span> <span class="comment"> *                              freshly-initialized structure.</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span> <span class="comment"> *</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span> <span class="comment"> */</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__attributes.html#gacbbf5c11eac6cd70c87ffb936e1b9be2">psa_get_key_attributes</a>(psa_key_handle_t handle,</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>                                     <a class="code" href="structpsa__key__attributes__s.html">psa_key_attributes_t</a> *attributes);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span> <span class="comment"></span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span> <span class="comment">/** Reset a key attribute structure to a freshly initialized state.</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span> <span class="comment"> *</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span> <span class="comment"> * You must initialize the attribute structure as described in the</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span> <span class="comment"> * documentation of the type #psa_key_attributes_t before calling this</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span> <span class="comment"> * function. Once the structure has been initialized, you may call this</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span> <span class="comment"> * function at any time.</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span> <span class="comment"> *</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span> <span class="comment"> * This function frees any auxiliary resources that the structure</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span> <span class="comment"> * may contain.</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span> <span class="comment"> *</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span> <span class="comment"> * \param[in,out] attributes    The attribute structure to reset.</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span> <span class="comment"> */</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span> <span class="keywordtype">void</span> <a class="code" href="group__attributes.html#ga382b7f11fc6d706645cefea22c3bd458">psa_reset_key_attributes</a>(<a class="code" href="structpsa__key__attributes__s.html">psa_key_attributes_t</a> *attributes);</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span> <span class="comment"></span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span> <span class="comment">/**@}*/</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span> <span class="comment"></span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span> <span class="comment">/** \defgroup key_management Key management</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span> <span class="comment"> * @{</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span> <span class="comment"> */</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span> <span class="comment"></span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span> <span class="comment">/** Open a handle to an existing persistent key.</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span> <span class="comment"> *</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span> <span class="comment"> * Open a handle to a persistent key. A key is persistent if it was created</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span> <span class="comment"> * with a lifetime other than #PSA_KEY_LIFETIME_VOLATILE. A persistent key</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span> <span class="comment"> * always has a nonzero key identifier, set with psa_set_key_id() when</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span> <span class="comment"> * creating the key. Implementations may provide additional pre-provisioned</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span> <span class="comment"> * keys that can be opened with psa_open_key(). Such keys have a key identifier</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span> <span class="comment"> * in the vendor range, as documented in the description of #psa_key_id_t.</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span> <span class="comment"> *</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span> <span class="comment"> * The application must eventually close the handle with psa_close_key() or</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span> <span class="comment"> * psa_destroy_key() to release associated resources. If the application dies</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span> <span class="comment"> * without calling one of these functions, the implementation should perform</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span> <span class="comment"> * the equivalent of a call to psa_close_key().</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span> <span class="comment"> *</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span> <span class="comment"> * Some implementations permit an application to open the same key multiple</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span> <span class="comment"> * times. If this is successful, each call to psa_open_key() will return a</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span> <span class="comment"> * different key handle.</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span> <span class="comment"> *</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span> <span class="comment"> * \note Applications that rely on opening a key multiple times will not be</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span> <span class="comment"> * portable to implementations that only permit a single key handle to be</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span> <span class="comment"> * opened. See also :ref:\`key-handles\`.</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span> <span class="comment"> *</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span> <span class="comment"> * \param id            The persistent identifier of the key.</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span> <span class="comment"> * \param[out] handle   On success, a handle to the key.</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span> <span class="comment"> *</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span> <span class="comment"> *         Success. The application can now use the value of `*handle`</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span> <span class="comment"> *         to access the key.</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span> <span class="comment"> *         The implementation does not have sufficient resources to open the</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span> <span class="comment"> *         key. This can be due to reaching an implementation limit on the</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span> <span class="comment"> *         number of open keys, the number of open key handles, or available</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span> <span class="comment"> *         memory.</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span> <span class="comment"> * \retval #PSA_ERROR_DOES_NOT_EXIST</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span> <span class="comment"> *         There is no persistent key with key identifier \p id.</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span> <span class="comment"> *         \p id is not a valid persistent key identifier.</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span> <span class="comment"> *         The specified key exists, but the application does not have the</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span> <span class="comment"> *         permission to access it. Note that this specification does not</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span> <span class="comment"> *         define any way to create such a key, but it may be possible</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span> <span class="comment"> *         through implementation-specific means.</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span> <span class="comment"> */</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__key__management.html#gac161d9a354209b0bdaf1f302bf4619d3">psa_open_key</a>(<a class="code" href="group__key__lifetimes.html#ga11e986351c65bd3dc3c0fe2cd9926e4b">psa_key_id_t</a> <span class="keywordtype">id</span>,</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>                           psa_key_handle_t *handle);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span> </div><div class="line"><a name="l00432"></a><span class="lineno">  432</span> <span class="comment"></span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span> <span class="comment">/** Close a key handle.</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span> <span class="comment"> *</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span> <span class="comment"> * If the handle designates a volatile key, this will destroy the key material</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span> <span class="comment"> * and free all associated resources, just like psa_destroy_key().</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span> <span class="comment"> *</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span> <span class="comment"> * If this is the last open handle to a persistent key, then closing the handle</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span> <span class="comment"> * will free all resources associated with the key in volatile memory. The key</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span> <span class="comment"> * data in persistent storage is not affected and can be opened again later</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span> <span class="comment"> * with a call to psa_open_key().</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span> <span class="comment"> *</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span> <span class="comment"> * Closing the key handle makes the handle invalid, and the key handle</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span> <span class="comment"> * must not be used again by the application.</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span> <span class="comment"> *</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span> <span class="comment"> * \note If the key handle was used to set up an active</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span> <span class="comment"> * :ref:\`multipart operation &lt;multipart-operations&gt;\`, then closing the</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span> <span class="comment"> * key handle can cause the multipart operation to fail. Applications should</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span> <span class="comment"> * maintain the key handle until after the multipart operation has finished.</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span> <span class="comment"> *</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span> <span class="comment"> * \param handle        The key handle to close.</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span> <span class="comment"> *                      If this is \c 0, do nothing and return \c PSA_SUCCESS.</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span> <span class="comment"> *</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span> <span class="comment"> *         \p handle was a valid handle or \c 0. It is now closed.</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span> <span class="comment"> *         \p handle is not a valid handle nor \c 0.</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span> <span class="comment"> */</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__key__management.html#gaa09b720d299dfe6b9f41c36e448078eb">psa_close_key</a>(psa_key_handle_t handle);</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span> <span class="comment"></span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span> <span class="comment">/** Make a copy of a key.</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span> <span class="comment"> *</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span> <span class="comment"> * Copy key material from one location to another.</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span> <span class="comment"> *</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span> <span class="comment"> * This function is primarily useful to copy a key from one location</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span> <span class="comment"> * to another, since it populates a key using the material from</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span> <span class="comment"> * another key which may have a different lifetime.</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span> <span class="comment"> *</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span> <span class="comment"> * This function may be used to share a key with a different party,</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span> <span class="comment"> * subject to implementation-defined restrictions on key sharing.</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span> <span class="comment"> *</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span> <span class="comment"> * The policy on the source key must have the usage flag</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span> <span class="comment"> * #PSA_KEY_USAGE_COPY set.</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span> <span class="comment"> * This flag is sufficient to permit the copy if the key has the lifetime</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span> <span class="comment"> * #PSA_KEY_LIFETIME_VOLATILE or #PSA_KEY_LIFETIME_PERSISTENT.</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span> <span class="comment"> * Some secure elements do not provide a way to copy a key without</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span> <span class="comment"> * making it extractable from the secure element. If a key is located</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span> <span class="comment"> * in such a secure element, then the key must have both usage flags</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span> <span class="comment"> * #PSA_KEY_USAGE_COPY and #PSA_KEY_USAGE_EXPORT in order to make</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span> <span class="comment"> * a copy of the key outside the secure element.</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span> <span class="comment"> *</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span> <span class="comment"> * The resulting key may only be used in a way that conforms to</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span> <span class="comment"> * both the policy of the original key and the policy specified in</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span> <span class="comment"> * the \p attributes parameter:</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span> <span class="comment"> * - The usage flags on the resulting key are the bitwise-and of the</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span> <span class="comment"> *   usage flags on the source policy and the usage flags in \p attributes.</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span> <span class="comment"> * - If both allow the same algorithm or wildcard-based</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span> <span class="comment"> *   algorithm policy, the resulting key has the same algorithm policy.</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span> <span class="comment"> * - If either of the policies allows an algorithm and the other policy</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span> <span class="comment"> *   allows a wildcard-based algorithm policy that includes this algorithm,</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span> <span class="comment"> *   the resulting key allows the same algorithm.</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span> <span class="comment"> * - If the policies do not allow any algorithm in common, this function</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span> <span class="comment"> *   fails with the status #PSA_ERROR_INVALID_ARGUMENT.</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span> <span class="comment"> *</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span> <span class="comment"> * The effect of this function on implementation-defined attributes is</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span> <span class="comment"> * implementation-defined.</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span> <span class="comment"> *</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span> <span class="comment"> * \param source_handle     The key to copy. It must be a valid key handle.</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span> <span class="comment"> * \param[in] attributes    The attributes for the new key.</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span> <span class="comment"> *                          They are used as follows:</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span> <span class="comment"> *                          - The key type and size may be 0. If either is</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span> <span class="comment"> *                            nonzero, it must match the corresponding</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span> <span class="comment"> *                            attribute of the source key.</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span> <span class="comment"> *                          - The key location (the lifetime and, for</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span> <span class="comment"> *                            persistent keys, the key identifier) is</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span> <span class="comment"> *                            used directly.</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span> <span class="comment"> *                          - The policy constraints (usage flags and</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span> <span class="comment"> *                            algorithm policy) are combined from</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span> <span class="comment"> *                            the source key and \p attributes so that</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span> <span class="comment"> *                            both sets of restrictions apply, as</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span> <span class="comment"> *                            described in the documentation of this function.</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span> <span class="comment"> * \param[out] target_handle On success, a handle to the newly created key.</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span> <span class="comment"> *                          \c 0 on failure.</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span> <span class="comment"> *</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span> <span class="comment"> *         \p source_handle is invalid.</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span> <span class="comment"> * \retval #PSA_ERROR_ALREADY_EXISTS</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span> <span class="comment"> *         This is an attempt to create a persistent key, and there is</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span> <span class="comment"> *         already a persistent key with the given identifier.</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span> <span class="comment"> *         The lifetime or identifier in \p attributes are invalid.</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span> <span class="comment"> *         The policy constraints on the source and specified in</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span> <span class="comment"> *         \p attributes are incompatible.</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span> <span class="comment"> *         \p attributes specifies a key type or key size</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span> <span class="comment"> *         which does not match the attributes of the source key.</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span> <span class="comment"> *         The source key does not have the #PSA_KEY_USAGE_COPY usage flag.</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span> <span class="comment"> *         The source key is not exportable and its lifetime does not</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span> <span class="comment"> *         allow copying it to the target's lifetime.</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_STORAGE</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span> <span class="comment"> */</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__key__management.html#gaac27a547ca634d439e89b17aacc99943">psa_copy_key</a>(psa_key_handle_t source_handle,</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>                           <span class="keyword">const</span> <a class="code" href="structpsa__key__attributes__s.html">psa_key_attributes_t</a> *attributes,</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>                           psa_key_handle_t *target_handle);</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span> </div><div class="line"><a name="l00555"></a><span class="lineno">  555</span> <span class="comment"></span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span> <span class="comment">/**</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span> <span class="comment"> * \brief Destroy a key.</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span> <span class="comment"> *</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span> <span class="comment"> * This function destroys a key from both volatile</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span> <span class="comment"> * memory and, if applicable, non-volatile storage. Implementations shall</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span> <span class="comment"> * make a best effort to ensure that that the key material cannot be recovered.</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span> <span class="comment"> *</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span> <span class="comment"> * This function also erases any metadata such as policies and frees</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span> <span class="comment"> * resources associated with the key. To free all resources associated with</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span> <span class="comment"> * the key, all handles to the key must be closed or destroyed.</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span> <span class="comment"> *</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span> <span class="comment"> * Destroying the key makes the handle invalid, and the key handle</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span> <span class="comment"> * must not be used again by the application. Using other open handles to the</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span> <span class="comment"> * destroyed key in a cryptographic operation will result in an error.</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span> <span class="comment"> *</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span> <span class="comment"> * If a key is currently in use in a multipart operation, then destroying the</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span> <span class="comment"> * key will cause the multipart operation to fail.</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span> <span class="comment"> *</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span> <span class="comment"> * \param handle        Handle to the key to erase.</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span> <span class="comment"> *                      If this is \c 0, do nothing and return \c PSA_SUCCESS.</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span> <span class="comment"> *</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span> <span class="comment"> *         \p handle was a valid handle and the key material that it</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span> <span class="comment"> *         referred to has been erased.</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span> <span class="comment"> *         Alternatively, \p handle is \c 0.</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span> <span class="comment"> *         The key cannot be erased because it is</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span> <span class="comment"> *         read-only, either due to a policy or due to physical restrictions.</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span> <span class="comment"> *         \p handle is not a valid handle nor \c 0.</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span> <span class="comment"> *         There was an failure in communication with the cryptoprocessor.</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span> <span class="comment"> *         The key material may still be present in the cryptoprocessor.</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span> <span class="comment"> *         The storage is corrupted. Implementations shall make a best effort</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span> <span class="comment"> *         to erase key material even in this stage, however applications</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span> <span class="comment"> *         should be aware that it may be impossible to guarantee that the</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span> <span class="comment"> *         key material is not recoverable in such cases.</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span> <span class="comment"> *         An unexpected condition which is not a storage corruption or</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span> <span class="comment"> *         a communication failure occurred. The cryptoprocessor may have</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span> <span class="comment"> *         been compromised.</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span> <span class="comment"> */</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__key__management.html#ga5f52644312291335682fbc0292c43cd2">psa_destroy_key</a>(psa_key_handle_t handle);</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span> <span class="comment"></span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span> <span class="comment">/**@}*/</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span> <span class="comment"></span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span> <span class="comment">/** \defgroup import_export Key import and export</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span> <span class="comment"> * @{</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span> <span class="comment"> */</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span> <span class="comment"></span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span> <span class="comment">/**</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span> <span class="comment"> * \brief Import a key in binary format.</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span> <span class="comment"> *</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span> <span class="comment"> * This function supports any output from psa_export_key(). Refer to the</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span> <span class="comment"> * documentation of psa_export_public_key() for the format of public keys</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span> <span class="comment"> * and to the documentation of psa_export_key() for the format for</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span> <span class="comment"> * other key types.</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span> <span class="comment"> *</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span> <span class="comment"> * The key data determines the key size. The attributes may optionally</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span> <span class="comment"> * specify a key size; in this case it must match the size determined</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span> <span class="comment"> * from the key data. A key size of 0 in \p attributes indicates that</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span> <span class="comment"> * the key size is solely determined by the key data.</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span> <span class="comment"> *</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span> <span class="comment"> * Implementations must reject an attempt to import a key of size 0.</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span> <span class="comment"> *</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span> <span class="comment"> * This specification supports a single format for each key type.</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span> <span class="comment"> * Implementations may support other formats as long as the standard</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span> <span class="comment"> * format is supported. Implementations that support other formats</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span> <span class="comment"> * should ensure that the formats are clearly unambiguous so as to</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span> <span class="comment"> * minimize the risk that an invalid input is accidentally interpreted</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span> <span class="comment"> * according to a different format.</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span> <span class="comment"> *</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span> <span class="comment"> * \param[in] attributes    The attributes for the new key.</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span> <span class="comment"> *                          The key size is always determined from the</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span> <span class="comment"> *                          \p data buffer.</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span> <span class="comment"> *                          If the key size in \p attributes is nonzero,</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span> <span class="comment"> *                          it must be equal to the size from \p data.</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span> <span class="comment"> * \param[out] handle       On success, a handle to the newly created key.</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span> <span class="comment"> *                          \c 0 on failure.</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span> <span class="comment"> * \param[in] data    Buffer containing the key data. The content of this</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span> <span class="comment"> *                    buffer is interpreted according to the type declared</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span> <span class="comment"> *                    in \p attributes.</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span> <span class="comment"> *                    All implementations must support at least the format</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span> <span class="comment"> *                    described in the documentation</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span> <span class="comment"> *                    of psa_export_key() or psa_export_public_key() for</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span> <span class="comment"> *                    the chosen type. Implementations may allow other</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span> <span class="comment"> *                    formats, but should be conservative: implementations</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span> <span class="comment"> *                    should err on the side of rejecting content if it</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span> <span class="comment"> *                    may be erroneous (e.g. wrong type or truncated data).</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span> <span class="comment"> * \param data_length Size of the \p data buffer in bytes.</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span> <span class="comment"> *</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span> <span class="comment"> *         If the key is persistent, the key material and the key's metadata</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span> <span class="comment"> *         have been saved to persistent storage.</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span> <span class="comment"> * \retval #PSA_ERROR_ALREADY_EXISTS</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span> <span class="comment"> *         This is an attempt to create a persistent key, and there is</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span> <span class="comment"> *         already a persistent key with the given identifier.</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span> <span class="comment"> *         The key type or key size is not supported, either by the</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span> <span class="comment"> *         implementation in general or in this particular persistent location.</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span> <span class="comment"> *         The key attributes, as a whole, are invalid.</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span> <span class="comment"> *         The key data is not correctly formatted.</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span> <span class="comment"> *         The size in \p attributes is nonzero and does not match the size</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span> <span class="comment"> *         of the key data.</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_STORAGE</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span> <span class="comment"> */</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__import__export.html#ga0336ea76bf30587ab204a8296462327b">psa_import_key</a>(<span class="keyword">const</span> <a class="code" href="structpsa__key__attributes__s.html">psa_key_attributes_t</a> *attributes,</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>                             <span class="keyword">const</span> uint8_t *data,</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>                             <span class="keywordtype">size_t</span> data_length,</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>                             psa_key_handle_t *handle);</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span> </div><div class="line"><a name="l00685"></a><span class="lineno">  685</span> </div><div class="line"><a name="l00686"></a><span class="lineno">  686</span> <span class="comment"></span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span> <span class="comment">/**</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span> <span class="comment"> * \brief Export a key in binary format.</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span> <span class="comment"> *</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span> <span class="comment"> * The output of this function can be passed to psa_import_key() to</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span> <span class="comment"> * create an equivalent object.</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span> <span class="comment"> *</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span> <span class="comment"> * If the implementation of psa_import_key() supports other formats</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span> <span class="comment"> * beyond the format specified here, the output from psa_export_key()</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span> <span class="comment"> * must use the representation specified here, not the original</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span> <span class="comment"> * representation.</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span> <span class="comment"> *</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span> <span class="comment"> * For standard key types, the output format is as follows:</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span> <span class="comment"> *</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span> <span class="comment"> * - For symmetric keys (including MAC keys), the format is the</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span> <span class="comment"> *   raw bytes of the key.</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span> <span class="comment"> * - For DES, the key data consists of 8 bytes. The parity bits must be</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span> <span class="comment"> *   correct.</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span> <span class="comment"> * - For Triple-DES, the format is the concatenation of the</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span> <span class="comment"> *   two or three DES keys.</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span> <span class="comment"> * - For RSA key pairs (#PSA_KEY_TYPE_RSA_KEY_PAIR), the format</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span> <span class="comment"> *   is the non-encrypted DER encoding of the representation defined by</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span> <span class="comment"> *   PKCS\#1 (RFC 8017) as `RSAPrivateKey`, version 0.</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span> <span class="comment"> *   ```</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span> <span class="comment"> *   RSAPrivateKey ::= SEQUENCE {</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span> <span class="comment"> *       version             INTEGER,  -- must be 0</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span> <span class="comment"> *       modulus             INTEGER,  -- n</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span> <span class="comment"> *       publicExponent      INTEGER,  -- e</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span> <span class="comment"> *       privateExponent     INTEGER,  -- d</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span> <span class="comment"> *       prime1              INTEGER,  -- p</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span> <span class="comment"> *       prime2              INTEGER,  -- q</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span> <span class="comment"> *       exponent1           INTEGER,  -- d mod (p-1)</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span> <span class="comment"> *       exponent2           INTEGER,  -- d mod (q-1)</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span> <span class="comment"> *       coefficient         INTEGER,  -- (inverse of q) mod p</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span> <span class="comment"> *   }</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span> <span class="comment"> *   ```</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span> <span class="comment"> * - For elliptic curve key pairs (key types for which</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span> <span class="comment"> *   #PSA_KEY_TYPE_IS_ECC_KEY_PAIR is true), the format is</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span> <span class="comment"> *   a representation of the private value as a `ceiling(m/8)`-byte string</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span> <span class="comment"> *   where `m` is the bit size associated with the curve, i.e. the bit size</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span> <span class="comment"> *   of the order of the curve's coordinate field. This byte string is</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span> <span class="comment"> *   in little-endian order for Montgomery curves (curve types</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span> <span class="comment"> *   `PSA_ECC_CURVE_CURVEXXX`), and in big-endian order for Weierstrass</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span> <span class="comment"> *   curves (curve types `PSA_ECC_CURVE_SECTXXX`, `PSA_ECC_CURVE_SECPXXX`</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span> <span class="comment"> *   and `PSA_ECC_CURVE_BRAINPOOL_PXXX`).</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span> <span class="comment"> *   This is the content of the `privateKey` field of the `ECPrivateKey`</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span> <span class="comment"> *   format defined by RFC 5915.</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span> <span class="comment"> * - For Diffie-Hellman key exchange key pairs (key types for which</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span> <span class="comment"> *   #PSA_KEY_TYPE_IS_DH_KEY_PAIR is true), the</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span> <span class="comment"> *   format is the representation of the private key `x` as a big-endian byte</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span> <span class="comment"> *   string. The length of the byte string is the private key size in bytes</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span> <span class="comment"> *   (leading zeroes are not stripped).</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span> <span class="comment"> * - For public keys (key types for which #PSA_KEY_TYPE_IS_PUBLIC_KEY is</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span> <span class="comment"> *   true), the format is the same as for psa_export_public_key().</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span> <span class="comment"> *</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span> <span class="comment"> * The policy on the key must have the usage flag #PSA_KEY_USAGE_EXPORT set.</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span> <span class="comment"> *</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span> <span class="comment"> * \param handle            Handle to the key to export.</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span> <span class="comment"> * \param[out] data         Buffer where the key data is to be written.</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span> <span class="comment"> * \param data_size         Size of the \p data buffer in bytes.</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span> <span class="comment"> * \param[out] data_length  On success, the number of bytes</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span> <span class="comment"> *                          that make up the key data.</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span> <span class="comment"> *</span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span> <span class="comment"> *         The key does not have the #PSA_KEY_USAGE_EXPORT flag.</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span> <span class="comment"> * \retval #PSA_ERROR_BUFFER_TOO_SMALL</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span> <span class="comment"> *         The size of the \p data buffer is too small. You can determine a</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span> <span class="comment"> *         sufficient buffer size by calling</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span> <span class="comment"> *         #PSA_KEY_EXPORT_MAX_SIZE(\c type, \c bits)</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span> <span class="comment"> *         where \c type is the key type</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span> <span class="comment"> *         and \c bits is the key size in bits.</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span> <span class="comment"> */</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__import__export.html#ga668e35be8d2852ad3feeef74ac6f75bf">psa_export_key</a>(psa_key_handle_t handle,</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>                             uint8_t *data,</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>                             <span class="keywordtype">size_t</span> data_size,</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>                             <span class="keywordtype">size_t</span> *data_length);</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span> <span class="comment"></span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span> <span class="comment">/**</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span> <span class="comment"> * \brief Export a public key or the public part of a key pair in binary format.</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span> <span class="comment"> *</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span> <span class="comment"> * The output of this function can be passed to psa_import_key() to</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span> <span class="comment"> * create an object that is equivalent to the public key.</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span> <span class="comment"> *</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span> <span class="comment"> * This specification supports a single format for each key type.</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span> <span class="comment"> * Implementations may support other formats as long as the standard</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span> <span class="comment"> * format is supported. Implementations that support other formats</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span> <span class="comment"> * should ensure that the formats are clearly unambiguous so as to</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span> <span class="comment"> * minimize the risk that an invalid input is accidentally interpreted</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span> <span class="comment"> * according to a different format.</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span> <span class="comment"> *</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span> <span class="comment"> * For standard key types, the output format is as follows:</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span> <span class="comment"> * - For RSA public keys (#PSA_KEY_TYPE_RSA_PUBLIC_KEY), the DER encoding of</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span> <span class="comment"> *   the representation defined by RFC 3279 &amp;sect;2.3.1 as `RSAPublicKey`.</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span> <span class="comment"> *   ```</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span> <span class="comment"> *   RSAPublicKey ::= SEQUENCE {</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span> <span class="comment"> *      modulus            INTEGER,    -- n</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span> <span class="comment"> *      publicExponent     INTEGER  }  -- e</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span> <span class="comment"> *   ```</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span> <span class="comment"> * - For elliptic curve public keys (key types for which</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span> <span class="comment"> *   #PSA_KEY_TYPE_IS_ECC_PUBLIC_KEY is true), the format is the uncompressed</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span> <span class="comment"> *   representation defined by SEC1 &amp;sect;2.3.3 as the content of an ECPoint.</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span> <span class="comment"> *   Let `m` be the bit size associated with the curve, i.e. the bit size of</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span> <span class="comment"> *   `q` for a curve over `F_q`. The representation consists of:</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span> <span class="comment"> *      - The byte 0x04;</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span> <span class="comment"> *      - `x_P` as a `ceiling(m/8)`-byte string, big-endian;</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span> <span class="comment"> *      - `y_P` as a `ceiling(m/8)`-byte string, big-endian.</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span> <span class="comment"> * - For Diffie-Hellman key exchange public keys (key types for which</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span> <span class="comment"> *   #PSA_KEY_TYPE_IS_DH_PUBLIC_KEY is true),</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span> <span class="comment"> *   the format is the representation of the public key `y = g^x mod p` as a</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span> <span class="comment"> *   big-endian byte string. The length of the byte string is the length of the</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span> <span class="comment"> *   base prime `p` in bytes.</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span> <span class="comment"> *</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span> <span class="comment"> * Exporting a public key object or the public part of a key pair is</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span> <span class="comment"> * always permitted, regardless of the key's usage flags.</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span> <span class="comment"> *</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span> <span class="comment"> * \param handle            Handle to the key to export.</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span> <span class="comment"> * \param[out] data         Buffer where the key data is to be written.</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span> <span class="comment"> * \param data_size         Size of the \p data buffer in bytes.</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span> <span class="comment"> * \param[out] data_length  On success, the number of bytes</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span> <span class="comment"> *                          that make up the key data.</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span> <span class="comment"> *</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span> <span class="comment"> *         The key is neither a public key nor a key pair.</span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span> <span class="comment"> * \retval #PSA_ERROR_BUFFER_TOO_SMALL</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span> <span class="comment"> *         The size of the \p data buffer is too small. You can determine a</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span> <span class="comment"> *         sufficient buffer size by calling</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span> <span class="comment"> *         #PSA_KEY_EXPORT_MAX_SIZE(#PSA_KEY_TYPE_PUBLIC_KEY_OF_KEY_PAIR(\c type), \c bits)</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span> <span class="comment"> *         where \c type is the key type</span></div><div class="line"><a name="l00829"></a><span class="lineno">  829</span> <span class="comment"> *         and \c bits is the key size in bits.</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span> <span class="comment"> */</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__import__export.html#gaf22ae73312217aaede2ea02cdebb6062">psa_export_public_key</a>(psa_key_handle_t handle,</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>                                    uint8_t *data,</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>                                    <span class="keywordtype">size_t</span> data_size,</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>                                    <span class="keywordtype">size_t</span> *data_length);</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span> </div><div class="line"><a name="l00845"></a><span class="lineno">  845</span> </div><div class="line"><a name="l00846"></a><span class="lineno">  846</span> <span class="comment"></span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span> <span class="comment">/**@}*/</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span> <span class="comment"></span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span> <span class="comment">/** \defgroup hash Message digests</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span> <span class="comment"> * @{</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span> <span class="comment"> */</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span> <span class="comment"></span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span> <span class="comment">/** Calculate the hash (digest) of a message.</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span> <span class="comment"> *</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span> <span class="comment"> * \note To verify the hash of a message against an</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span> <span class="comment"> *       expected value, use psa_hash_compare() instead.</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span> <span class="comment"> *</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span> <span class="comment"> * \param alg               The hash algorithm to compute (\c PSA_ALG_XXX value</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span> <span class="comment"> *                          such that #PSA_ALG_IS_HASH(\p alg) is true).</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span> <span class="comment"> * \param[in] input         Buffer containing the message to hash.</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span> <span class="comment"> * \param input_length      Size of the \p input buffer in bytes.</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span> <span class="comment"> * \param[out] hash         Buffer where the hash is to be written.</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span> <span class="comment"> * \param hash_size         Size of the \p hash buffer in bytes.</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span> <span class="comment"> * \param[out] hash_length  On success, the number of bytes</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span> <span class="comment"> *                          that make up the hash value. This is always</span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span> <span class="comment"> *                          #PSA_HASH_SIZE(\p alg).</span></div><div class="line"><a name="l00867"></a><span class="lineno">  867</span> <span class="comment"> *</span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span> <span class="comment"> *         \p alg is not supported or is not a hash algorithm.</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span> <span class="comment"> * \retval #PSA_ERROR_BUFFER_TOO_SMALL</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span> <span class="comment"> *         \p hash_size is too small</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span> <span class="comment"> */</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__hash.html#gac69f7f19d96a56c28cf3799d11b12156">psa_hash_compute</a>(<a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> alg,</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>                               <span class="keyword">const</span> uint8_t *input,</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>                               <span class="keywordtype">size_t</span> input_length,</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>                               uint8_t *hash,</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>                               <span class="keywordtype">size_t</span> hash_size,</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>                               <span class="keywordtype">size_t</span> *hash_length);</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span> <span class="comment"></span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span> <span class="comment">/** Calculate the hash (digest) of a message and compare it with a</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span> <span class="comment"> * reference value.</span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span> <span class="comment"> *</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span> <span class="comment"> * \param alg               The hash algorithm to compute (\c PSA_ALG_XXX value</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span> <span class="comment"> *                          such that #PSA_ALG_IS_HASH(\p alg) is true).</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span> <span class="comment"> * \param[in] input         Buffer containing the message to hash.</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span> <span class="comment"> * \param input_length      Size of the \p input buffer in bytes.</span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span> <span class="comment"> * \param[out] hash         Buffer containing the expected hash value.</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span> <span class="comment"> * \param hash_length       Size of the \p hash buffer in bytes.</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span> <span class="comment"> *</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span> <span class="comment"> *         The expected hash is identical to the actual hash of the input.</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_SIGNATURE</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span> <span class="comment"> *         The hash of the message was calculated successfully, but it</span></div><div class="line"><a name="l00906"></a><span class="lineno">  906</span> <span class="comment"> *         differs from the expected hash.</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span> <span class="comment"> *         \p alg is not supported or is not a hash algorithm.</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span> <span class="comment"> *         \p input_length or \p hash_length do not match the hash size for \p alg</span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l00919"></a><span class="lineno">  919</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span> <span class="comment"> */</span></div><div class="line"><a name="l00921"></a><span class="lineno">  921</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__hash.html#ga0c08f4797bec96b886c8c8d7acc2a553">psa_hash_compare</a>(<a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> alg,</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>                               <span class="keyword">const</span> uint8_t *input,</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>                               <span class="keywordtype">size_t</span> input_length,</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>                               <span class="keyword">const</span> uint8_t *hash,</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>                               <span class="keyword">const</span> <span class="keywordtype">size_t</span> hash_length);</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span> <span class="comment"></span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span> <span class="comment">/** The type of the state data structure for multipart hash operations.</span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span> <span class="comment"> *</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span> <span class="comment"> * Before calling any function on a hash operation object, the application must</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span> <span class="comment"> * initialize it by any of the following means:</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span> <span class="comment"> * - Set the structure to all-bits-zero, for example:</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span> <span class="comment"> *   \code</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span> <span class="comment"> *   psa_hash_operation_t operation;</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span> <span class="comment"> *   memset(&amp;operation, 0, sizeof(operation));</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span> <span class="comment"> *   \endcode</span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span> <span class="comment"> * - Initialize the structure to logical zero values, for example:</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span> <span class="comment"> *   \code</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span> <span class="comment"> *   psa_hash_operation_t operation = {0};</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span> <span class="comment"> *   \endcode</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span> <span class="comment"> * - Initialize the structure to the initializer #PSA_HASH_OPERATION_INIT,</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span> <span class="comment"> *   for example:</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span> <span class="comment"> *   \code</span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span> <span class="comment"> *   psa_hash_operation_t operation = PSA_HASH_OPERATION_INIT;</span></div><div class="line"><a name="l00944"></a><span class="lineno">  944</span> <span class="comment"> *   \endcode</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span> <span class="comment"> * - Assign the result of the function psa_hash_operation_init()</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span> <span class="comment"> *   to the structure, for example:</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span> <span class="comment"> *   \code</span></div><div class="line"><a name="l00948"></a><span class="lineno">  948</span> <span class="comment"> *   psa_hash_operation_t operation;</span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span> <span class="comment"> *   operation = psa_hash_operation_init();</span></div><div class="line"><a name="l00950"></a><span class="lineno">  950</span> <span class="comment"> *   \endcode</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span> <span class="comment"> *</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span> <span class="comment"> * This is an implementation-defined \c struct. Applications should not</span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span> <span class="comment"> * make any assumptions about the content of this structure except</span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span> <span class="comment"> * as directed by the documentation of a specific implementation. */</span></div><div class="line"><a name="l00955"></a><span class="lineno"><a class="line" href="group__hash.html#ga3c4205d2ce66c4095fc5c78c25273fab">  955</a></span> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structpsa__hash__operation__s.html">psa_hash_operation_s</a> <a class="code" href="structpsa__hash__operation__s.html">psa_hash_operation_t</a>;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span> <span class="comment"></span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span> <span class="comment">/** \def PSA_HASH_OPERATION_INIT</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span> <span class="comment"> *</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span> <span class="comment"> * This macro returns a suitable initializer for a hash operation object</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span> <span class="comment"> * of type #psa_hash_operation_t.</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span> <span class="comment"> */</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span> <span class="preprocessor">#ifdef __DOXYGEN_ONLY__</span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span> <span class="comment">/* This is an example definition for documentation purposes.</span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span> <span class="comment"> * Implementations should define a suitable value in `crypto_struct.h`.</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span> <span class="comment"> */</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span> <span class="preprocessor">#define PSA_HASH_OPERATION_INIT {0}</span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span> <span class="preprocessor">#endif</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span> <span class="comment"></span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span> <span class="comment">/** Return an initial value for a hash operation object.</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span> <span class="comment"> */</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span> <span class="keyword">static</span> <a class="code" href="structpsa__hash__operation__s.html">psa_hash_operation_t</a> <a class="code" href="group__hash.html#ga616458d010d961df3f41049ed38e51b9">psa_hash_operation_init</a>(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span> <span class="comment"></span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span> <span class="comment">/** Set up a multipart hash operation.</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span> <span class="comment"> *</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span> <span class="comment"> * The sequence of operations to calculate a hash (message digest)</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span> <span class="comment"> * is as follows:</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span> <span class="comment"> * -# Allocate an operation object which will be passed to all the functions</span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span> <span class="comment"> *    listed here.</span></div><div class="line"><a name="l00979"></a><span class="lineno">  979</span> <span class="comment"> * -# Initialize the operation object with one of the methods described in the</span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span> <span class="comment"> *    documentation for #psa_hash_operation_t, e.g. #PSA_HASH_OPERATION_INIT.</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span> <span class="comment"> * -# Call psa_hash_setup() to specify the algorithm.</span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span> <span class="comment"> * -# Call psa_hash_update() zero, one or more times, passing a fragment</span></div><div class="line"><a name="l00983"></a><span class="lineno">  983</span> <span class="comment"> *    of the message each time. The hash that is calculated is the hash</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span> <span class="comment"> *    of the concatenation of these messages in order.</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span> <span class="comment"> * -# To calculate the hash, call psa_hash_finish().</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span> <span class="comment"> *    To compare the hash with an expected value, call psa_hash_verify().</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span> <span class="comment"> *</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span> <span class="comment"> * If an error occurs at any step after a call to psa_hash_setup(), the</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span> <span class="comment"> * operation will need to be reset by a call to psa_hash_abort(). The</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span> <span class="comment"> * application may call psa_hash_abort() at any time after the operation</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span> <span class="comment"> * has been initialized.</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span> <span class="comment"> *</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span> <span class="comment"> * After a successful call to psa_hash_setup(), the application must</span></div><div class="line"><a name="l00994"></a><span class="lineno">  994</span> <span class="comment"> * eventually terminate the operation. The following events terminate an</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span> <span class="comment"> * operation:</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span> <span class="comment"> * - A successful call to psa_hash_finish() or psa_hash_verify().</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span> <span class="comment"> * - A call to psa_hash_abort().</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span> <span class="comment"> *</span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span> <span class="comment"> * \param[in,out] operation The operation object to set up. It must have</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span> <span class="comment"> *                          been initialized as per the documentation for</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span> <span class="comment"> *                          #psa_hash_operation_t and not yet in use.</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span> <span class="comment"> * \param alg               The hash algorithm to compute (\c PSA_ALG_XXX value</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span> <span class="comment"> *                          such that #PSA_ALG_IS_HASH(\p alg) is true).</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span> <span class="comment"> *</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span> <span class="comment"> *         \p alg is not a supported hash algorithm.</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span> <span class="comment"> *         \p alg is not a hash algorithm.</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span> <span class="comment"> *         The operation state is not valid (it must be inactive).</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span> <span class="comment"> */</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__hash.html#ga8d72896cf70fc4d514c5c6b978912515">psa_hash_setup</a>(<a class="code" href="structpsa__hash__operation__s.html">psa_hash_operation_t</a> *operation,</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>                             <a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> alg);</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span> <span class="comment"></span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span> <span class="comment">/** Add a message fragment to a multipart hash operation.</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span> <span class="comment"> *</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span> <span class="comment"> * The application must call psa_hash_setup() before calling this function.</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span> <span class="comment"> *</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span> <span class="comment"> * If this function returns an error status, the operation enters an error</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span> <span class="comment"> * state and must be aborted by calling psa_hash_abort().</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span> <span class="comment"> *</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span> <span class="comment"> * \param[in,out] operation Active hash operation.</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span> <span class="comment"> * \param[in] input         Buffer containing the message fragment to hash.</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span> <span class="comment"> * \param input_length      Size of the \p input buffer in bytes.</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span> <span class="comment"> *</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span> <span class="comment"> *         The operation state is not valid (it muct be active).</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span> <span class="comment"> */</span></div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__hash.html#ga65b16ef97d7f650899b7db4b7d1112ff">psa_hash_update</a>(<a class="code" href="structpsa__hash__operation__s.html">psa_hash_operation_t</a> *operation,</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>                              <span class="keyword">const</span> uint8_t *input,</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>                              <span class="keywordtype">size_t</span> input_length);</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span> <span class="comment"></span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span> <span class="comment">/** Finish the calculation of the hash of a message.</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span> <span class="comment"> *</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span> <span class="comment"> * The application must call psa_hash_setup() before calling this function.</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span> <span class="comment"> * This function calculates the hash of the message formed by concatenating</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span> <span class="comment"> * the inputs passed to preceding calls to psa_hash_update().</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span> <span class="comment"> *</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span> <span class="comment"> * When this function returns successfuly, the operation becomes inactive.</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span> <span class="comment"> * If this function returns an error status, the operation enters an error</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span> <span class="comment"> * state and must be aborted by calling psa_hash_abort().</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span> <span class="comment"> *</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span> <span class="comment"> * \warning Applications should not call this function if they expect</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span> <span class="comment"> *          a specific value for the hash. Call psa_hash_verify() instead.</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span> <span class="comment"> *          Beware that comparing integrity or authenticity data such as</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span> <span class="comment"> *          hash values with a function such as \c memcmp is risky</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span> <span class="comment"> *          because the time taken by the comparison may leak information</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span> <span class="comment"> *          about the hashed data which could allow an attacker to guess</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span> <span class="comment"> *          a valid hash and thereby bypass security controls.</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span> <span class="comment"> *</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span> <span class="comment"> * \param[in,out] operation     Active hash operation.</span></div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span> <span class="comment"> * \param[out] hash             Buffer where the hash is to be written.</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span> <span class="comment"> * \param hash_size             Size of the \p hash buffer in bytes.</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span> <span class="comment"> * \param[out] hash_length      On success, the number of bytes</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span> <span class="comment"> *                              that make up the hash value. This is always</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span> <span class="comment"> *                              #PSA_HASH_SIZE(\c alg) where \c alg is the</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span> <span class="comment"> *                              hash algorithm that is calculated.</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span> <span class="comment"> *</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span> <span class="comment"> *         The operation state is not valid (it must be active).</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span> <span class="comment"> * \retval #PSA_ERROR_BUFFER_TOO_SMALL</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span> <span class="comment"> *         The size of the \p hash buffer is too small. You can determine a</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span> <span class="comment"> *         sufficient buffer size by calling #PSA_HASH_SIZE(\c alg)</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span> <span class="comment"> *         where \c alg is the hash algorithm that is calculated.</span></div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span> <span class="comment"> */</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__hash.html#ga4795fd06a0067b0adcd92e9627b8c97e">psa_hash_finish</a>(<a class="code" href="structpsa__hash__operation__s.html">psa_hash_operation_t</a> *operation,</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>                              uint8_t *hash,</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>                              <span class="keywordtype">size_t</span> hash_size,</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>                              <span class="keywordtype">size_t</span> *hash_length);</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span> <span class="comment"></span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span> <span class="comment">/** Finish the calculation of the hash of a message and compare it with</span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span> <span class="comment"> * an expected value.</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span> <span class="comment"> *</span></div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span> <span class="comment"> * The application must call psa_hash_setup() before calling this function.</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span> <span class="comment"> * This function calculates the hash of the message formed by concatenating</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span> <span class="comment"> * the inputs passed to preceding calls to psa_hash_update(). It then</span></div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span> <span class="comment"> * compares the calculated hash with the expected hash passed as a</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span> <span class="comment"> * parameter to this function.</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span> <span class="comment"> *</span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span> <span class="comment"> * When this function returns successfuly, the operation becomes inactive.</span></div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span> <span class="comment"> * If this function returns an error status, the operation enters an error</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span> <span class="comment"> * state and must be aborted by calling psa_hash_abort().</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span> <span class="comment"> *</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span> <span class="comment"> * \note Implementations shall make the best effort to ensure that the</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span> <span class="comment"> * comparison between the actual hash and the expected hash is performed</span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span> <span class="comment"> * in constant time.</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span> <span class="comment"> *</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span> <span class="comment"> * \param[in,out] operation     Active hash operation.</span></div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span> <span class="comment"> * \param[in] hash              Buffer containing the expected hash value.</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span> <span class="comment"> * \param hash_length           Size of the \p hash buffer in bytes.</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span> <span class="comment"> *</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span> <span class="comment"> *         The expected hash is identical to the actual hash of the message.</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_SIGNATURE</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span> <span class="comment"> *         The hash of the message was calculated successfully, but it</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span> <span class="comment"> *         differs from the expected hash.</span></div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span> <span class="comment"> *         The operation state is not valid (it must be active).</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span> <span class="comment"> */</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__hash.html#ga7be923c5700c9c70ef77ee9b76d1a5c0">psa_hash_verify</a>(<a class="code" href="structpsa__hash__operation__s.html">psa_hash_operation_t</a> *operation,</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>                              <span class="keyword">const</span> uint8_t *hash,</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>                              <span class="keywordtype">size_t</span> hash_length);</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span> <span class="comment"></span></div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span> <span class="comment">/** Abort a hash operation.</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span> <span class="comment"> *</span></div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span> <span class="comment"> * Aborting an operation frees all associated resources except for the</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span> <span class="comment"> * \p operation structure itself. Once aborted, the operation object</span></div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span> <span class="comment"> * can be reused for another operation by calling</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span> <span class="comment"> * psa_hash_setup() again.</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span> <span class="comment"> *</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span> <span class="comment"> * You may call this function any time after the operation object has</span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span> <span class="comment"> * been initialized by one of the methods described in #psa_hash_operation_t.</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span> <span class="comment"> *</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span> <span class="comment"> * In particular, calling psa_hash_abort() after the operation has been</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span> <span class="comment"> * terminated by a call to psa_hash_abort(), psa_hash_finish() or</span></div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span> <span class="comment"> * psa_hash_verify() is safe and has no effect.</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span> <span class="comment"> *</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span> <span class="comment"> * \param[in,out] operation     Initialized hash operation.</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span> <span class="comment"> *</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span> <span class="comment"> */</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__hash.html#gab0b4d5f9912a615559497a467b532928">psa_hash_abort</a>(<a class="code" href="structpsa__hash__operation__s.html">psa_hash_operation_t</a> *operation);</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span> <span class="comment"></span></div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span> <span class="comment">/** Clone a hash operation.</span></div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span> <span class="comment"> *</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span> <span class="comment"> * This function copies the state of an ongoing hash operation to</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span> <span class="comment"> * a new operation object. In other words, this function is equivalent</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span> <span class="comment"> * to calling psa_hash_setup() on \p target_operation with the same</span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span> <span class="comment"> * algorithm that \p source_operation was set up for, then</span></div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span> <span class="comment"> * psa_hash_update() on \p target_operation with the same input that</span></div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span> <span class="comment"> * that was passed to \p source_operation. After this function returns, the</span></div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span> <span class="comment"> * two objects are independent, i.e. subsequent calls involving one of</span></div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span> <span class="comment"> * the objects do not affect the other object.</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span> <span class="comment"> *</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span> <span class="comment"> * \param[in] source_operation      The active hash operation to clone.</span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span> <span class="comment"> * \param[in,out] target_operation  The operation object to set up.</span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span> <span class="comment"> *                                  It must be initialized but not active.</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span> <span class="comment"> *</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span> <span class="comment"> *         The \p source_operation state is not valid (it must be active).</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span> <span class="comment"> *         The \p target_operation state is not valid (it must be inactive).</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span> <span class="comment"> */</span></div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__hash.html#ga39673348f3302b4646bd780034a5aeda">psa_hash_clone</a>(<span class="keyword">const</span> <a class="code" href="structpsa__hash__operation__s.html">psa_hash_operation_t</a> *source_operation,</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>                             <a class="code" href="structpsa__hash__operation__s.html">psa_hash_operation_t</a> *target_operation);</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span> <span class="comment"></span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span> <span class="comment">/**@}*/</span></div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span> <span class="comment"></span></div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span> <span class="comment">/** \defgroup MAC Message authentication codes</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span> <span class="comment"> * @{</span></div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span> <span class="comment"> */</span></div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span> <span class="comment"></span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span> <span class="comment">/** Calculate the MAC (message authentication code) of a message.</span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span> <span class="comment"> *</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span> <span class="comment"> * \note To verify the MAC of a message against an</span></div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span> <span class="comment"> *       expected value, use psa_mac_verify() instead.</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span> <span class="comment"> *       Beware that comparing integrity or authenticity data such as</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span> <span class="comment"> *       MAC values with a function such as \c memcmp is risky</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span> <span class="comment"> *       because the time taken by the comparison may leak information</span></div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span> <span class="comment"> *       about the MAC value which could allow an attacker to guess</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span> <span class="comment"> *       a valid MAC and thereby bypass security controls.</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span> <span class="comment"> *</span></div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span> <span class="comment"> * \param handle            Handle to the key to use for the operation.</span></div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span> <span class="comment"> * \param alg               The MAC algorithm to compute (\c PSA_ALG_XXX value</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span> <span class="comment"> *                          such that #PSA_ALG_IS_MAC(\p alg) is true).</span></div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span> <span class="comment"> * \param[in] input         Buffer containing the input message.</span></div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span> <span class="comment"> * \param input_length      Size of the \p input buffer in bytes.</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span> <span class="comment"> * \param[out] mac          Buffer where the MAC value is to be written.</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span> <span class="comment"> * \param mac_size          Size of the \p mac buffer in bytes.</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span> <span class="comment"> * \param[out] mac_length   On success, the number of bytes</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span> <span class="comment"> *                          that make up the MAC value.</span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span> <span class="comment"> *</span></div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span> <span class="comment"> *         \p handle is not compatible with \p alg.</span></div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span> <span class="comment"> *         \p alg is not supported or is not a MAC algorithm.</span></div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span> <span class="comment"> * \retval #PSA_ERROR_BUFFER_TOO_SMALL</span></div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span> <span class="comment"> *         \p mac_size is too small</span></div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span> <span class="comment"> *         The key could not be retrieved from storage.</span></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span> <span class="comment"> */</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group___m_a_c.html#gabf02ebd3595ea15436967092b5d52878">psa_mac_compute</a>(psa_key_handle_t handle,</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>                              <a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> alg,</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>                              <span class="keyword">const</span> uint8_t *input,</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>                              <span class="keywordtype">size_t</span> input_length,</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>                              uint8_t *mac,</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>                              <span class="keywordtype">size_t</span> mac_size,</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>                              <span class="keywordtype">size_t</span> *mac_length);</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span> <span class="comment"></span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span> <span class="comment">/** Calculate the MAC of a message and compare it with a reference value.</span></div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span> <span class="comment"> *</span></div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span> <span class="comment"> * \param handle            Handle to the key to use for the operation.</span></div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span> <span class="comment"> * \param alg               The MAC algorithm to compute (\c PSA_ALG_XXX value</span></div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span> <span class="comment"> *                          such that #PSA_ALG_IS_MAC(\p alg) is true).</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span> <span class="comment"> * \param[in] input         Buffer containing the input message.</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span> <span class="comment"> * \param input_length      Size of the \p input buffer in bytes.</span></div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span> <span class="comment"> * \param[out] mac          Buffer containing the expected MAC value.</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span> <span class="comment"> * \param mac_length        Size of the \p mac buffer in bytes.</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span> <span class="comment"> *</span></div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span> <span class="comment"> *         The expected MAC is identical to the actual MAC of the input.</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_SIGNATURE</span></div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span> <span class="comment"> *         The MAC of the message was calculated successfully, but it</span></div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span> <span class="comment"> *         differs from the expected value.</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span> <span class="comment"> *         \p handle is not compatible with \p alg.</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span> <span class="comment"> *         \p alg is not supported or is not a MAC algorithm.</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span> <span class="comment"> *         The key could not be retrieved from storage.</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span> <span class="comment"> */</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group___m_a_c.html#gaf6988545df5d5e2466c34d753443b15a">psa_mac_verify</a>(psa_key_handle_t handle,</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>                             <a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> alg,</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>                             <span class="keyword">const</span> uint8_t *input,</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>                             <span class="keywordtype">size_t</span> input_length,</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>                             <span class="keyword">const</span> uint8_t *mac,</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>                             <span class="keyword">const</span> <span class="keywordtype">size_t</span> mac_length);</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span> <span class="comment"></span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span> <span class="comment">/** The type of the state data structure for multipart MAC operations.</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span> <span class="comment"> *</span></div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span> <span class="comment"> * Before calling any function on a MAC operation object, the application must</span></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span> <span class="comment"> * initialize it by any of the following means:</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span> <span class="comment"> * - Set the structure to all-bits-zero, for example:</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span> <span class="comment"> *   \code</span></div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span> <span class="comment"> *   psa_mac_operation_t operation;</span></div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span> <span class="comment"> *   memset(&amp;operation, 0, sizeof(operation));</span></div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span> <span class="comment"> *   \endcode</span></div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span> <span class="comment"> * - Initialize the structure to logical zero values, for example:</span></div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span> <span class="comment"> *   \code</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span> <span class="comment"> *   psa_mac_operation_t operation = {0};</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span> <span class="comment"> *   \endcode</span></div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span> <span class="comment"> * - Initialize the structure to the initializer #PSA_MAC_OPERATION_INIT,</span></div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span> <span class="comment"> *   for example:</span></div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span> <span class="comment"> *   \code</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span> <span class="comment"> *   psa_mac_operation_t operation = PSA_MAC_OPERATION_INIT;</span></div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span> <span class="comment"> *   \endcode</span></div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span> <span class="comment"> * - Assign the result of the function psa_mac_operation_init()</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span> <span class="comment"> *   to the structure, for example:</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span> <span class="comment"> *   \code</span></div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span> <span class="comment"> *   psa_mac_operation_t operation;</span></div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span> <span class="comment"> *   operation = psa_mac_operation_init();</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span> <span class="comment"> *   \endcode</span></div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span> <span class="comment"> *</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span> <span class="comment"> * This is an implementation-defined \c struct. Applications should not</span></div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span> <span class="comment"> * make any assumptions about the content of this structure except</span></div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span> <span class="comment"> * as directed by the documentation of a specific implementation. */</span></div><div class="line"><a name="l01323"></a><span class="lineno"><a class="line" href="group___m_a_c.html#ga78f0838b0c4e3db28b26355624d4bd37"> 1323</a></span> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structpsa__mac__operation__s.html">psa_mac_operation_s</a> <a class="code" href="structpsa__mac__operation__s.html">psa_mac_operation_t</a>;</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span> <span class="comment"></span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span> <span class="comment">/** \def PSA_MAC_OPERATION_INIT</span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span> <span class="comment"> *</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span> <span class="comment"> * This macro returns a suitable initializer for a MAC operation object of type</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span> <span class="comment"> * #psa_mac_operation_t.</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span> <span class="comment"> */</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span> <span class="preprocessor">#ifdef __DOXYGEN_ONLY__</span></div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span> <span class="comment">/* This is an example definition for documentation purposes.</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span> <span class="comment"> * Implementations should define a suitable value in `crypto_struct.h`.</span></div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span> <span class="comment"> */</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span> <span class="preprocessor">#define PSA_MAC_OPERATION_INIT {0}</span></div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span> <span class="preprocessor">#endif</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span> <span class="comment"></span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span> <span class="comment">/** Return an initial value for a MAC operation object.</span></div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span> <span class="comment"> */</span></div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span> <span class="keyword">static</span> <a class="code" href="structpsa__mac__operation__s.html">psa_mac_operation_t</a> <a class="code" href="group___m_a_c.html#ga49c821435fb16fb462403795eaefc867">psa_mac_operation_init</a>(<span class="keywordtype">void</span>);</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span> <span class="comment"></span></div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span> <span class="comment">/** Set up a multipart MAC calculation operation.</span></div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span> <span class="comment"> *</span></div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span> <span class="comment"> * This function sets up the calculation of the MAC</span></div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span> <span class="comment"> * (message authentication code) of a byte string.</span></div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span> <span class="comment"> * To verify the MAC of a message against an</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span> <span class="comment"> * expected value, use psa_mac_verify_setup() instead.</span></div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span> <span class="comment"> *</span></div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span> <span class="comment"> * The sequence of operations to calculate a MAC is as follows:</span></div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span> <span class="comment"> * -# Allocate an operation object which will be passed to all the functions</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span> <span class="comment"> *    listed here.</span></div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span> <span class="comment"> * -# Initialize the operation object with one of the methods described in the</span></div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span> <span class="comment"> *    documentation for #psa_mac_operation_t, e.g. #PSA_MAC_OPERATION_INIT.</span></div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span> <span class="comment"> * -# Call psa_mac_sign_setup() to specify the algorithm and key.</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span> <span class="comment"> * -# Call psa_mac_update() zero, one or more times, passing a fragment</span></div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span> <span class="comment"> *    of the message each time. The MAC that is calculated is the MAC</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span> <span class="comment"> *    of the concatenation of these messages in order.</span></div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span> <span class="comment"> * -# At the end of the message, call psa_mac_sign_finish() to finish</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span> <span class="comment"> *    calculating the MAC value and retrieve it.</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span> <span class="comment"> *</span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span> <span class="comment"> * If an error occurs at any step after a call to psa_mac_sign_setup(), the</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span> <span class="comment"> * operation will need to be reset by a call to psa_mac_abort(). The</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span> <span class="comment"> * application may call psa_mac_abort() at any time after the operation</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span> <span class="comment"> * has been initialized.</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span> <span class="comment"> *</span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span> <span class="comment"> * After a successful call to psa_mac_sign_setup(), the application must</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span> <span class="comment"> * eventually terminate the operation through one of the following methods:</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span> <span class="comment"> * - A successful call to psa_mac_sign_finish().</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span> <span class="comment"> * - A call to psa_mac_abort().</span></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span> <span class="comment"> *</span></div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span> <span class="comment"> * \param[in,out] operation The operation object to set up. It must have</span></div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span> <span class="comment"> *                          been initialized as per the documentation for</span></div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span> <span class="comment"> *                          #psa_mac_operation_t and not yet in use.</span></div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span> <span class="comment"> * \param handle            Handle to the key to use for the operation.</span></div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span> <span class="comment"> *                          It must remain valid until the operation</span></div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span> <span class="comment"> *                          terminates.</span></div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span> <span class="comment"> * \param alg               The MAC algorithm to compute (\c PSA_ALG_XXX value</span></div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span> <span class="comment"> *                          such that #PSA_ALG_IS_MAC(\p alg) is true).</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span> <span class="comment"> *</span></div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span> <span class="comment"> *         \p handle is not compatible with \p alg.</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span> <span class="comment"> *         \p alg is not supported or is not a MAC algorithm.</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span> <span class="comment"> *         The key could not be retrieved from storage.</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span> <span class="comment"> *         The operation state is not valid (it must be inactive).</span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span> <span class="comment"> */</span></div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group___m_a_c.html#ga03bc3e3c0b7e55b20d2a238e418d46cd">psa_mac_sign_setup</a>(<a class="code" href="structpsa__mac__operation__s.html">psa_mac_operation_t</a> *operation,</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>                                 psa_key_handle_t handle,</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>                                 <a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> alg);</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span> <span class="comment"></span></div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span> <span class="comment">/** Set up a multipart MAC verification operation.</span></div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span> <span class="comment"> *</span></div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span> <span class="comment"> * This function sets up the verification of the MAC</span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span> <span class="comment"> * (message authentication code) of a byte string against an expected value.</span></div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span> <span class="comment"> *</span></div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span> <span class="comment"> * The sequence of operations to verify a MAC is as follows:</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span> <span class="comment"> * -# Allocate an operation object which will be passed to all the functions</span></div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span> <span class="comment"> *    listed here.</span></div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span> <span class="comment"> * -# Initialize the operation object with one of the methods described in the</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span> <span class="comment"> *    documentation for #psa_mac_operation_t, e.g. #PSA_MAC_OPERATION_INIT.</span></div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span> <span class="comment"> * -# Call psa_mac_verify_setup() to specify the algorithm and key.</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span> <span class="comment"> * -# Call psa_mac_update() zero, one or more times, passing a fragment</span></div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span> <span class="comment"> *    of the message each time. The MAC that is calculated is the MAC</span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span> <span class="comment"> *    of the concatenation of these messages in order.</span></div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span> <span class="comment"> * -# At the end of the message, call psa_mac_verify_finish() to finish</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span> <span class="comment"> *    calculating the actual MAC of the message and verify it against</span></div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span> <span class="comment"> *    the expected value.</span></div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span> <span class="comment"> *</span></div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span> <span class="comment"> * If an error occurs at any step after a call to psa_mac_verify_setup(), the</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span> <span class="comment"> * operation will need to be reset by a call to psa_mac_abort(). The</span></div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span> <span class="comment"> * application may call psa_mac_abort() at any time after the operation</span></div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span> <span class="comment"> * has been initialized.</span></div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span> <span class="comment"> *</span></div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span> <span class="comment"> * After a successful call to psa_mac_verify_setup(), the application must</span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span> <span class="comment"> * eventually terminate the operation through one of the following methods:</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span> <span class="comment"> * - A successful call to psa_mac_verify_finish().</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span> <span class="comment"> * - A call to psa_mac_abort().</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span> <span class="comment"> *</span></div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span> <span class="comment"> * \param[in,out] operation The operation object to set up. It must have</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span> <span class="comment"> *                          been initialized as per the documentation for</span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span> <span class="comment"> *                          #psa_mac_operation_t and not yet in use.</span></div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span> <span class="comment"> * \param handle            Handle to the key to use for the operation.</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span> <span class="comment"> *                          It must remain valid until the operation</span></div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span> <span class="comment"> *                          terminates.</span></div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span> <span class="comment"> * \param alg               The MAC algorithm to compute (\c PSA_ALG_XXX value</span></div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span> <span class="comment"> *                          such that #PSA_ALG_IS_MAC(\p alg) is true).</span></div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span> <span class="comment"> *</span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span> <span class="comment"> *         \c key is not compatible with \c alg.</span></div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span> <span class="comment"> *         \c alg is not supported or is not a MAC algorithm.</span></div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span> <span class="comment"> *         The key could not be retrieved from storage</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span> <span class="comment"> *         The operation state is not valid (it must be inactive).</span></div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span> <span class="comment"> */</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group___m_a_c.html#ga08ae327fcbc5f8e201172fe11e536984">psa_mac_verify_setup</a>(<a class="code" href="structpsa__mac__operation__s.html">psa_mac_operation_t</a> *operation,</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>                                   psa_key_handle_t handle,</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>                                   <a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> alg);</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span> <span class="comment"></span></div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span> <span class="comment">/** Add a message fragment to a multipart MAC operation.</span></div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span> <span class="comment"> *</span></div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span> <span class="comment"> * The application must call psa_mac_sign_setup() or psa_mac_verify_setup()</span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span> <span class="comment"> * before calling this function.</span></div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span> <span class="comment"> *</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span> <span class="comment"> * If this function returns an error status, the operation enters an error</span></div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span> <span class="comment"> * state and must be aborted by calling psa_mac_abort().</span></div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span> <span class="comment"> *</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span> <span class="comment"> * \param[in,out] operation Active MAC operation.</span></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span> <span class="comment"> * \param[in] input         Buffer containing the message fragment to add to</span></div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span> <span class="comment"> *                          the MAC calculation.</span></div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span> <span class="comment"> * \param input_length      Size of the \p input buffer in bytes.</span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span> <span class="comment"> *</span></div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span> <span class="comment"> *         The operation state is not valid (it must be active).</span></div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span> <span class="comment"> */</span></div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group___m_a_c.html#ga5560af371497babefe03c9da4e8a1c05">psa_mac_update</a>(<a class="code" href="structpsa__mac__operation__s.html">psa_mac_operation_t</a> *operation,</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>                             <span class="keyword">const</span> uint8_t *input,</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>                             <span class="keywordtype">size_t</span> input_length);</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span> <span class="comment"></span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span> <span class="comment">/** Finish the calculation of the MAC of a message.</span></div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span> <span class="comment"> *</span></div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span> <span class="comment"> * The application must call psa_mac_sign_setup() before calling this function.</span></div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span> <span class="comment"> * This function calculates the MAC of the message formed by concatenating</span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span> <span class="comment"> * the inputs passed to preceding calls to psa_mac_update().</span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span> <span class="comment"> *</span></div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span> <span class="comment"> * When this function returns successfuly, the operation becomes inactive.</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span> <span class="comment"> * If this function returns an error status, the operation enters an error</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span> <span class="comment"> * state and must be aborted by calling psa_mac_abort().</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span> <span class="comment"> *</span></div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span> <span class="comment"> * \warning Applications should not call this function if they expect</span></div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span> <span class="comment"> *          a specific value for the MAC. Call psa_mac_verify_finish() instead.</span></div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span> <span class="comment"> *          Beware that comparing integrity or authenticity data such as</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span> <span class="comment"> *          MAC values with a function such as \c memcmp is risky</span></div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span> <span class="comment"> *          because the time taken by the comparison may leak information</span></div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span> <span class="comment"> *          about the MAC value which could allow an attacker to guess</span></div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span> <span class="comment"> *          a valid MAC and thereby bypass security controls.</span></div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span> <span class="comment"> *</span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span> <span class="comment"> * \param[in,out] operation Active MAC operation.</span></div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span> <span class="comment"> * \param[out] mac          Buffer where the MAC value is to be written.</span></div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span> <span class="comment"> * \param mac_size          Size of the \p mac buffer in bytes.</span></div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span> <span class="comment"> * \param[out] mac_length   On success, the number of bytes</span></div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span> <span class="comment"> *                          that make up the MAC value. This is always</span></div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span> <span class="comment"> *                          #PSA_MAC_FINAL_SIZE(\c key_type, \c key_bits, \c alg)</span></div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span> <span class="comment"> *                          where \c key_type and \c key_bits are the type and</span></div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span> <span class="comment"> *                          bit-size respectively of the key and \c alg is the</span></div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span> <span class="comment"> *                          MAC algorithm that is calculated.</span></div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span> <span class="comment"> *</span></div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span> <span class="comment"> *         The operation state is not valid (it must be an active mac sign</span></div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span> <span class="comment"> *         operation).</span></div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span> <span class="comment"> * \retval #PSA_ERROR_BUFFER_TOO_SMALL</span></div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span> <span class="comment"> *         The size of the \p mac buffer is too small. You can determine a</span></div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span> <span class="comment"> *         sufficient buffer size by calling PSA_MAC_FINAL_SIZE().</span></div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span> <span class="comment"> */</span></div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group___m_a_c.html#gac22bc0125580c96724a09226cfbc97f2">psa_mac_sign_finish</a>(<a class="code" href="structpsa__mac__operation__s.html">psa_mac_operation_t</a> *operation,</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>                                  uint8_t *mac,</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>                                  <span class="keywordtype">size_t</span> mac_size,</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>                                  <span class="keywordtype">size_t</span> *mac_length);</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span> <span class="comment"></span></div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span> <span class="comment">/** Finish the calculation of the MAC of a message and compare it with</span></div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span> <span class="comment"> * an expected value.</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span> <span class="comment"> *</span></div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span> <span class="comment"> * The application must call psa_mac_verify_setup() before calling this function.</span></div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span> <span class="comment"> * This function calculates the MAC of the message formed by concatenating</span></div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span> <span class="comment"> * the inputs passed to preceding calls to psa_mac_update(). It then</span></div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span> <span class="comment"> * compares the calculated MAC with the expected MAC passed as a</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span> <span class="comment"> * parameter to this function.</span></div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span> <span class="comment"> *</span></div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span> <span class="comment"> * When this function returns successfuly, the operation becomes inactive.</span></div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span> <span class="comment"> * If this function returns an error status, the operation enters an error</span></div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span> <span class="comment"> * state and must be aborted by calling psa_mac_abort().</span></div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span> <span class="comment"> *</span></div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span> <span class="comment"> * \note Implementations shall make the best effort to ensure that the</span></div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span> <span class="comment"> * comparison between the actual MAC and the expected MAC is performed</span></div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span> <span class="comment"> * in constant time.</span></div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span> <span class="comment"> *</span></div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span> <span class="comment"> * \param[in,out] operation Active MAC operation.</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span> <span class="comment"> * \param[in] mac           Buffer containing the expected MAC value.</span></div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span> <span class="comment"> * \param mac_length        Size of the \p mac buffer in bytes.</span></div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span> <span class="comment"> *</span></div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span> <span class="comment"> *         The expected MAC is identical to the actual MAC of the message.</span></div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_SIGNATURE</span></div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span> <span class="comment"> *         The MAC of the message was calculated successfully, but it</span></div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span> <span class="comment"> *         differs from the expected MAC.</span></div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span> <span class="comment"> *         The operation state is not valid (it must be an active mac verify</span></div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span> <span class="comment"> *         operation).</span></div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span> <span class="comment"> */</span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group___m_a_c.html#gac92b2930d6728e1be4d011c05d485822">psa_mac_verify_finish</a>(<a class="code" href="structpsa__mac__operation__s.html">psa_mac_operation_t</a> *operation,</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>                                    <span class="keyword">const</span> uint8_t *mac,</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>                                    <span class="keywordtype">size_t</span> mac_length);</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span> <span class="comment"></span></div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span> <span class="comment">/** Abort a MAC operation.</span></div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span> <span class="comment"> *</span></div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span> <span class="comment"> * Aborting an operation frees all associated resources except for the</span></div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span> <span class="comment"> * \p operation structure itself. Once aborted, the operation object</span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span> <span class="comment"> * can be reused for another operation by calling</span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span> <span class="comment"> * psa_mac_sign_setup() or psa_mac_verify_setup() again.</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span> <span class="comment"> *</span></div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span> <span class="comment"> * You may call this function any time after the operation object has</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span> <span class="comment"> * been initialized by one of the methods described in #psa_mac_operation_t.</span></div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span> <span class="comment"> *</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span> <span class="comment"> * In particular, calling psa_mac_abort() after the operation has been</span></div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span> <span class="comment"> * terminated by a call to psa_mac_abort(), psa_mac_sign_finish() or</span></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span> <span class="comment"> * psa_mac_verify_finish() is safe and has no effect.</span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span> <span class="comment"> *</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span> <span class="comment"> * \param[in,out] operation Initialized MAC operation.</span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span> <span class="comment"> *</span></div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span> <span class="comment"> */</span></div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group___m_a_c.html#gacd8dd54855ba1bc0a03f104f252884fd">psa_mac_abort</a>(<a class="code" href="structpsa__mac__operation__s.html">psa_mac_operation_t</a> *operation);</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span> <span class="comment"></span></div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span> <span class="comment">/**@}*/</span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span> <span class="comment"></span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span> <span class="comment">/** \defgroup cipher Symmetric ciphers</span></div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span> <span class="comment"> * @{</span></div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span> <span class="comment"> */</span></div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span> <span class="comment"></span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span> <span class="comment">/** Encrypt a message using a symmetric cipher.</span></div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span> <span class="comment"> *</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span> <span class="comment"> * This function encrypts a message with a random IV (initialization</span></div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span> <span class="comment"> * vector). Use the multipart operation interface with a</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span> <span class="comment"> * #psa_cipher_operation_t object to provide other forms of IV.</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span> <span class="comment"> *</span></div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span> <span class="comment"> * \param handle                Handle to the key to use for the operation.</span></div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span> <span class="comment"> *                              It must remain valid until the operation</span></div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span> <span class="comment"> *                              terminates.</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span> <span class="comment"> * \param alg                   The cipher algorithm to compute</span></div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span> <span class="comment"> *                              (\c PSA_ALG_XXX value such that</span></div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span> <span class="comment"> *                              #PSA_ALG_IS_CIPHER(\p alg) is true).</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span> <span class="comment"> * \param[in] input             Buffer containing the message to encrypt.</span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span> <span class="comment"> * \param input_length          Size of the \p input buffer in bytes.</span></div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span> <span class="comment"> * \param[out] output           Buffer where the output is to be written.</span></div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span> <span class="comment"> *                              The output contains the IV followed by</span></div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span> <span class="comment"> *                              the ciphertext proper.</span></div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span> <span class="comment"> * \param output_size           Size of the \p output buffer in bytes.</span></div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span> <span class="comment"> * \param[out] output_length    On success, the number of bytes</span></div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span> <span class="comment"> *                              that make up the output.</span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span> <span class="comment"> *</span></div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span> <span class="comment"> *         \p handle is not compatible with \p alg.</span></div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span> <span class="comment"> *         \p alg is not supported or is not a cipher algorithm.</span></div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span> <span class="comment"> * \retval #PSA_ERROR_BUFFER_TOO_SMALL</span></div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span> <span class="comment"> */</span></div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__cipher.html#ga61f02fbfa681c2659546eca52277dbf1">psa_cipher_encrypt</a>(psa_key_handle_t handle,</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>                                 <a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> alg,</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>                                 <span class="keyword">const</span> uint8_t *input,</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>                                 <span class="keywordtype">size_t</span> input_length,</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>                                 uint8_t *output,</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>                                 <span class="keywordtype">size_t</span> output_size,</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>                                 <span class="keywordtype">size_t</span> *output_length);</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span> <span class="comment"></span></div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span> <span class="comment">/** Decrypt a message using a symmetric cipher.</span></div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span> <span class="comment"> *</span></div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span> <span class="comment"> * This function decrypts a message encrypted with a symmetric cipher.</span></div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span> <span class="comment"> *</span></div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span> <span class="comment"> * \param handle                Handle to the key to use for the operation.</span></div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span> <span class="comment"> *                              It must remain valid until the operation</span></div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span> <span class="comment"> *                              terminates.</span></div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span> <span class="comment"> * \param alg                   The cipher algorithm to compute</span></div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span> <span class="comment"> *                              (\c PSA_ALG_XXX value such that</span></div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span> <span class="comment"> *                              #PSA_ALG_IS_CIPHER(\p alg) is true).</span></div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span> <span class="comment"> * \param[in] input             Buffer containing the message to decrypt.</span></div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span> <span class="comment"> *                              This consists of the IV followed by the</span></div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span> <span class="comment"> *                              ciphertext proper.</span></div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span> <span class="comment"> * \param input_length          Size of the \p input buffer in bytes.</span></div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span> <span class="comment"> * \param[out] output           Buffer where the plaintext is to be written.</span></div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span> <span class="comment"> * \param output_size           Size of the \p output buffer in bytes.</span></div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span> <span class="comment"> * \param[out] output_length    On success, the number of bytes</span></div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span> <span class="comment"> *                              that make up the output.</span></div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span> <span class="comment"> *</span></div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span> <span class="comment"> *         \p handle is not compatible with \p alg.</span></div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span> <span class="comment"> *         \p alg is not supported or is not a cipher algorithm.</span></div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span> <span class="comment"> * \retval #PSA_ERROR_BUFFER_TOO_SMALL</span></div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span> <span class="comment"> */</span></div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__cipher.html#gab3593f5f14d8c0431dd306d80929215e">psa_cipher_decrypt</a>(psa_key_handle_t handle,</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>                                 <a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> alg,</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>                                 <span class="keyword">const</span> uint8_t *input,</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>                                 <span class="keywordtype">size_t</span> input_length,</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>                                 uint8_t *output,</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>                                 <span class="keywordtype">size_t</span> output_size,</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>                                 <span class="keywordtype">size_t</span> *output_length);</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span> <span class="comment"></span></div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span> <span class="comment">/** The type of the state data structure for multipart cipher operations.</span></div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span> <span class="comment"> *</span></div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span> <span class="comment"> * Before calling any function on a cipher operation object, the application</span></div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span> <span class="comment"> * must initialize it by any of the following means:</span></div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span> <span class="comment"> * - Set the structure to all-bits-zero, for example:</span></div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span> <span class="comment"> *   \code</span></div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span> <span class="comment"> *   psa_cipher_operation_t operation;</span></div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span> <span class="comment"> *   memset(&amp;operation, 0, sizeof(operation));</span></div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span> <span class="comment"> *   \endcode</span></div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span> <span class="comment"> * - Initialize the structure to logical zero values, for example:</span></div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span> <span class="comment"> *   \code</span></div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span> <span class="comment"> *   psa_cipher_operation_t operation = {0};</span></div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span> <span class="comment"> *   \endcode</span></div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span> <span class="comment"> * - Initialize the structure to the initializer #PSA_CIPHER_OPERATION_INIT,</span></div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span> <span class="comment"> *   for example:</span></div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span> <span class="comment"> *   \code</span></div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span> <span class="comment"> *   psa_cipher_operation_t operation = PSA_CIPHER_OPERATION_INIT;</span></div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span> <span class="comment"> *   \endcode</span></div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span> <span class="comment"> * - Assign the result of the function psa_cipher_operation_init()</span></div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span> <span class="comment"> *   to the structure, for example:</span></div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span> <span class="comment"> *   \code</span></div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span> <span class="comment"> *   psa_cipher_operation_t operation;</span></div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span> <span class="comment"> *   operation = psa_cipher_operation_init();</span></div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span> <span class="comment"> *   \endcode</span></div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span> <span class="comment"> *</span></div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span> <span class="comment"> * This is an implementation-defined \c struct. Applications should not</span></div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span> <span class="comment"> * make any assumptions about the content of this structure except</span></div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span> <span class="comment"> * as directed by the documentation of a specific implementation. */</span></div><div class="line"><a name="l01746"></a><span class="lineno"><a class="line" href="group__cipher.html#ga1399de29db657e3737bb09927aae51fa"> 1746</a></span> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structpsa__cipher__operation__s.html">psa_cipher_operation_s</a> <a class="code" href="structpsa__cipher__operation__s.html">psa_cipher_operation_t</a>;</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span> <span class="comment"></span></div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span> <span class="comment">/** \def PSA_CIPHER_OPERATION_INIT</span></div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span> <span class="comment"> *</span></div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span> <span class="comment"> * This macro returns a suitable initializer for a cipher operation object of</span></div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span> <span class="comment"> * type #psa_cipher_operation_t.</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span> <span class="comment"> */</span></div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span> <span class="preprocessor">#ifdef __DOXYGEN_ONLY__</span></div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span> <span class="comment">/* This is an example definition for documentation purposes.</span></div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span> <span class="comment"> * Implementations should define a suitable value in `crypto_struct.h`.</span></div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span> <span class="comment"> */</span></div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span> <span class="preprocessor">#define PSA_CIPHER_OPERATION_INIT {0}</span></div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span> <span class="preprocessor">#endif</span></div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span> <span class="comment"></span></div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span> <span class="comment">/** Return an initial value for a cipher operation object.</span></div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span> <span class="comment"> */</span></div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span> <span class="keyword">static</span> <a class="code" href="structpsa__cipher__operation__s.html">psa_cipher_operation_t</a> <a class="code" href="group__cipher.html#ga0e2a249d48ab4d4d9ef716d02e370ef9">psa_cipher_operation_init</a>(<span class="keywordtype">void</span>);</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span> <span class="comment"></span></div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span> <span class="comment">/** Set the key for a multipart symmetric encryption operation.</span></div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span> <span class="comment"> *</span></div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span> <span class="comment"> * The sequence of operations to encrypt a message with a symmetric cipher</span></div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span> <span class="comment"> * is as follows:</span></div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span> <span class="comment"> * -# Allocate an operation object which will be passed to all the functions</span></div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span> <span class="comment"> *    listed here.</span></div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span> <span class="comment"> * -# Initialize the operation object with one of the methods described in the</span></div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span> <span class="comment"> *    documentation for #psa_cipher_operation_t, e.g.</span></div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span> <span class="comment"> *    #PSA_CIPHER_OPERATION_INIT.</span></div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span> <span class="comment"> * -# Call psa_cipher_encrypt_setup() to specify the algorithm and key.</span></div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span> <span class="comment"> * -# Call either psa_cipher_generate_iv() or psa_cipher_set_iv() to</span></div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span> <span class="comment"> *    generate or set the IV (initialization vector). You should use</span></div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span> <span class="comment"> *    psa_cipher_generate_iv() unless the protocol you are implementing</span></div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span> <span class="comment"> *    requires a specific IV value.</span></div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span> <span class="comment"> * -# Call psa_cipher_update() zero, one or more times, passing a fragment</span></div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span> <span class="comment"> *    of the message each time.</span></div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span> <span class="comment"> * -# Call psa_cipher_finish().</span></div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span> <span class="comment"> *</span></div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span> <span class="comment"> * If an error occurs at any step after a call to psa_cipher_encrypt_setup(),</span></div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span> <span class="comment"> * the operation will need to be reset by a call to psa_cipher_abort(). The</span></div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span> <span class="comment"> * application may call psa_cipher_abort() at any time after the operation</span></div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span> <span class="comment"> * has been initialized.</span></div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span> <span class="comment"> *</span></div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span> <span class="comment"> * After a successful call to psa_cipher_encrypt_setup(), the application must</span></div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span> <span class="comment"> * eventually terminate the operation. The following events terminate an</span></div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span> <span class="comment"> * operation:</span></div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span> <span class="comment"> * - A successful call to psa_cipher_finish().</span></div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span> <span class="comment"> * - A call to psa_cipher_abort().</span></div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span> <span class="comment"> *</span></div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span> <span class="comment"> * \param[in,out] operation     The operation object to set up. It must have</span></div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span> <span class="comment"> *                              been initialized as per the documentation for</span></div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span> <span class="comment"> *                              #psa_cipher_operation_t and not yet in use.</span></div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span> <span class="comment"> * \param handle                Handle to the key to use for the operation.</span></div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span> <span class="comment"> *                              It must remain valid until the operation</span></div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span> <span class="comment"> *                              terminates.</span></div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span> <span class="comment"> * \param alg                   The cipher algorithm to compute</span></div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span> <span class="comment"> *                              (\c PSA_ALG_XXX value such that</span></div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span> <span class="comment"> *                              #PSA_ALG_IS_CIPHER(\p alg) is true).</span></div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span> <span class="comment"> *</span></div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span> <span class="comment"> *         \p handle is not compatible with \p alg.</span></div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span> <span class="comment"> *         \p alg is not supported or is not a cipher algorithm.</span></div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span> <span class="comment"> *         The operation state is not valid (it must be inactive).</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span> <span class="comment"> */</span></div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__cipher.html#ga587374c0eb8137a572f8e2fc409bb2b4">psa_cipher_encrypt_setup</a>(<a class="code" href="structpsa__cipher__operation__s.html">psa_cipher_operation_t</a> *operation,</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>                                       psa_key_handle_t handle,</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>                                       <a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> alg);</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span> <span class="comment"></span></div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span> <span class="comment">/** Set the key for a multipart symmetric decryption operation.</span></div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span> <span class="comment"> *</span></div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span> <span class="comment"> * The sequence of operations to decrypt a message with a symmetric cipher</span></div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span> <span class="comment"> * is as follows:</span></div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span> <span class="comment"> * -# Allocate an operation object which will be passed to all the functions</span></div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span> <span class="comment"> *    listed here.</span></div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span> <span class="comment"> * -# Initialize the operation object with one of the methods described in the</span></div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span> <span class="comment"> *    documentation for #psa_cipher_operation_t, e.g.</span></div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span> <span class="comment"> *    #PSA_CIPHER_OPERATION_INIT.</span></div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span> <span class="comment"> * -# Call psa_cipher_decrypt_setup() to specify the algorithm and key.</span></div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span> <span class="comment"> * -# Call psa_cipher_set_iv() with the IV (initialization vector) for the</span></div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span> <span class="comment"> *    decryption. If the IV is prepended to the ciphertext, you can call</span></div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span> <span class="comment"> *    psa_cipher_update() on a buffer containing the IV followed by the</span></div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span> <span class="comment"> *    beginning of the message.</span></div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span> <span class="comment"> * -# Call psa_cipher_update() zero, one or more times, passing a fragment</span></div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span> <span class="comment"> *    of the message each time.</span></div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span> <span class="comment"> * -# Call psa_cipher_finish().</span></div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span> <span class="comment"> *</span></div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span> <span class="comment"> * If an error occurs at any step after a call to psa_cipher_decrypt_setup(),</span></div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span> <span class="comment"> * the operation will need to be reset by a call to psa_cipher_abort(). The</span></div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span> <span class="comment"> * application may call psa_cipher_abort() at any time after the operation</span></div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span> <span class="comment"> * has been initialized.</span></div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span> <span class="comment"> *</span></div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span> <span class="comment"> * After a successful call to psa_cipher_decrypt_setup(), the application must</span></div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span> <span class="comment"> * eventually terminate the operation. The following events terminate an</span></div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span> <span class="comment"> * operation:</span></div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span> <span class="comment"> * - A successful call to psa_cipher_finish().</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span> <span class="comment"> * - A call to psa_cipher_abort().</span></div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span> <span class="comment"> *</span></div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span> <span class="comment"> * \param[in,out] operation     The operation object to set up. It must have</span></div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span> <span class="comment"> *                              been initialized as per the documentation for</span></div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span> <span class="comment"> *                              #psa_cipher_operation_t and not yet in use.</span></div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span> <span class="comment"> * \param handle                Handle to the key to use for the operation.</span></div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span> <span class="comment"> *                              It must remain valid until the operation</span></div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span> <span class="comment"> *                              terminates.</span></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span> <span class="comment"> * \param alg                   The cipher algorithm to compute</span></div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span> <span class="comment"> *                              (\c PSA_ALG_XXX value such that</span></div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span> <span class="comment"> *                              #PSA_ALG_IS_CIPHER(\p alg) is true).</span></div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span> <span class="comment"> *</span></div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span> <span class="comment"> *         \p handle is not compatible with \p alg.</span></div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span> <span class="comment"> *         \p alg is not supported or is not a cipher algorithm.</span></div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span> <span class="comment"> *         The operation state is not valid (it must be inactive).</span></div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span> <span class="comment"> */</span></div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__cipher.html#gaa4ba3a167066eaef2ea49abc5dcd1d4b">psa_cipher_decrypt_setup</a>(<a class="code" href="structpsa__cipher__operation__s.html">psa_cipher_operation_t</a> *operation,</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>                                       psa_key_handle_t handle,</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>                                       <a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> alg);</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span> <span class="comment"></span></div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span> <span class="comment">/** Generate an IV for a symmetric encryption operation.</span></div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span> <span class="comment"> *</span></div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span> <span class="comment"> * This function generates a random IV (initialization vector), nonce</span></div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span> <span class="comment"> * or initial counter value for the encryption operation as appropriate</span></div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span> <span class="comment"> * for the chosen algorithm, key type and key size.</span></div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span> <span class="comment"> *</span></div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span> <span class="comment"> * The application must call psa_cipher_encrypt_setup() before</span></div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span> <span class="comment"> * calling this function.</span></div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span> <span class="comment"> *</span></div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span> <span class="comment"> * If this function returns an error status, the operation enters an error</span></div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span> <span class="comment"> * state and must be aborted by calling psa_cipher_abort().</span></div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span> <span class="comment"> *</span></div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span> <span class="comment"> * \param[in,out] operation     Active cipher operation.</span></div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span> <span class="comment"> * \param[out] iv               Buffer where the generated IV is to be written.</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span> <span class="comment"> * \param iv_size               Size of the \p iv buffer in bytes.</span></div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span> <span class="comment"> * \param[out] iv_length        On success, the number of bytes of the</span></div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span> <span class="comment"> *                              generated IV.</span></div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span> <span class="comment"> *</span></div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span> <span class="comment"> *         The operation state is not valid (it must be active, with no IV set).</span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span> <span class="comment"> * \retval #PSA_ERROR_BUFFER_TOO_SMALL</span></div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span> <span class="comment"> *         The size of the \p iv buffer is too small.</span></div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span> <span class="comment"> */</span></div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__cipher.html#ga29fd7d32a5729226a2f73e7b6487bd8a">psa_cipher_generate_iv</a>(<a class="code" href="structpsa__cipher__operation__s.html">psa_cipher_operation_t</a> *operation,</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>                                     uint8_t *iv,</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>                                     <span class="keywordtype">size_t</span> iv_size,</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>                                     <span class="keywordtype">size_t</span> *iv_length);</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span> <span class="comment"></span></div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span> <span class="comment">/** Set the IV for a symmetric encryption or decryption operation.</span></div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span> <span class="comment"> *</span></div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span> <span class="comment"> * This function sets the IV (initialization vector), nonce</span></div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span> <span class="comment"> * or initial counter value for the encryption or decryption operation.</span></div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span> <span class="comment"> *</span></div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span> <span class="comment"> * The application must call psa_cipher_encrypt_setup() before</span></div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span> <span class="comment"> * calling this function.</span></div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span> <span class="comment"> *</span></div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span> <span class="comment"> * If this function returns an error status, the operation enters an error</span></div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span> <span class="comment"> * state and must be aborted by calling psa_cipher_abort().</span></div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span> <span class="comment"> *</span></div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span> <span class="comment"> * \note When encrypting, applications should use psa_cipher_generate_iv()</span></div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span> <span class="comment"> * instead of this function, unless implementing a protocol that requires</span></div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span> <span class="comment"> * a non-random IV.</span></div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span> <span class="comment"> *</span></div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span> <span class="comment"> * \param[in,out] operation     Active cipher operation.</span></div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span> <span class="comment"> * \param[in] iv                Buffer containing the IV to use.</span></div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span> <span class="comment"> * \param iv_length             Size of the IV in bytes.</span></div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span> <span class="comment"> *</span></div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span> <span class="comment"> *         The operation state is not valid (it must be an active cipher</span></div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span> <span class="comment"> *         encrypt operation, with no IV set).</span></div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span> <span class="comment"> *         The size of \p iv is not acceptable for the chosen algorithm,</span></div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span> <span class="comment"> *         or the chosen algorithm does not use an IV.</span></div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span> <span class="comment"> */</span></div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__cipher.html#ga9caddac1a429a5032d6d4a907fb70ba1">psa_cipher_set_iv</a>(<a class="code" href="structpsa__cipher__operation__s.html">psa_cipher_operation_t</a> *operation,</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>                                <span class="keyword">const</span> uint8_t *iv,</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>                                <span class="keywordtype">size_t</span> iv_length);</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span> <span class="comment"></span></div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span> <span class="comment">/** Encrypt or decrypt a message fragment in an active cipher operation.</span></div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span> <span class="comment"> *</span></div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span> <span class="comment"> * Before calling this function, you must:</span></div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span> <span class="comment"> * 1. Call either psa_cipher_encrypt_setup() or psa_cipher_decrypt_setup().</span></div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span> <span class="comment"> *    The choice of setup function determines whether this function</span></div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span> <span class="comment"> *    encrypts or decrypts its input.</span></div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span> <span class="comment"> * 2. If the algorithm requires an IV, call psa_cipher_generate_iv()</span></div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span> <span class="comment"> *    (recommended when encrypting) or psa_cipher_set_iv().</span></div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span> <span class="comment"> *</span></div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span> <span class="comment"> * If this function returns an error status, the operation enters an error</span></div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span> <span class="comment"> * state and must be aborted by calling psa_cipher_abort().</span></div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span> <span class="comment"> *</span></div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span> <span class="comment"> * \param[in,out] operation     Active cipher operation.</span></div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span> <span class="comment"> * \param[in] input             Buffer containing the message fragment to</span></div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span> <span class="comment"> *                              encrypt or decrypt.</span></div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span> <span class="comment"> * \param input_length          Size of the \p input buffer in bytes.</span></div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span> <span class="comment"> * \param[out] output           Buffer where the output is to be written.</span></div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span> <span class="comment"> * \param output_size           Size of the \p output buffer in bytes.</span></div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span> <span class="comment"> * \param[out] output_length    On success, the number of bytes</span></div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span> <span class="comment"> *                              that make up the returned output.</span></div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span> <span class="comment"> *</span></div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span> <span class="comment"> *         The operation state is not valid (it must be active, with an IV set</span></div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span> <span class="comment"> *         if required for the algorithm).</span></div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span> <span class="comment"> * \retval #PSA_ERROR_BUFFER_TOO_SMALL</span></div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span> <span class="comment"> *         The size of the \p output buffer is too small.</span></div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span> <span class="comment"> */</span></div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__cipher.html#gac3ca27ac6682917c48247d01fd96cd0f">psa_cipher_update</a>(<a class="code" href="structpsa__cipher__operation__s.html">psa_cipher_operation_t</a> *operation,</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>                                <span class="keyword">const</span> uint8_t *input,</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>                                <span class="keywordtype">size_t</span> input_length,</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>                                uint8_t *output,</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>                                <span class="keywordtype">size_t</span> output_size,</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>                                <span class="keywordtype">size_t</span> *output_length);</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span> <span class="comment"></span></div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span> <span class="comment">/** Finish encrypting or decrypting a message in a cipher operation.</span></div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span> <span class="comment"> *</span></div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span> <span class="comment"> * The application must call psa_cipher_encrypt_setup() or</span></div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span> <span class="comment"> * psa_cipher_decrypt_setup() before calling this function. The choice</span></div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span> <span class="comment"> * of setup function determines whether this function encrypts or</span></div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span> <span class="comment"> * decrypts its input.</span></div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span> <span class="comment"> *</span></div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span> <span class="comment"> * This function finishes the encryption or decryption of the message</span></div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span> <span class="comment"> * formed by concatenating the inputs passed to preceding calls to</span></div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span> <span class="comment"> * psa_cipher_update().</span></div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span> <span class="comment"> *</span></div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span> <span class="comment"> * When this function returns successfuly, the operation becomes inactive.</span></div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span> <span class="comment"> * If this function returns an error status, the operation enters an error</span></div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span> <span class="comment"> * state and must be aborted by calling psa_cipher_abort().</span></div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span> <span class="comment"> *</span></div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span> <span class="comment"> * \param[in,out] operation     Active cipher operation.</span></div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span> <span class="comment"> * \param[out] output           Buffer where the output is to be written.</span></div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span> <span class="comment"> * \param output_size           Size of the \p output buffer in bytes.</span></div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span> <span class="comment"> * \param[out] output_length    On success, the number of bytes</span></div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span> <span class="comment"> *                              that make up the returned output.</span></div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span> <span class="comment"> *</span></div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span> <span class="comment"> *         The total input size passed to this operation is not valid for</span></div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span> <span class="comment"> *         this particular algorithm. For example, the algorithm is a based</span></div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span> <span class="comment"> *         on block cipher and requires a whole number of blocks, but the</span></div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span> <span class="comment"> *         total input size is not a multiple of the block size.</span></div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_PADDING</span></div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span> <span class="comment"> *         This is a decryption operation for an algorithm that includes</span></div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span> <span class="comment"> *         padding, and the ciphertext does not contain valid padding.</span></div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span> <span class="comment"> *         The operation state is not valid (it must be active, with an IV set</span></div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span> <span class="comment"> *         if required for the algorithm).</span></div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span> <span class="comment"> * \retval #PSA_ERROR_BUFFER_TOO_SMALL</span></div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span> <span class="comment"> *         The size of the \p output buffer is too small.</span></div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span> <span class="comment"> */</span></div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__cipher.html#ga1dcb58b8befe23f8a4d7a1d49c99249b">psa_cipher_finish</a>(<a class="code" href="structpsa__cipher__operation__s.html">psa_cipher_operation_t</a> *operation,</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>                                uint8_t *output,</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>                                <span class="keywordtype">size_t</span> output_size,</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>                                <span class="keywordtype">size_t</span> *output_length);</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span> <span class="comment"></span></div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span> <span class="comment">/** Abort a cipher operation.</span></div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span> <span class="comment"> *</span></div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span> <span class="comment"> * Aborting an operation frees all associated resources except for the</span></div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span> <span class="comment"> * \p operation structure itself. Once aborted, the operation object</span></div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span> <span class="comment"> * can be reused for another operation by calling</span></div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span> <span class="comment"> * psa_cipher_encrypt_setup() or psa_cipher_decrypt_setup() again.</span></div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span> <span class="comment"> *</span></div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span> <span class="comment"> * You may call this function any time after the operation object has</span></div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span> <span class="comment"> * been initialized as described in #psa_cipher_operation_t.</span></div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span> <span class="comment"> *</span></div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span> <span class="comment"> * In particular, calling psa_cipher_abort() after the operation has been</span></div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span> <span class="comment"> * terminated by a call to psa_cipher_abort() or psa_cipher_finish()</span></div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span> <span class="comment"> * is safe and has no effect.</span></div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span> <span class="comment"> *</span></div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span> <span class="comment"> * \param[in,out] operation     Initialized cipher operation.</span></div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span> <span class="comment"> *</span></div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span> <span class="comment"> */</span></div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__cipher.html#gaad482cdca2098bca0620596aaa02eaa4">psa_cipher_abort</a>(<a class="code" href="structpsa__cipher__operation__s.html">psa_cipher_operation_t</a> *operation);</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span> <span class="comment"></span></div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span> <span class="comment">/**@}*/</span></div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span> <span class="comment"></span></div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span> <span class="comment">/** \defgroup aead Authenticated encryption with associated data (AEAD)</span></div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span> <span class="comment"> * @{</span></div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span> <span class="comment"> */</span></div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span> <span class="comment"></span></div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span> <span class="comment">/** Process an authenticated encryption operation.</span></div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span> <span class="comment"> *</span></div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span> <span class="comment"> * \param handle                  Handle to the key to use for the operation.</span></div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span> <span class="comment"> * \param alg                     The AEAD algorithm to compute</span></div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span> <span class="comment"> *                                (\c PSA_ALG_XXX value such that</span></div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span> <span class="comment"> *                                #PSA_ALG_IS_AEAD(\p alg) is true).</span></div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span> <span class="comment"> * \param[in] nonce               Nonce or IV to use.</span></div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span> <span class="comment"> * \param nonce_length            Size of the \p nonce buffer in bytes.</span></div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span> <span class="comment"> * \param[in] additional_data     Additional data that will be authenticated</span></div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span> <span class="comment"> *                                but not encrypted.</span></div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span> <span class="comment"> * \param additional_data_length  Size of \p additional_data in bytes.</span></div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span> <span class="comment"> * \param[in] plaintext           Data that will be authenticated and</span></div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span> <span class="comment"> *                                encrypted.</span></div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span> <span class="comment"> * \param plaintext_length        Size of \p plaintext in bytes.</span></div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span> <span class="comment"> * \param[out] ciphertext         Output buffer for the authenticated and</span></div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span> <span class="comment"> *                                encrypted data. The additional data is not</span></div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span> <span class="comment"> *                                part of this output. For algorithms where the</span></div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span> <span class="comment"> *                                encrypted data and the authentication tag</span></div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span> <span class="comment"> *                                are defined as separate outputs, the</span></div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span> <span class="comment"> *                                authentication tag is appended to the</span></div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span> <span class="comment"> *                                encrypted data.</span></div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span> <span class="comment"> * \param ciphertext_size         Size of the \p ciphertext buffer in bytes.</span></div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span> <span class="comment"> *                                This must be at least</span></div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span> <span class="comment"> *                                #PSA_AEAD_ENCRYPT_OUTPUT_SIZE(\p alg,</span></div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span> <span class="comment"> *                                \p plaintext_length).</span></div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span> <span class="comment"> * \param[out] ciphertext_length  On success, the size of the output</span></div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span> <span class="comment"> *                                in the \p ciphertext buffer.</span></div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span> <span class="comment"> *</span></div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span> <span class="comment"> *         \p handle is not compatible with \p alg.</span></div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span> <span class="comment"> *         \p alg is not supported or is not an AEAD algorithm.</span></div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span> <span class="comment"> * \retval #PSA_ERROR_BUFFER_TOO_SMALL</span></div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span> <span class="comment"> *         \p ciphertext_size is too small</span></div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span> <span class="comment"> */</span></div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__aead.html#gae72e1eb3c2da3ebd843bb9c8db8df509">psa_aead_encrypt</a>(psa_key_handle_t handle,</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>                               <a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> alg,</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>                               <span class="keyword">const</span> uint8_t *nonce,</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>                               <span class="keywordtype">size_t</span> nonce_length,</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>                               <span class="keyword">const</span> uint8_t *additional_data,</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>                               <span class="keywordtype">size_t</span> additional_data_length,</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>                               <span class="keyword">const</span> uint8_t *plaintext,</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>                               <span class="keywordtype">size_t</span> plaintext_length,</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>                               uint8_t *ciphertext,</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>                               <span class="keywordtype">size_t</span> ciphertext_size,</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>                               <span class="keywordtype">size_t</span> *ciphertext_length);</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span> <span class="comment"></span></div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span> <span class="comment">/** Process an authenticated decryption operation.</span></div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span> <span class="comment"> *</span></div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span> <span class="comment"> * \param handle                  Handle to the key to use for the operation.</span></div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span> <span class="comment"> * \param alg                     The AEAD algorithm to compute</span></div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span> <span class="comment"> *                                (\c PSA_ALG_XXX value such that</span></div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span> <span class="comment"> *                                #PSA_ALG_IS_AEAD(\p alg) is true).</span></div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span> <span class="comment"> * \param[in] nonce               Nonce or IV to use.</span></div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span> <span class="comment"> * \param nonce_length            Size of the \p nonce buffer in bytes.</span></div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span> <span class="comment"> * \param[in] additional_data     Additional data that has been authenticated</span></div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span> <span class="comment"> *                                but not encrypted.</span></div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span> <span class="comment"> * \param additional_data_length  Size of \p additional_data in bytes.</span></div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span> <span class="comment"> * \param[in] ciphertext          Data that has been authenticated and</span></div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span> <span class="comment"> *                                encrypted. For algorithms where the</span></div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span> <span class="comment"> *                                encrypted data and the authentication tag</span></div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span> <span class="comment"> *                                are defined as separate inputs, the buffer</span></div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span> <span class="comment"> *                                must contain the encrypted data followed</span></div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span> <span class="comment"> *                                by the authentication tag.</span></div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span> <span class="comment"> * \param ciphertext_length       Size of \p ciphertext in bytes.</span></div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span> <span class="comment"> * \param[out] plaintext          Output buffer for the decrypted data.</span></div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span> <span class="comment"> * \param plaintext_size          Size of the \p plaintext buffer in bytes.</span></div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span> <span class="comment"> *                                This must be at least</span></div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span> <span class="comment"> *                                #PSA_AEAD_DECRYPT_OUTPUT_SIZE(\p alg,</span></div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span> <span class="comment"> *                                \p ciphertext_length).</span></div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span> <span class="comment"> * \param[out] plaintext_length   On success, the size of the output</span></div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span> <span class="comment"> *                                in the \p plaintext buffer.</span></div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span> <span class="comment"> *</span></div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_SIGNATURE</span></div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span> <span class="comment"> *         The ciphertext is not authentic.</span></div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span> <span class="comment"> *         \p handle is not compatible with \p alg.</span></div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span> <span class="comment"> *         \p alg is not supported or is not an AEAD algorithm.</span></div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span> <span class="comment"> * \retval #PSA_ERROR_BUFFER_TOO_SMALL</span></div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span> <span class="comment"> *         \p plaintext_size or \p nonce_length is too small</span></div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span> <span class="comment"> */</span></div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__aead.html#gae799f6196a22d50c216c947e0320d3ba">psa_aead_decrypt</a>(psa_key_handle_t handle,</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>                               <a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> alg,</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>                               <span class="keyword">const</span> uint8_t *nonce,</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>                               <span class="keywordtype">size_t</span> nonce_length,</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>                               <span class="keyword">const</span> uint8_t *additional_data,</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>                               <span class="keywordtype">size_t</span> additional_data_length,</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>                               <span class="keyword">const</span> uint8_t *ciphertext,</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>                               <span class="keywordtype">size_t</span> ciphertext_length,</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>                               uint8_t *plaintext,</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>                               <span class="keywordtype">size_t</span> plaintext_size,</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>                               <span class="keywordtype">size_t</span> *plaintext_length);</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span> <span class="comment"></span></div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span> <span class="comment">/** The type of the state data structure for multipart AEAD operations.</span></div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span> <span class="comment"> *</span></div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span> <span class="comment"> * Before calling any function on an AEAD operation object, the application</span></div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span> <span class="comment"> * must initialize it by any of the following means:</span></div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span> <span class="comment"> * - Set the structure to all-bits-zero, for example:</span></div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span> <span class="comment"> *   \code</span></div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span> <span class="comment"> *   psa_aead_operation_t operation;</span></div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span> <span class="comment"> *   memset(&amp;operation, 0, sizeof(operation));</span></div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span> <span class="comment"> *   \endcode</span></div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span> <span class="comment"> * - Initialize the structure to logical zero values, for example:</span></div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span> <span class="comment"> *   \code</span></div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span> <span class="comment"> *   psa_aead_operation_t operation = {0};</span></div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span> <span class="comment"> *   \endcode</span></div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span> <span class="comment"> * - Initialize the structure to the initializer #PSA_AEAD_OPERATION_INIT,</span></div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span> <span class="comment"> *   for example:</span></div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span> <span class="comment"> *   \code</span></div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span> <span class="comment"> *   psa_aead_operation_t operation = PSA_AEAD_OPERATION_INIT;</span></div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span> <span class="comment"> *   \endcode</span></div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span> <span class="comment"> * - Assign the result of the function psa_aead_operation_init()</span></div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span> <span class="comment"> *   to the structure, for example:</span></div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span> <span class="comment"> *   \code</span></div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span> <span class="comment"> *   psa_aead_operation_t operation;</span></div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span> <span class="comment"> *   operation = psa_aead_operation_init();</span></div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span> <span class="comment"> *   \endcode</span></div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span> <span class="comment"> *</span></div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span> <span class="comment"> * This is an implementation-defined \c struct. Applications should not</span></div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span> <span class="comment"> * make any assumptions about the content of this structure except</span></div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span> <span class="comment"> * as directed by the documentation of a specific implementation. */</span></div><div class="line"><a name="l02247"></a><span class="lineno"><a class="line" href="group__aead.html#ga14f6a01afbaa8c5b3d8c5d345cbaa3ed"> 2247</a></span> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structpsa__aead__operation__s.html">psa_aead_operation_s</a> <a class="code" href="structpsa__aead__operation__s.html">psa_aead_operation_t</a>;</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span> <span class="comment"></span></div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span> <span class="comment">/** \def PSA_AEAD_OPERATION_INIT</span></div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span> <span class="comment"> *</span></div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span> <span class="comment"> * This macro returns a suitable initializer for an AEAD operation object of</span></div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span> <span class="comment"> * type #psa_aead_operation_t.</span></div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span> <span class="comment"> */</span></div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span> <span class="preprocessor">#ifdef __DOXYGEN_ONLY__</span></div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span> <span class="comment">/* This is an example definition for documentation purposes.</span></div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span> <span class="comment"> * Implementations should define a suitable value in `crypto_struct.h`.</span></div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span> <span class="comment"> */</span></div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span> <span class="preprocessor">#define PSA_AEAD_OPERATION_INIT {0}</span></div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span> <span class="preprocessor">#endif</span></div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span> <span class="comment"></span></div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span> <span class="comment">/** Return an initial value for an AEAD operation object.</span></div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span> <span class="comment"> */</span></div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span> <span class="keyword">static</span> <a class="code" href="structpsa__aead__operation__s.html">psa_aead_operation_t</a> <a class="code" href="group__aead.html#ga286b61e83f1bdd5017568c4fd1939f89">psa_aead_operation_init</a>(<span class="keywordtype">void</span>);</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span> <span class="comment"></span></div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span> <span class="comment">/** Set the key for a multipart authenticated encryption operation.</span></div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span> <span class="comment"> *</span></div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span> <span class="comment"> * The sequence of operations to encrypt a message with authentication</span></div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span> <span class="comment"> * is as follows:</span></div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span> <span class="comment"> * -# Allocate an operation object which will be passed to all the functions</span></div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span> <span class="comment"> *    listed here.</span></div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span> <span class="comment"> * -# Initialize the operation object with one of the methods described in the</span></div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span> <span class="comment"> *    documentation for #psa_aead_operation_t, e.g.</span></div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span> <span class="comment"> *    #PSA_AEAD_OPERATION_INIT.</span></div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span> <span class="comment"> * -# Call psa_aead_encrypt_setup() to specify the algorithm and key.</span></div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span> <span class="comment"> * -# If needed, call psa_aead_set_lengths() to specify the length of the</span></div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span> <span class="comment"> *    inputs to the subsequent calls to psa_aead_update_ad() and</span></div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span> <span class="comment"> *    psa_aead_update(). See the documentation of psa_aead_set_lengths()</span></div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span> <span class="comment"> *    for details.</span></div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span> <span class="comment"> * -# Call either psa_aead_generate_nonce() or psa_aead_set_nonce() to</span></div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span> <span class="comment"> *    generate or set the nonce. You should use</span></div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span> <span class="comment"> *    psa_aead_generate_nonce() unless the protocol you are implementing</span></div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span> <span class="comment"> *    requires a specific nonce value.</span></div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span> <span class="comment"> * -# Call psa_aead_update_ad() zero, one or more times, passing a fragment</span></div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span> <span class="comment"> *    of the non-encrypted additional authenticated data each time.</span></div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span> <span class="comment"> * -# Call psa_aead_update() zero, one or more times, passing a fragment</span></div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span> <span class="comment"> *    of the message to encrypt each time.</span></div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span> <span class="comment"> * -# Call psa_aead_finish().</span></div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span> <span class="comment"> *</span></div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span> <span class="comment"> * If an error occurs at any step after a call to psa_aead_encrypt_setup(),</span></div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span> <span class="comment"> * the operation will need to be reset by a call to psa_aead_abort(). The</span></div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span> <span class="comment"> * application may call psa_aead_abort() at any time after the operation</span></div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span> <span class="comment"> * has been initialized.</span></div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span> <span class="comment"> *</span></div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span> <span class="comment"> * After a successful call to psa_aead_encrypt_setup(), the application must</span></div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span> <span class="comment"> * eventually terminate the operation. The following events terminate an</span></div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span> <span class="comment"> * operation:</span></div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span> <span class="comment"> * - A successful call to psa_aead_finish().</span></div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span> <span class="comment"> * - A call to psa_aead_abort().</span></div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span> <span class="comment"> *</span></div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span> <span class="comment"> * \param[in,out] operation     The operation object to set up. It must have</span></div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span> <span class="comment"> *                              been initialized as per the documentation for</span></div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span> <span class="comment"> *                              #psa_aead_operation_t and not yet in use.</span></div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span> <span class="comment"> * \param handle                Handle to the key to use for the operation.</span></div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span> <span class="comment"> *                              It must remain valid until the operation</span></div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span> <span class="comment"> *                              terminates.</span></div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span> <span class="comment"> * \param alg                   The AEAD algorithm to compute</span></div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span> <span class="comment"> *                              (\c PSA_ALG_XXX value such that</span></div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span> <span class="comment"> *                              #PSA_ALG_IS_AEAD(\p alg) is true).</span></div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span> <span class="comment"> *</span></div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span> <span class="comment"> *         The operation state is not valid (it must be inactive).</span></div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span> <span class="comment">  * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span> <span class="comment"> *         \p handle is not compatible with \p alg.</span></div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span> <span class="comment"> *         \p alg is not supported or is not an AEAD algorithm.</span></div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span> <span class="comment"> */</span></div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__aead.html#ga2732c40ce8f3619d41359a329e9b46c4">psa_aead_encrypt_setup</a>(<a class="code" href="structpsa__aead__operation__s.html">psa_aead_operation_t</a> *operation,</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>                                     psa_key_handle_t handle,</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>                                     <a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> alg);</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span> <span class="comment"></span></div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span> <span class="comment">/** Set the key for a multipart authenticated decryption operation.</span></div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span> <span class="comment"> *</span></div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span> <span class="comment"> * The sequence of operations to decrypt a message with authentication</span></div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span> <span class="comment"> * is as follows:</span></div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span> <span class="comment"> * -# Allocate an operation object which will be passed to all the functions</span></div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span> <span class="comment"> *    listed here.</span></div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span> <span class="comment"> * -# Initialize the operation object with one of the methods described in the</span></div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span> <span class="comment"> *    documentation for #psa_aead_operation_t, e.g.</span></div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span> <span class="comment"> *    #PSA_AEAD_OPERATION_INIT.</span></div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span> <span class="comment"> * -# Call psa_aead_decrypt_setup() to specify the algorithm and key.</span></div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span> <span class="comment"> * -# If needed, call psa_aead_set_lengths() to specify the length of the</span></div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span> <span class="comment"> *    inputs to the subsequent calls to psa_aead_update_ad() and</span></div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span> <span class="comment"> *    psa_aead_update(). See the documentation of psa_aead_set_lengths()</span></div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span> <span class="comment"> *    for details.</span></div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span> <span class="comment"> * -# Call psa_aead_set_nonce() with the nonce for the decryption.</span></div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span> <span class="comment"> * -# Call psa_aead_update_ad() zero, one or more times, passing a fragment</span></div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span> <span class="comment"> *    of the non-encrypted additional authenticated data each time.</span></div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span> <span class="comment"> * -# Call psa_aead_update() zero, one or more times, passing a fragment</span></div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span> <span class="comment"> *    of the ciphertext to decrypt each time.</span></div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span> <span class="comment"> * -# Call psa_aead_verify().</span></div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span> <span class="comment"> *</span></div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span> <span class="comment"> * If an error occurs at any step after a call to psa_aead_decrypt_setup(),</span></div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span> <span class="comment"> * the operation will need to be reset by a call to psa_aead_abort(). The</span></div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span> <span class="comment"> * application may call psa_aead_abort() at any time after the operation</span></div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span> <span class="comment"> * has been initialized.</span></div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span> <span class="comment"> *</span></div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span> <span class="comment"> * After a successful call to psa_aead_decrypt_setup(), the application must</span></div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span> <span class="comment"> * eventually terminate the operation. The following events terminate an</span></div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span> <span class="comment"> * operation:</span></div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span> <span class="comment"> * - A successful call to psa_aead_verify().</span></div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span> <span class="comment"> * - A call to psa_aead_abort().</span></div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span> <span class="comment"> *</span></div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span> <span class="comment"> * \param[in,out] operation     The operation object to set up. It must have</span></div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span> <span class="comment"> *                              been initialized as per the documentation for</span></div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span> <span class="comment"> *                              #psa_aead_operation_t and not yet in use.</span></div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span> <span class="comment"> * \param handle                Handle to the key to use for the operation.</span></div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span> <span class="comment"> *                              It must remain valid until the operation</span></div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span> <span class="comment"> *                              terminates.</span></div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span> <span class="comment"> * \param alg                   The AEAD algorithm to compute</span></div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span> <span class="comment"> *                              (\c PSA_ALG_XXX value such that</span></div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span> <span class="comment"> *                              #PSA_ALG_IS_AEAD(\p alg) is true).</span></div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span> <span class="comment"> *</span></div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span> <span class="comment"> *         The operation state is not valid (it must be inactive).</span></div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span> <span class="comment">  * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span> <span class="comment"> *         \p handle is not compatible with \p alg.</span></div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span> <span class="comment"> *         \p alg is not supported or is not an AEAD algorithm.</span></div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span> <span class="comment"> */</span></div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__aead.html#gaaa5c5018e67a7a6514b7e76b9a14de26">psa_aead_decrypt_setup</a>(<a class="code" href="structpsa__aead__operation__s.html">psa_aead_operation_t</a> *operation,</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>                                     psa_key_handle_t handle,</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>                                     <a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> alg);</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span> <span class="comment"></span></div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span> <span class="comment">/** Generate a random nonce for an authenticated encryption operation.</span></div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span> <span class="comment"> *</span></div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span> <span class="comment"> * This function generates a random nonce for the authenticated encryption</span></div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span> <span class="comment"> * operation with an appropriate size for the chosen algorithm, key type</span></div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span> <span class="comment"> * and key size.</span></div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span> <span class="comment"> *</span></div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span> <span class="comment"> * The application must call psa_aead_encrypt_setup() before</span></div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span> <span class="comment"> * calling this function.</span></div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span> <span class="comment"> *</span></div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span> <span class="comment"> * If this function returns an error status, the operation enters an error</span></div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span> <span class="comment"> * state and must be aborted by calling psa_aead_abort().</span></div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span> <span class="comment"> *</span></div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span> <span class="comment"> * \param[in,out] operation     Active AEAD operation.</span></div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span> <span class="comment"> * \param[out] nonce            Buffer where the generated nonce is to be</span></div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span> <span class="comment"> *                              written.</span></div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span> <span class="comment"> * \param nonce_size            Size of the \p nonce buffer in bytes.</span></div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span> <span class="comment"> * \param[out] nonce_length     On success, the number of bytes of the</span></div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span> <span class="comment"> *                              generated nonce.</span></div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span> <span class="comment"> *</span></div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span> <span class="comment"> *         The operation state is not valid (it must be an active aead encrypt</span></div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span> <span class="comment">           operation, with no nonce set).</span></div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span> <span class="comment"> * \retval #PSA_ERROR_BUFFER_TOO_SMALL</span></div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span> <span class="comment"> *         The size of the \p nonce buffer is too small.</span></div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span> <span class="comment"> */</span></div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__aead.html#ga5799df1c555efd35970b65be51cb07d1">psa_aead_generate_nonce</a>(<a class="code" href="structpsa__aead__operation__s.html">psa_aead_operation_t</a> *operation,</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>                                      uint8_t *nonce,</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>                                      <span class="keywordtype">size_t</span> nonce_size,</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>                                      <span class="keywordtype">size_t</span> *nonce_length);</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span> <span class="comment"></span></div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span> <span class="comment">/** Set the nonce for an authenticated encryption or decryption operation.</span></div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span> <span class="comment"> *</span></div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span> <span class="comment"> * This function sets the nonce for the authenticated</span></div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span> <span class="comment"> * encryption or decryption operation.</span></div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span> <span class="comment"> *</span></div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span> <span class="comment"> * The application must call psa_aead_encrypt_setup() or</span></div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span> <span class="comment"> * psa_aead_decrypt_setup() before calling this function.</span></div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span> <span class="comment"> *</span></div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span> <span class="comment"> * If this function returns an error status, the operation enters an error</span></div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span> <span class="comment"> * state and must be aborted by calling psa_aead_abort().</span></div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span> <span class="comment"> *</span></div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span> <span class="comment"> * \note When encrypting, applications should use psa_aead_generate_nonce()</span></div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span> <span class="comment"> * instead of this function, unless implementing a protocol that requires</span></div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span> <span class="comment"> * a non-random IV.</span></div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span> <span class="comment"> *</span></div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span> <span class="comment"> * \param[in,out] operation     Active AEAD operation.</span></div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span> <span class="comment"> * \param[in] nonce             Buffer containing the nonce to use.</span></div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span> <span class="comment"> * \param nonce_length          Size of the nonce in bytes.</span></div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span> <span class="comment"> *</span></div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span> <span class="comment"> *         The operation state is not valid (it must be active, with no nonce</span></div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span> <span class="comment"> *         set).</span></div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span> <span class="comment"> *         The size of \p nonce is not acceptable for the chosen algorithm.</span></div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span> <span class="comment"> */</span></div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__aead.html#ga59132751a6f843d038924cb217b5e13b">psa_aead_set_nonce</a>(<a class="code" href="structpsa__aead__operation__s.html">psa_aead_operation_t</a> *operation,</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>                                 <span class="keyword">const</span> uint8_t *nonce,</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>                                 <span class="keywordtype">size_t</span> nonce_length);</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span> <span class="comment"></span></div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span> <span class="comment">/** Declare the lengths of the message and additional data for AEAD.</span></div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span> <span class="comment"> *</span></div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span> <span class="comment"> * The application must call this function before calling</span></div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span> <span class="comment"> * psa_aead_update_ad() or psa_aead_update() if the algorithm for</span></div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span> <span class="comment"> * the operation requires it. If the algorithm does not require it,</span></div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span> <span class="comment"> * calling this function is optional, but if this function is called</span></div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span> <span class="comment"> * then the implementation must enforce the lengths.</span></div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span> <span class="comment"> *</span></div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span> <span class="comment"> * You may call this function before or after setting the nonce with</span></div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span> <span class="comment"> * psa_aead_set_nonce() or psa_aead_generate_nonce().</span></div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span> <span class="comment"> *</span></div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span> <span class="comment"> * - For #PSA_ALG_CCM, calling this function is required.</span></div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span> <span class="comment"> * - For the other AEAD algorithms defined in this specification, calling</span></div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span> <span class="comment"> *   this function is not required.</span></div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span> <span class="comment"> * - For vendor-defined algorithm, refer to the vendor documentation.</span></div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span> <span class="comment"> *</span></div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span> <span class="comment"> * If this function returns an error status, the operation enters an error</span></div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span> <span class="comment"> * state and must be aborted by calling psa_aead_abort().</span></div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span> <span class="comment"> *</span></div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span> <span class="comment"> * \param[in,out] operation     Active AEAD operation.</span></div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span> <span class="comment"> * \param ad_length             Size of the non-encrypted additional</span></div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span> <span class="comment"> *                              authenticated data in bytes.</span></div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span> <span class="comment"> * \param plaintext_length      Size of the plaintext to encrypt in bytes.</span></div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span> <span class="comment"> *</span></div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span> <span class="comment"> *         The operation state is not valid (it must be active, and</span></div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span> <span class="comment"> *         psa_aead_update_ad() and psa_aead_update() must not have been</span></div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span> <span class="comment"> *         called yet).</span></div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span> <span class="comment"> *         At least one of the lengths is not acceptable for the chosen</span></div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span> <span class="comment"> *         algorithm.</span></div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span> <span class="comment"> */</span></div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__aead.html#gad3431e28d05002c2a7b0760610176050">psa_aead_set_lengths</a>(<a class="code" href="structpsa__aead__operation__s.html">psa_aead_operation_t</a> *operation,</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>                                   <span class="keywordtype">size_t</span> ad_length,</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>                                   <span class="keywordtype">size_t</span> plaintext_length);</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span> <span class="comment"></span></div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span> <span class="comment">/** Pass additional data to an active AEAD operation.</span></div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span> <span class="comment"> *</span></div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span> <span class="comment"> * Additional data is authenticated, but not encrypted.</span></div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span> <span class="comment"> *</span></div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span> <span class="comment"> * You may call this function multiple times to pass successive fragments</span></div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span> <span class="comment"> * of the additional data. You may not call this function after passing</span></div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span> <span class="comment"> * data to encrypt or decrypt with psa_aead_update().</span></div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span> <span class="comment"> *</span></div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span> <span class="comment"> * Before calling this function, you must:</span></div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span> <span class="comment"> * 1. Call either psa_aead_encrypt_setup() or psa_aead_decrypt_setup().</span></div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span> <span class="comment"> * 2. Set the nonce with psa_aead_generate_nonce() or psa_aead_set_nonce().</span></div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span> <span class="comment"> *</span></div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span> <span class="comment"> * If this function returns an error status, the operation enters an error</span></div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span> <span class="comment"> * state and must be aborted by calling psa_aead_abort().</span></div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span> <span class="comment"> *</span></div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span> <span class="comment"> * \warning When decrypting, until psa_aead_verify() has returned #PSA_SUCCESS,</span></div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span> <span class="comment"> *          there is no guarantee that the input is valid. Therefore, until</span></div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span> <span class="comment"> *          you have called psa_aead_verify() and it has returned #PSA_SUCCESS,</span></div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span> <span class="comment"> *          treat the input as untrusted and prepare to undo any action that</span></div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span> <span class="comment"> *          depends on the input if psa_aead_verify() returns an error status.</span></div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span> <span class="comment"> *</span></div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span> <span class="comment"> * \param[in,out] operation     Active AEAD operation.</span></div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span> <span class="comment"> * \param[in] input             Buffer containing the fragment of</span></div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span> <span class="comment"> *                              additional data.</span></div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span> <span class="comment"> * \param input_length          Size of the \p input buffer in bytes.</span></div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span> <span class="comment"> *</span></div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span> <span class="comment"> *         The operation state is not valid (it must be active, have a nonce</span></div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span> <span class="comment"> *         set, have lengths set if required by the algorithm, and</span></div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span> <span class="comment"> *         psa_aead_update() must not have been called yet).</span></div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span> <span class="comment"> *         The total input length overflows the additional data length that</span></div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span> <span class="comment"> *         was previously specified with psa_aead_set_lengths().</span></div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span> <span class="comment"> */</span></div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__aead.html#ga6d0eed03f832e5c9c91cb8adf2882569">psa_aead_update_ad</a>(<a class="code" href="structpsa__aead__operation__s.html">psa_aead_operation_t</a> *operation,</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>                                 <span class="keyword">const</span> uint8_t *input,</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>                                 <span class="keywordtype">size_t</span> input_length);</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span> <span class="comment"></span></div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span> <span class="comment">/** Encrypt or decrypt a message fragment in an active AEAD operation.</span></div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span> <span class="comment"> *</span></div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span> <span class="comment"> * Before calling this function, you must:</span></div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span> <span class="comment"> * 1. Call either psa_aead_encrypt_setup() or psa_aead_decrypt_setup().</span></div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span> <span class="comment"> *    The choice of setup function determines whether this function</span></div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span> <span class="comment"> *    encrypts or decrypts its input.</span></div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span> <span class="comment"> * 2. Set the nonce with psa_aead_generate_nonce() or psa_aead_set_nonce().</span></div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span> <span class="comment"> * 3. Call psa_aead_update_ad() to pass all the additional data.</span></div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span> <span class="comment"> *</span></div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span> <span class="comment"> * If this function returns an error status, the operation enters an error</span></div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span> <span class="comment"> * state and must be aborted by calling psa_aead_abort().</span></div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span> <span class="comment"> *</span></div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span> <span class="comment"> * \warning When decrypting, until psa_aead_verify() has returned #PSA_SUCCESS,</span></div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span> <span class="comment"> *          there is no guarantee that the input is valid. Therefore, until</span></div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span> <span class="comment"> *          you have called psa_aead_verify() and it has returned #PSA_SUCCESS:</span></div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span> <span class="comment"> *          - Do not use the output in any way other than storing it in a</span></div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span> <span class="comment"> *            confidential location. If you take any action that depends</span></div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span> <span class="comment"> *            on the tentative decrypted data, this action will need to be</span></div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span> <span class="comment"> *            undone if the input turns out not to be valid. Furthermore,</span></div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span> <span class="comment"> *            if an adversary can observe that this action took place</span></div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span> <span class="comment"> *            (for example through timing), they may be able to use this</span></div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span> <span class="comment"> *            fact as an oracle to decrypt any message encrypted with the</span></div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span> <span class="comment"> *            same key.</span></div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span> <span class="comment"> *          - In particular, do not copy the output anywhere but to a</span></div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span> <span class="comment"> *            memory or storage space that you have exclusive access to.</span></div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span> <span class="comment"> *</span></div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span> <span class="comment"> * This function does not require the input to be aligned to any</span></div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span> <span class="comment"> * particular block boundary. If the implementation can only process</span></div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span> <span class="comment"> * a whole block at a time, it must consume all the input provided, but</span></div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span> <span class="comment"> * it may delay the end of the corresponding output until a subsequent</span></div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span> <span class="comment"> * call to psa_aead_update(), psa_aead_finish() or psa_aead_verify()</span></div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span> <span class="comment"> * provides sufficient input. The amount of data that can be delayed</span></div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span> <span class="comment"> * in this way is bounded by #PSA_AEAD_UPDATE_OUTPUT_SIZE.</span></div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span> <span class="comment"> *</span></div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span> <span class="comment"> * \param[in,out] operation     Active AEAD operation.</span></div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span> <span class="comment"> * \param[in] input             Buffer containing the message fragment to</span></div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span> <span class="comment"> *                              encrypt or decrypt.</span></div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span> <span class="comment"> * \param input_length          Size of the \p input buffer in bytes.</span></div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span> <span class="comment"> * \param[out] output           Buffer where the output is to be written.</span></div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span> <span class="comment"> * \param output_size           Size of the \p output buffer in bytes.</span></div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span> <span class="comment"> *                              This must be at least</span></div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span> <span class="comment"> *                              #PSA_AEAD_UPDATE_OUTPUT_SIZE(\c alg,</span></div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span> <span class="comment"> *                              \p input_length) where \c alg is the</span></div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span> <span class="comment"> *                              algorithm that is being calculated.</span></div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span> <span class="comment"> * \param[out] output_length    On success, the number of bytes</span></div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span> <span class="comment"> *                              that make up the returned output.</span></div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span> <span class="comment"> *</span></div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span> <span class="comment"> *         The operation state is not valid (it must be active, have a nonce</span></div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span> <span class="comment"> *         set, and have lengths set if required by the algorithm).</span></div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span> <span class="comment"> * \retval #PSA_ERROR_BUFFER_TOO_SMALL</span></div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span> <span class="comment"> *         The size of the \p output buffer is too small.</span></div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span> <span class="comment"> *         You can determine a sufficient buffer size by calling</span></div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span> <span class="comment"> *         #PSA_AEAD_UPDATE_OUTPUT_SIZE(\c alg, \p input_length)</span></div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span> <span class="comment"> *         where \c alg is the algorithm that is being calculated.</span></div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span> <span class="comment"> *         The total length of input to psa_aead_update_ad() so far is</span></div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span> <span class="comment"> *         less than the additional data length that was previously</span></div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span> <span class="comment"> *         specified with psa_aead_set_lengths().</span></div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span> <span class="comment"> *         The total input length overflows the plaintext length that</span></div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span> <span class="comment"> *         was previously specified with psa_aead_set_lengths().</span></div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span> <span class="comment"> */</span></div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__aead.html#gaf6d49864951ca42136b4a9b71ea26e5c">psa_aead_update</a>(<a class="code" href="structpsa__aead__operation__s.html">psa_aead_operation_t</a> *operation,</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>                              <span class="keyword">const</span> uint8_t *input,</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>                              <span class="keywordtype">size_t</span> input_length,</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>                              uint8_t *output,</div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>                              <span class="keywordtype">size_t</span> output_size,</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>                              <span class="keywordtype">size_t</span> *output_length);</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span> <span class="comment"></span></div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span> <span class="comment">/** Finish encrypting a message in an AEAD operation.</span></div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span> <span class="comment"> *</span></div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span> <span class="comment"> * The operation must have been set up with psa_aead_encrypt_setup().</span></div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span> <span class="comment"> *</span></div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span> <span class="comment"> * This function finishes the authentication of the additional data</span></div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span> <span class="comment"> * formed by concatenating the inputs passed to preceding calls to</span></div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span> <span class="comment"> * psa_aead_update_ad() with the plaintext formed by concatenating the</span></div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span> <span class="comment"> * inputs passed to preceding calls to psa_aead_update().</span></div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span> <span class="comment"> *</span></div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span> <span class="comment"> * This function has two output buffers:</span></div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span> <span class="comment"> * - \p ciphertext contains trailing ciphertext that was buffered from</span></div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span> <span class="comment"> *   preceding calls to psa_aead_update().</span></div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span> <span class="comment"> * - \p tag contains the authentication tag. Its length is always</span></div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span> <span class="comment"> *   #PSA_AEAD_TAG_LENGTH(\c alg) where \c alg is the AEAD algorithm</span></div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span> <span class="comment"> *   that the operation performs.</span></div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span> <span class="comment"> *</span></div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span> <span class="comment"> * When this function returns successfuly, the operation becomes inactive.</span></div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span> <span class="comment"> * If this function returns an error status, the operation enters an error</span></div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span> <span class="comment"> * state and must be aborted by calling psa_aead_abort().</span></div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span> <span class="comment"> *</span></div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span> <span class="comment"> * \param[in,out] operation     Active AEAD operation.</span></div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span> <span class="comment"> * \param[out] ciphertext       Buffer where the last part of the ciphertext</span></div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span> <span class="comment"> *                              is to be written.</span></div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span> <span class="comment"> * \param ciphertext_size       Size of the \p ciphertext buffer in bytes.</span></div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span> <span class="comment"> *                              This must be at least</span></div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span> <span class="comment"> *                              #PSA_AEAD_FINISH_OUTPUT_SIZE(\c alg) where</span></div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span> <span class="comment"> *                              \c alg is the algorithm that is being</span></div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span> <span class="comment"> *                              calculated.</span></div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span> <span class="comment"> * \param[out] ciphertext_length On success, the number of bytes of</span></div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span> <span class="comment"> *                              returned ciphertext.</span></div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span> <span class="comment"> * \param[out] tag              Buffer where the authentication tag is</span></div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span> <span class="comment"> *                              to be written.</span></div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span> <span class="comment"> * \param tag_size              Size of the \p tag buffer in bytes.</span></div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span> <span class="comment"> *                              This must be at least</span></div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span> <span class="comment"> *                              #PSA_AEAD_TAG_LENGTH(\c alg) where \c alg is</span></div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span> <span class="comment"> *                              the algorithm that is being calculated.</span></div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span> <span class="comment"> * \param[out] tag_length       On success, the number of bytes</span></div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span> <span class="comment"> *                              that make up the returned tag.</span></div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span> <span class="comment"> *</span></div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span> <span class="comment"> *         The operation state is not valid (it must be an active encryption</span></div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span> <span class="comment"> *         operation with a nonce set).</span></div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span> <span class="comment"> * \retval #PSA_ERROR_BUFFER_TOO_SMALL</span></div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span> <span class="comment"> *         The size of the \p ciphertext or \p tag buffer is too small.</span></div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span> <span class="comment"> *         You can determine a sufficient buffer size for \p ciphertext by</span></div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span> <span class="comment"> *         calling #PSA_AEAD_FINISH_OUTPUT_SIZE(\c alg)</span></div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span> <span class="comment"> *         where \c alg is the algorithm that is being calculated.</span></div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span> <span class="comment"> *         You can determine a sufficient buffer size for \p tag by</span></div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span> <span class="comment"> *         calling #PSA_AEAD_TAG_LENGTH(\c alg).</span></div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span> <span class="comment"> *         The total length of input to psa_aead_update_ad() so far is</span></div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span> <span class="comment"> *         less than the additional data length that was previously</span></div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span> <span class="comment"> *         specified with psa_aead_set_lengths().</span></div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span> <span class="comment"> *         The total length of input to psa_aead_update() so far is</span></div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span> <span class="comment"> *         less than the plaintext length that was previously</span></div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span> <span class="comment"> *         specified with psa_aead_set_lengths().</span></div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span> <span class="comment"> */</span></div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__aead.html#ga759791bbe1763b377c3b5447641f1fc8">psa_aead_finish</a>(<a class="code" href="structpsa__aead__operation__s.html">psa_aead_operation_t</a> *operation,</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>                              uint8_t *ciphertext,</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>                              <span class="keywordtype">size_t</span> ciphertext_size,</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>                              <span class="keywordtype">size_t</span> *ciphertext_length,</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>                              uint8_t *tag,</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>                              <span class="keywordtype">size_t</span> tag_size,</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>                              <span class="keywordtype">size_t</span> *tag_length);</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span> <span class="comment"></span></div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span> <span class="comment">/** Finish authenticating and decrypting a message in an AEAD operation.</span></div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span> <span class="comment"> *</span></div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span> <span class="comment"> * The operation must have been set up with psa_aead_decrypt_setup().</span></div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span> <span class="comment"> *</span></div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span> <span class="comment"> * This function finishes the authenticated decryption of the message</span></div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span> <span class="comment"> * components:</span></div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span> <span class="comment"> *</span></div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span> <span class="comment"> * -  The additional data consisting of the concatenation of the inputs</span></div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span> <span class="comment"> *    passed to preceding calls to psa_aead_update_ad().</span></div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span> <span class="comment"> * -  The ciphertext consisting of the concatenation of the inputs passed to</span></div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span> <span class="comment"> *    preceding calls to psa_aead_update().</span></div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span> <span class="comment"> * -  The tag passed to this function call.</span></div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span> <span class="comment"> *</span></div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span> <span class="comment"> * If the authentication tag is correct, this function outputs any remaining</span></div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span> <span class="comment"> * plaintext and reports success. If the authentication tag is not correct,</span></div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span> <span class="comment"> * this function returns #PSA_ERROR_INVALID_SIGNATURE.</span></div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span> <span class="comment"> *</span></div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span> <span class="comment"> * When this function returns successfuly, the operation becomes inactive.</span></div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span> <span class="comment"> * If this function returns an error status, the operation enters an error</span></div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span> <span class="comment"> * state and must be aborted by calling psa_aead_abort().</span></div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span> <span class="comment"> *</span></div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span> <span class="comment"> * \note Implementations shall make the best effort to ensure that the</span></div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span> <span class="comment"> * comparison between the actual tag and the expected tag is performed</span></div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span> <span class="comment"> * in constant time.</span></div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span> <span class="comment"> *</span></div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span> <span class="comment"> * \param[in,out] operation     Active AEAD operation.</span></div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span> <span class="comment"> * \param[out] plaintext        Buffer where the last part of the plaintext</span></div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span> <span class="comment"> *                              is to be written. This is the remaining data</span></div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span> <span class="comment"> *                              from previous calls to psa_aead_update()</span></div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span> <span class="comment"> *                              that could not be processed until the end</span></div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span> <span class="comment"> *                              of the input.</span></div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span> <span class="comment"> * \param plaintext_size        Size of the \p plaintext buffer in bytes.</span></div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span> <span class="comment"> *                              This must be at least</span></div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span> <span class="comment"> *                              #PSA_AEAD_VERIFY_OUTPUT_SIZE(\c alg) where</span></div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span> <span class="comment"> *                              \c alg is the algorithm that is being</span></div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span> <span class="comment"> *                              calculated.</span></div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span> <span class="comment"> * \param[out] plaintext_length On success, the number of bytes of</span></div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span> <span class="comment"> *                              returned plaintext.</span></div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span> <span class="comment"> * \param[in] tag               Buffer containing the authentication tag.</span></div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span> <span class="comment"> * \param tag_length            Size of the \p tag buffer in bytes.</span></div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span> <span class="comment"> *</span></div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_SIGNATURE</span></div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span> <span class="comment"> *         The calculations were successful, but the authentication tag is</span></div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span> <span class="comment"> *         not correct.</span></div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span> <span class="comment"> *         The operation state is not valid (it must be an active decryption</span></div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span> <span class="comment"> *         operation with a nonce set).</span></div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span> <span class="comment"> * \retval #PSA_ERROR_BUFFER_TOO_SMALL</span></div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span> <span class="comment"> *         The size of the \p plaintext buffer is too small.</span></div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span> <span class="comment"> *         You can determine a sufficient buffer size for \p plaintext by</span></div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span> <span class="comment"> *         calling #PSA_AEAD_VERIFY_OUTPUT_SIZE(\c alg)</span></div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span> <span class="comment"> *         where \c alg is the algorithm that is being calculated.</span></div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span> <span class="comment"> *         The total length of input to psa_aead_update_ad() so far is</span></div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span> <span class="comment"> *         less than the additional data length that was previously</span></div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span> <span class="comment"> *         specified with psa_aead_set_lengths().</span></div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span> <span class="comment"> *         The total length of input to psa_aead_update() so far is</span></div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span> <span class="comment"> *         less than the plaintext length that was previously</span></div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span> <span class="comment"> *         specified with psa_aead_set_lengths().</span></div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span> <span class="comment"> */</span></div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__aead.html#gae0280e2e61a185b893c36d858453f0d0">psa_aead_verify</a>(<a class="code" href="structpsa__aead__operation__s.html">psa_aead_operation_t</a> *operation,</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>                              uint8_t *plaintext,</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>                              <span class="keywordtype">size_t</span> plaintext_size,</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>                              <span class="keywordtype">size_t</span> *plaintext_length,</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>                              <span class="keyword">const</span> uint8_t *tag,</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>                              <span class="keywordtype">size_t</span> tag_length);</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span> <span class="comment"></span></div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span> <span class="comment">/** Abort an AEAD operation.</span></div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span> <span class="comment"> *</span></div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span> <span class="comment"> * Aborting an operation frees all associated resources except for the</span></div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span> <span class="comment"> * \p operation structure itself. Once aborted, the operation object</span></div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span> <span class="comment"> * can be reused for another operation by calling</span></div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span> <span class="comment"> * psa_aead_encrypt_setup() or psa_aead_decrypt_setup() again.</span></div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span> <span class="comment"> *</span></div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span> <span class="comment"> * You may call this function any time after the operation object has</span></div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span> <span class="comment"> * been initialized as described in #psa_aead_operation_t.</span></div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span> <span class="comment"> *</span></div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span> <span class="comment"> * In particular, calling psa_aead_abort() after the operation has been</span></div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span> <span class="comment"> * terminated by a call to psa_aead_abort(), psa_aead_finish() or</span></div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span> <span class="comment"> * psa_aead_verify() is safe and has no effect.</span></div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span> <span class="comment"> *</span></div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span> <span class="comment"> * \param[in,out] operation     Initialized AEAD operation.</span></div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span> <span class="comment"> *</span></div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span> <span class="comment"> */</span></div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__aead.html#gae8a5f93d92318c8f592ee9fbb9d36ba0">psa_aead_abort</a>(<a class="code" href="structpsa__aead__operation__s.html">psa_aead_operation_t</a> *operation);</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span> <span class="comment"></span></div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span> <span class="comment">/**@}*/</span></div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span> <span class="comment"></span></div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span> <span class="comment">/** \defgroup asymmetric Asymmetric cryptography</span></div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span> <span class="comment"> * @{</span></div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span> <span class="comment"> */</span></div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span> <span class="comment"></span></div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span> <span class="comment">/**</span></div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span> <span class="comment"> * \brief Sign a hash or short message with a private key.</span></div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span> <span class="comment"> *</span></div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span> <span class="comment"> * Note that to perform a hash-and-sign signature algorithm, you must</span></div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span> <span class="comment"> * first calculate the hash by calling psa_hash_setup(), psa_hash_update()</span></div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span> <span class="comment"> * and psa_hash_finish(). Then pass the resulting hash as the \p hash</span></div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span> <span class="comment"> * parameter to this function. You can use #PSA_ALG_SIGN_GET_HASH(\p alg)</span></div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span> <span class="comment"> * to determine the hash algorithm to use.</span></div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span> <span class="comment"> *</span></div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span> <span class="comment"> * \param handle                Handle to the key to use for the operation.</span></div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span> <span class="comment"> *                              It must be an asymmetric key pair.</span></div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span> <span class="comment"> * \param alg                   A signature algorithm that is compatible with</span></div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span> <span class="comment"> *                              the type of \p handle.</span></div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span> <span class="comment"> * \param[in] hash              The hash or message to sign.</span></div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span> <span class="comment"> * \param hash_length           Size of the \p hash buffer in bytes.</span></div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span> <span class="comment"> * \param[out] signature        Buffer where the signature is to be written.</span></div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span> <span class="comment"> * \param signature_size        Size of the \p signature buffer in bytes.</span></div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span> <span class="comment"> * \param[out] signature_length On success, the number of bytes</span></div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span> <span class="comment"> *                              that make up the returned signature value.</span></div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span> <span class="comment"> *</span></div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span> <span class="comment"> * \retval #PSA_ERROR_BUFFER_TOO_SMALL</span></div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span> <span class="comment"> *         The size of the \p signature buffer is too small. You can</span></div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span> <span class="comment"> *         determine a sufficient buffer size by calling</span></div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span> <span class="comment"> *         #PSA_SIGN_OUTPUT_SIZE(\c key_type, \c key_bits, \p alg)</span></div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span> <span class="comment"> *         where \c key_type and \c key_bits are the type and bit-size</span></div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span> <span class="comment"> *         respectively of \p handle.</span></div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_ENTROPY</span></div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span> <span class="comment"> */</span></div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__asymmetric.html#ga785e746a31a7b2a35ae5175c5ace3c5c">psa_sign_hash</a>(psa_key_handle_t handle,</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>                            <a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> alg,</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>                            <span class="keyword">const</span> uint8_t *hash,</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>                            <span class="keywordtype">size_t</span> hash_length,</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>                            uint8_t *signature,</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>                            <span class="keywordtype">size_t</span> signature_size,</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>                            <span class="keywordtype">size_t</span> *signature_length);</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span> <span class="comment"></span></div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span> <span class="comment">/**</span></div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span> <span class="comment"> * \brief Verify the signature a hash or short message using a public key.</span></div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span> <span class="comment"> *</span></div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span> <span class="comment"> * Note that to perform a hash-and-sign signature algorithm, you must</span></div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span> <span class="comment"> * first calculate the hash by calling psa_hash_setup(), psa_hash_update()</span></div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span> <span class="comment"> * and psa_hash_finish(). Then pass the resulting hash as the \p hash</span></div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span> <span class="comment"> * parameter to this function. You can use #PSA_ALG_SIGN_GET_HASH(\p alg)</span></div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span> <span class="comment"> * to determine the hash algorithm to use.</span></div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span> <span class="comment"> *</span></div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span> <span class="comment"> * \param handle            Handle to the key to use for the operation.</span></div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span> <span class="comment"> *                          It must be a public key or an asymmetric key pair.</span></div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span> <span class="comment"> * \param alg               A signature algorithm that is compatible with</span></div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span> <span class="comment"> *                          the type of \p handle.</span></div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span> <span class="comment"> * \param[in] hash          The hash or message whose signature is to be</span></div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span> <span class="comment"> *                          verified.</span></div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span> <span class="comment"> * \param hash_length       Size of the \p hash buffer in bytes.</span></div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span> <span class="comment"> * \param[in] signature     Buffer containing the signature to verify.</span></div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span> <span class="comment"> * \param signature_length  Size of the \p signature buffer in bytes.</span></div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span> <span class="comment"> *</span></div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span> <span class="comment"> *         The signature is valid.</span></div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_SIGNATURE</span></div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span> <span class="comment"> *         The calculation was perfomed successfully, but the passed</span></div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span> <span class="comment"> *         signature is not a valid signature.</span></div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span> <span class="comment"> */</span></div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__asymmetric.html#gae2ffbf01e5266391aff22b101a49f5f5">psa_verify_hash</a>(psa_key_handle_t handle,</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>                              <a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> alg,</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>                              <span class="keyword">const</span> uint8_t *hash,</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>                              <span class="keywordtype">size_t</span> hash_length,</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>                              <span class="keyword">const</span> uint8_t *signature,</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>                              <span class="keywordtype">size_t</span> signature_length);</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span> <span class="comment"></span></div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span> <span class="comment">/**</span></div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span> <span class="comment"> * \brief Encrypt a short message with a public key.</span></div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span> <span class="comment"> *</span></div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span> <span class="comment"> * \param handle                Handle to the key to use for the operation.</span></div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span> <span class="comment"> *                              It must be a public key or an asymmetric</span></div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span> <span class="comment"> *                              key pair.</span></div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span> <span class="comment"> * \param alg                   An asymmetric encryption algorithm that is</span></div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span> <span class="comment"> *                              compatible with the type of \p handle.</span></div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span> <span class="comment"> * \param[in] input             The message to encrypt.</span></div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span> <span class="comment"> * \param input_length          Size of the \p input buffer in bytes.</span></div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span> <span class="comment"> * \param[in] salt              A salt or label, if supported by the</span></div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span> <span class="comment"> *                              encryption algorithm.</span></div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span> <span class="comment"> *                              If the algorithm does not support a</span></div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span> <span class="comment"> *                              salt, pass \c NULL.</span></div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span> <span class="comment"> *                              If the algorithm supports an optional</span></div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span> <span class="comment"> *                              salt and you do not want to pass a salt,</span></div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span> <span class="comment"> *                              pass \c NULL.</span></div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span> <span class="comment"> *</span></div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span> <span class="comment"> *                              - For #PSA_ALG_RSA_PKCS1V15_CRYPT, no salt is</span></div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span> <span class="comment"> *                                supported.</span></div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span> <span class="comment"> * \param salt_length           Size of the \p salt buffer in bytes.</span></div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span> <span class="comment"> *                              If \p salt is \c NULL, pass 0.</span></div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span> <span class="comment"> * \param[out] output           Buffer where the encrypted message is to</span></div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span> <span class="comment"> *                              be written.</span></div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span> <span class="comment"> * \param output_size           Size of the \p output buffer in bytes.</span></div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span> <span class="comment"> * \param[out] output_length    On success, the number of bytes</span></div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span> <span class="comment"> *                              that make up the returned output.</span></div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span> <span class="comment"> *</span></div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span> <span class="comment"> * \retval #PSA_ERROR_BUFFER_TOO_SMALL</span></div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span> <span class="comment"> *         The size of the \p output buffer is too small. You can</span></div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span> <span class="comment"> *         determine a sufficient buffer size by calling</span></div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span> <span class="comment"> *         #PSA_ASYMMETRIC_ENCRYPT_OUTPUT_SIZE(\c key_type, \c key_bits, \p alg)</span></div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span> <span class="comment"> *         where \c key_type and \c key_bits are the type and bit-size</span></div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span> <span class="comment"> *         respectively of \p handle.</span></div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_ENTROPY</span></div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span> <span class="comment"> */</span></div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__asymmetric.html#gaa17f61e4ddafd1823d2c834b3706c290">psa_asymmetric_encrypt</a>(psa_key_handle_t handle,</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>                                     <a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> alg,</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>                                     <span class="keyword">const</span> uint8_t *input,</div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>                                     <span class="keywordtype">size_t</span> input_length,</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>                                     <span class="keyword">const</span> uint8_t *salt,</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>                                     <span class="keywordtype">size_t</span> salt_length,</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>                                     uint8_t *output,</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>                                     <span class="keywordtype">size_t</span> output_size,</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>                                     <span class="keywordtype">size_t</span> *output_length);</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span> <span class="comment"></span></div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span> <span class="comment">/**</span></div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span> <span class="comment"> * \brief Decrypt a short message with a private key.</span></div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span> <span class="comment"> *</span></div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span> <span class="comment"> * \param handle                Handle to the key to use for the operation.</span></div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span> <span class="comment"> *                              It must be an asymmetric key pair.</span></div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span> <span class="comment"> * \param alg                   An asymmetric encryption algorithm that is</span></div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span> <span class="comment"> *                              compatible with the type of \p handle.</span></div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span> <span class="comment"> * \param[in] input             The message to decrypt.</span></div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span> <span class="comment"> * \param input_length          Size of the \p input buffer in bytes.</span></div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span> <span class="comment"> * \param[in] salt              A salt or label, if supported by the</span></div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span> <span class="comment"> *                              encryption algorithm.</span></div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span> <span class="comment"> *                              If the algorithm does not support a</span></div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span> <span class="comment"> *                              salt, pass \c NULL.</span></div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span> <span class="comment"> *                              If the algorithm supports an optional</span></div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span> <span class="comment"> *                              salt and you do not want to pass a salt,</span></div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span> <span class="comment"> *                              pass \c NULL.</span></div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span> <span class="comment"> *</span></div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span> <span class="comment"> *                              - For #PSA_ALG_RSA_PKCS1V15_CRYPT, no salt is</span></div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span> <span class="comment"> *                                supported.</span></div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span> <span class="comment"> * \param salt_length           Size of the \p salt buffer in bytes.</span></div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span> <span class="comment"> *                              If \p salt is \c NULL, pass 0.</span></div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span> <span class="comment"> * \param[out] output           Buffer where the decrypted message is to</span></div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span> <span class="comment"> *                              be written.</span></div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span> <span class="comment"> * \param output_size           Size of the \c output buffer in bytes.</span></div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span> <span class="comment"> * \param[out] output_length    On success, the number of bytes</span></div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span> <span class="comment"> *                              that make up the returned output.</span></div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span> <span class="comment"> *</span></div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span> <span class="comment"> * \retval #PSA_ERROR_BUFFER_TOO_SMALL</span></div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span> <span class="comment"> *         The size of the \p output buffer is too small. You can</span></div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span> <span class="comment"> *         determine a sufficient buffer size by calling</span></div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span> <span class="comment"> *         #PSA_ASYMMETRIC_DECRYPT_OUTPUT_SIZE(\c key_type, \c key_bits, \p alg)</span></div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span> <span class="comment"> *         where \c key_type and \c key_bits are the type and bit-size</span></div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span> <span class="comment"> *         respectively of \p handle.</span></div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_ENTROPY</span></div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_PADDING</span></div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span> <span class="comment"> */</span></div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__asymmetric.html#ga4f968756f6b22aab362b598b202d83d7">psa_asymmetric_decrypt</a>(psa_key_handle_t handle,</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>                                     <a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> alg,</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>                                     <span class="keyword">const</span> uint8_t *input,</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>                                     <span class="keywordtype">size_t</span> input_length,</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>                                     <span class="keyword">const</span> uint8_t *salt,</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>                                     <span class="keywordtype">size_t</span> salt_length,</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>                                     uint8_t *output,</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>                                     <span class="keywordtype">size_t</span> output_size,</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>                                     <span class="keywordtype">size_t</span> *output_length);</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span> <span class="comment"></span></div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span> <span class="comment">/**@}*/</span></div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span> <span class="comment"></span></div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span> <span class="comment">/** \defgroup key_derivation Key derivation and pseudorandom generation</span></div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span> <span class="comment"> * @{</span></div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span> <span class="comment"> */</span></div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span> <span class="comment"></span></div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span> <span class="comment">/** The type of the state data structure for key derivation operations.</span></div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span> <span class="comment"> *</span></div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span> <span class="comment"> * Before calling any function on a key derivation operation object, the</span></div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span> <span class="comment"> * application must initialize it by any of the following means:</span></div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span> <span class="comment"> * - Set the structure to all-bits-zero, for example:</span></div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span> <span class="comment"> *   \code</span></div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span> <span class="comment"> *   psa_key_derivation_operation_t operation;</span></div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span> <span class="comment"> *   memset(&amp;operation, 0, sizeof(operation));</span></div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span> <span class="comment"> *   \endcode</span></div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span> <span class="comment"> * - Initialize the structure to logical zero values, for example:</span></div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span> <span class="comment"> *   \code</span></div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span> <span class="comment"> *   psa_key_derivation_operation_t operation = {0};</span></div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span> <span class="comment"> *   \endcode</span></div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span> <span class="comment"> * - Initialize the structure to the initializer #PSA_KEY_DERIVATION_OPERATION_INIT,</span></div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span> <span class="comment"> *   for example:</span></div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span> <span class="comment"> *   \code</span></div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span> <span class="comment"> *   psa_key_derivation_operation_t operation = PSA_KEY_DERIVATION_OPERATION_INIT;</span></div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span> <span class="comment"> *   \endcode</span></div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span> <span class="comment"> * - Assign the result of the function psa_key_derivation_operation_init()</span></div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span> <span class="comment"> *   to the structure, for example:</span></div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span> <span class="comment"> *   \code</span></div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span> <span class="comment"> *   psa_key_derivation_operation_t operation;</span></div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span> <span class="comment"> *   operation = psa_key_derivation_operation_init();</span></div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span> <span class="comment"> *   \endcode</span></div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span> <span class="comment"> *</span></div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span> <span class="comment"> * This is an implementation-defined \c struct. Applications should not</span></div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span> <span class="comment"> * make any assumptions about the content of this structure except</span></div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span> <span class="comment"> * as directed by the documentation of a specific implementation.</span></div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span> <span class="comment"> */</span></div><div class="line"><a name="l03096"></a><span class="lineno"><a class="line" href="group__key__derivation.html#ga5f099b63799a0959c3d46718c86c2609"> 3096</a></span> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structpsa__key__derivation__s.html">psa_key_derivation_s</a> <a class="code" href="structpsa__key__derivation__s.html">psa_key_derivation_operation_t</a>;</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span> <span class="comment"></span></div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span> <span class="comment">/** \def PSA_KEY_DERIVATION_OPERATION_INIT</span></div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span> <span class="comment"> *</span></div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span> <span class="comment"> * This macro returns a suitable initializer for a key derivation operation</span></div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span> <span class="comment"> * object of type #psa_key_derivation_operation_t.</span></div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span> <span class="comment"> */</span></div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span> <span class="preprocessor">#ifdef __DOXYGEN_ONLY__</span></div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span> <span class="comment">/* This is an example definition for documentation purposes.</span></div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span> <span class="comment"> * Implementations should define a suitable value in `crypto_struct.h`.</span></div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span> <span class="comment"> */</span></div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span> <span class="preprocessor">#define PSA_KEY_DERIVATION_OPERATION_INIT {0}</span></div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span> <span class="preprocessor">#endif</span></div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span> <span class="comment"></span></div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span> <span class="comment">/** Return an initial value for a key derivation operation object.</span></div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span> <span class="comment"> */</span></div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span> <span class="keyword">static</span> <a class="code" href="structpsa__key__derivation__s.html">psa_key_derivation_operation_t</a> <a class="code" href="group__key__derivation.html#ga8e06e993918a46032e92031f2a38bc52">psa_key_derivation_operation_init</a>(<span class="keywordtype">void</span>);</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span> <span class="comment"></span></div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span> <span class="comment">/** Set up a key derivation operation.</span></div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span> <span class="comment"> *</span></div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span> <span class="comment"> * A key derivation algorithm takes some inputs and uses them to generate</span></div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span> <span class="comment"> * a byte stream in a deterministic way.</span></div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span> <span class="comment"> * This byte stream can be used to produce keys and other</span></div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span> <span class="comment"> * cryptographic material.</span></div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span> <span class="comment"> *</span></div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span> <span class="comment"> * To derive a key:</span></div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span> <span class="comment"> * -# Start with an initialized object of type #psa_key_derivation_operation_t.</span></div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span> <span class="comment"> * -# Call psa_key_derivation_setup() to select the algorithm.</span></div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span> <span class="comment"> * -# Provide the inputs for the key derivation by calling</span></div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span> <span class="comment"> *    psa_key_derivation_input_bytes() or psa_key_derivation_input_key()</span></div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span> <span class="comment"> *    as appropriate. Which inputs are needed, in what order, and whether</span></div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span> <span class="comment"> *    they may be keys and if so of what type depends on the algorithm.</span></div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span> <span class="comment"> * -# Optionally set the operation's maximum capacity with</span></div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span> <span class="comment"> *    psa_key_derivation_set_capacity(). You may do this before, in the middle</span></div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span> <span class="comment"> *    of or after providing inputs. For some algorithms, this step is mandatory</span></div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span> <span class="comment"> *    because the output depends on the maximum capacity.</span></div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span> <span class="comment"> * -# To derive a key, call psa_key_derivation_output_key().</span></div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span> <span class="comment"> *    To derive a byte string for a different purpose, call</span></div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span> <span class="comment"> *    psa_key_derivation_output_bytes().</span></div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span> <span class="comment"> *    Successive calls to these functions use successive output bytes</span></div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span> <span class="comment"> *    calculated by the key derivation algorithm.</span></div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span> <span class="comment"> * -# Clean up the key derivation operation object with</span></div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span> <span class="comment"> *    psa_key_derivation_abort().</span></div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span> <span class="comment"> *</span></div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span> <span class="comment"> * If this function returns an error, the key derivation operation object is</span></div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span> <span class="comment"> * not changed.</span></div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span> <span class="comment"> *</span></div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span> <span class="comment"> * If an error occurs at any step after a call to psa_key_derivation_setup(),</span></div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span> <span class="comment"> * the operation will need to be reset by a call to psa_key_derivation_abort().</span></div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span> <span class="comment"> *</span></div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span> <span class="comment"> * Implementations must reject an attempt to derive a key of size 0.</span></div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span> <span class="comment"> *</span></div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span> <span class="comment"> * \param[in,out] operation       The key derivation operation object</span></div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span> <span class="comment"> *                                to set up. It must</span></div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span> <span class="comment"> *                                have been initialized but not set up yet.</span></div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span> <span class="comment"> * \param alg                     The key derivation algorithm to compute</span></div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span> <span class="comment"> *                                (\c PSA_ALG_XXX value such that</span></div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span> <span class="comment"> *                                #PSA_ALG_IS_KEY_DERIVATION(\p alg) is true).</span></div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span> <span class="comment"> *</span></div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span> <span class="comment"> *         \c alg is not a key derivation algorithm.</span></div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span> <span class="comment"> *         \c alg is not supported or is not a key derivation algorithm.</span></div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span> <span class="comment"> *         The operation state is not valid (it must be inactive).</span></div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span> <span class="comment"> */</span></div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__key__derivation.html#gac0b6a76e45cceb1862752bf041701859">psa_key_derivation_setup</a>(</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>     <a class="code" href="structpsa__key__derivation__s.html">psa_key_derivation_operation_t</a> *operation,</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>     <a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> alg);</div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span> <span class="comment"></span></div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span> <span class="comment">/** Retrieve the current capacity of a key derivation operation.</span></div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span> <span class="comment"> *</span></div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span> <span class="comment"> * The capacity of a key derivation is the maximum number of bytes that it can</span></div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span> <span class="comment"> * return. When you get *N* bytes of output from a key derivation operation,</span></div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span> <span class="comment"> * this reduces its capacity by *N*.</span></div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span> <span class="comment"> *</span></div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span> <span class="comment"> * \param[in] operation     The operation to query.</span></div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span> <span class="comment"> * \param[out] capacity     On success, the capacity of the operation.</span></div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span> <span class="comment"> *</span></div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span> <span class="comment"> *         The operation state is not valid (it must be active).</span></div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span> <span class="comment"> */</span></div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__key__derivation.html#ga9b0b6769491b25e0592fce0f1c96f842">psa_key_derivation_get_capacity</a>(</div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>     <span class="keyword">const</span> <a class="code" href="structpsa__key__derivation__s.html">psa_key_derivation_operation_t</a> *operation,</div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>     <span class="keywordtype">size_t</span> *capacity);</div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span> <span class="comment"></span></div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span> <span class="comment">/** Set the maximum capacity of a key derivation operation.</span></div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span> <span class="comment"> *</span></div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span> <span class="comment"> * The capacity of a key derivation operation is the maximum number of bytes</span></div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span> <span class="comment"> * that the key derivation operation can return from this point onwards.</span></div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span> <span class="comment"> *</span></div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span> <span class="comment"> * \param[in,out] operation The key derivation operation object to modify.</span></div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span> <span class="comment"> * \param capacity          The new capacity of the operation.</span></div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span> <span class="comment"> *                          It must be less or equal to the operation's</span></div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span> <span class="comment"> *                          current capacity.</span></div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span> <span class="comment"> *</span></div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span> <span class="comment"> *         \p capacity is larger than the operation's current capacity.</span></div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span> <span class="comment"> *         In this case, the operation object remains valid and its capacity</span></div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span> <span class="comment"> *         remains unchanged.</span></div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span> <span class="comment"> *         The operation state is not valid (it must be active).</span></div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span> <span class="comment"> */</span></div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__key__derivation.html#ga8c26178dc8e4581cb9fbce5650db3279">psa_key_derivation_set_capacity</a>(</div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>     <a class="code" href="structpsa__key__derivation__s.html">psa_key_derivation_operation_t</a> *operation,</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>     <span class="keywordtype">size_t</span> capacity);</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span> <span class="comment"></span></div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span> <span class="comment">/** Use the maximum possible capacity for a key derivation operation.</span></div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span> <span class="comment"> *</span></div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span> <span class="comment"> * Use this value as the capacity argument when setting up a key derivation</span></div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span> <span class="comment"> * to indicate that the operation should have the maximum possible capacity.</span></div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span> <span class="comment"> * The value of the maximum possible capacity depends on the key derivation</span></div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span> <span class="comment"> * algorithm.</span></div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span> <span class="comment"> */</span></div><div class="line"><a name="l03237"></a><span class="lineno"><a class="line" href="group__key__derivation.html#gaf80e7d71949ec72039c163b33cc2154d"> 3237</a></span> <span class="preprocessor">#define PSA_KEY_DERIVATION_UNLIMITED_CAPACITY ((size_t)(-1))</span></div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span> <span class="comment"></span></div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span> <span class="comment">/** Provide an input for key derivation or key agreement.</span></div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span> <span class="comment"> *</span></div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span> <span class="comment"> * Which inputs are required and in what order depends on the algorithm.</span></div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span> <span class="comment"> * Refer to the documentation of each key derivation or key agreement</span></div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span> <span class="comment"> * algorithm for information.</span></div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span> <span class="comment"> *</span></div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span> <span class="comment"> * This function passes direct inputs, which is usually correct for</span></div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span> <span class="comment"> * non-secret inputs. To pass a secret input, which should be in a key</span></div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span> <span class="comment"> * object, call psa_key_derivation_input_key() instead of this function.</span></div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span> <span class="comment"> * Refer to the documentation of individual step types</span></div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span> <span class="comment"> * (`PSA_KEY_DERIVATION_INPUT_xxx` values of type ::psa_key_derivation_step_t)</span></div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span> <span class="comment"> * for more information.</span></div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span> <span class="comment"> *</span></div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span> <span class="comment"> * If this function returns an error status, the operation enters an error</span></div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span> <span class="comment"> * state and must be aborted by calling psa_key_derivation_abort().</span></div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span> <span class="comment"> *</span></div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span> <span class="comment"> * \param[in,out] operation       The key derivation operation object to use.</span></div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span> <span class="comment"> *                                It must have been set up with</span></div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span> <span class="comment"> *                                psa_key_derivation_setup() and must not</span></div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span> <span class="comment"> *                                have produced any output yet.</span></div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span> <span class="comment"> * \param step                    Which step the input data is for.</span></div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span> <span class="comment"> * \param[in] data                Input data to use.</span></div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span> <span class="comment"> * \param data_length             Size of the \p data buffer in bytes.</span></div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span> <span class="comment"> *</span></div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span> <span class="comment"> *         \c step is not compatible with the operation's algorithm.</span></div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span> <span class="comment"> *         \c step does not allow direct inputs.</span></div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span> <span class="comment"> *         The operation state is not valid for this input \p step.</span></div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span> <span class="comment"> */</span></div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__key__derivation.html#ga8fd934dfb0ca45cbf89542ef2a5494c2">psa_key_derivation_input_bytes</a>(</div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>     <a class="code" href="structpsa__key__derivation__s.html">psa_key_derivation_operation_t</a> *operation,</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>     <a class="code" href="group__derivation.html#gaac4eeacd36596c548b3a48fc06c5048b">psa_key_derivation_step_t</a> step,</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>     <span class="keyword">const</span> uint8_t *data,</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>     <span class="keywordtype">size_t</span> data_length);</div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span> <span class="comment"></span></div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span> <span class="comment">/** Provide an input for key derivation in the form of a key.</span></div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span> <span class="comment"> *</span></div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span> <span class="comment"> * Which inputs are required and in what order depends on the algorithm.</span></div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span> <span class="comment"> * Refer to the documentation of each key derivation or key agreement</span></div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span> <span class="comment"> * algorithm for information.</span></div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span> <span class="comment"> *</span></div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span> <span class="comment"> * This function obtains input from a key object, which is usually correct for</span></div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span> <span class="comment"> * secret inputs or for non-secret personalization strings kept in the key</span></div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span> <span class="comment"> * store. To pass a non-secret parameter which is not in the key store,</span></div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span> <span class="comment"> * call psa_key_derivation_input_bytes() instead of this function.</span></div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span> <span class="comment"> * Refer to the documentation of individual step types</span></div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span> <span class="comment"> * (`PSA_KEY_DERIVATION_INPUT_xxx` values of type ::psa_key_derivation_step_t)</span></div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span> <span class="comment"> * for more information.</span></div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span> <span class="comment"> *</span></div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span> <span class="comment"> * If this function returns an error status, the operation enters an error</span></div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span> <span class="comment"> * state and must be aborted by calling psa_key_derivation_abort().</span></div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span> <span class="comment"> *</span></div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span> <span class="comment"> * \param[in,out] operation       The key derivation operation object to use.</span></div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span> <span class="comment"> *                                It must have been set up with</span></div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span> <span class="comment"> *                                psa_key_derivation_setup() and must not</span></div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span> <span class="comment"> *                                have produced any output yet.</span></div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span> <span class="comment"> * \param step                    Which step the input data is for.</span></div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span> <span class="comment"> * \param handle                  Handle to the key. It must have an</span></div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span> <span class="comment"> *                                appropriate type for \p step and must</span></div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span> <span class="comment"> *                                allow the usage #PSA_KEY_USAGE_DERIVE.</span></div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span> <span class="comment"> *</span></div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span> <span class="comment"> *         \c step is not compatible with the operation's algorithm.</span></div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span> <span class="comment"> *         \c step does not allow key inputs of the given type</span></div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span> <span class="comment"> *         or does not allow key inputs at all.</span></div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span> <span class="comment"> *         The operation state is not valid for this input \p step.</span></div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span> <span class="comment"> */</span></div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__key__derivation.html#gab2d7ce8705dd8e4a093f4b8a21a0c15a">psa_key_derivation_input_key</a>(</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>     <a class="code" href="structpsa__key__derivation__s.html">psa_key_derivation_operation_t</a> *operation,</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>     <a class="code" href="group__derivation.html#gaac4eeacd36596c548b3a48fc06c5048b">psa_key_derivation_step_t</a> step,</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>     psa_key_handle_t handle);</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span> <span class="comment"></span></div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span> <span class="comment">/** Perform a key agreement and use the shared secret as input to a key</span></div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span> <span class="comment"> * derivation.</span></div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span> <span class="comment"> *</span></div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span> <span class="comment"> * A key agreement algorithm takes two inputs: a private key \p private_key</span></div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span> <span class="comment"> * a public key \p peer_key.</span></div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span> <span class="comment"> * The result of this function is passed as input to a key derivation.</span></div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span> <span class="comment"> * The output of this key derivation can be extracted by reading from the</span></div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span> <span class="comment"> * resulting operation to produce keys and other cryptographic material.</span></div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span> <span class="comment"> *</span></div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span> <span class="comment"> * If this function returns an error status, the operation enters an error</span></div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span> <span class="comment"> * state and must be aborted by calling psa_key_derivation_abort().</span></div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span> <span class="comment"> *</span></div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span> <span class="comment"> * \param[in,out] operation       The key derivation operation object to use.</span></div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span> <span class="comment"> *                                It must have been set up with</span></div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span> <span class="comment"> *                                psa_key_derivation_setup() with a</span></div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span> <span class="comment"> *                                key agreement and derivation algorithm</span></div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span> <span class="comment"> *                                \c alg (\c PSA_ALG_XXX value such that</span></div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span> <span class="comment"> *                                #PSA_ALG_IS_KEY_AGREEMENT(\c alg) is true</span></div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span> <span class="comment"> *                                and #PSA_ALG_IS_RAW_KEY_AGREEMENT(\c alg)</span></div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span> <span class="comment"> *                                is false).</span></div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span> <span class="comment"> *                                The operation must be ready for an</span></div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span> <span class="comment"> *                                input of the type given by \p step.</span></div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span> <span class="comment"> * \param step                    Which step the input data is for.</span></div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span> <span class="comment"> * \param private_key             Handle to the private key to use.</span></div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span> <span class="comment"> * \param[in] peer_key      Public key of the peer. The peer key must be in the</span></div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span> <span class="comment"> *                          same format that psa_import_key() accepts for the</span></div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span> <span class="comment"> *                          public key type corresponding to the type of</span></div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span> <span class="comment"> *                          private_key. That is, this function performs the</span></div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span> <span class="comment"> *                          equivalent of</span></div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span> <span class="comment"> *                          #psa_import_key(...,</span></div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span> <span class="comment"> *                          `peer_key`, `peer_key_length`) where</span></div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span> <span class="comment"> *                          with key attributes indicating the public key</span></div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span> <span class="comment"> *                          type corresponding to the type of `private_key`.</span></div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span> <span class="comment"> *                          For example, for EC keys, this means that peer_key</span></div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span> <span class="comment"> *                          is interpreted as a point on the curve that the</span></div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span> <span class="comment"> *                          private key is on. The standard formats for public</span></div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span> <span class="comment"> *                          keys are documented in the documentation of</span></div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span> <span class="comment"> *                          psa_export_public_key().</span></div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span> <span class="comment"> * \param peer_key_length         Size of \p peer_key in bytes.</span></div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span> <span class="comment"> *</span></div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span> <span class="comment"> *         The operation state is not valid for this key agreement \p step.</span></div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span> <span class="comment"> *         \c private_key is not compatible with \c alg,</span></div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span> <span class="comment"> *         or \p peer_key is not valid for \c alg or not compatible with</span></div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span> <span class="comment"> *         \c private_key.</span></div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span> <span class="comment"> *         \c alg is not supported or is not a key derivation algorithm.</span></div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span> <span class="comment"> *         \c step does not allow an input resulting from a key agreement.</span></div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span> <span class="comment"> */</span></div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__key__derivation.html#ga2cd5a8ac906747d3204ec442db78745f">psa_key_derivation_key_agreement</a>(</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>     <a class="code" href="structpsa__key__derivation__s.html">psa_key_derivation_operation_t</a> *operation,</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>     <a class="code" href="group__derivation.html#gaac4eeacd36596c548b3a48fc06c5048b">psa_key_derivation_step_t</a> step,</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>     psa_key_handle_t private_key,</div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>     <span class="keyword">const</span> uint8_t *peer_key,</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>     <span class="keywordtype">size_t</span> peer_key_length);</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span> <span class="comment"></span></div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span> <span class="comment">/** Read some data from a key derivation operation.</span></div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span> <span class="comment"> *</span></div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span> <span class="comment"> * This function calculates output bytes from a key derivation algorithm and</span></div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span> <span class="comment"> * return those bytes.</span></div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span> <span class="comment"> * If you view the key derivation's output as a stream of bytes, this</span></div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span> <span class="comment"> * function destructively reads the requested number of bytes from the</span></div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span> <span class="comment"> * stream.</span></div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span> <span class="comment"> * The operation's capacity decreases by the number of bytes read.</span></div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span> <span class="comment"> *</span></div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span> <span class="comment"> * If this function returns an error status other than</span></div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span> <span class="comment"> * #PSA_ERROR_INSUFFICIENT_DATA, the operation enters an error</span></div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span> <span class="comment"> * state and must be aborted by calling psa_key_derivation_abort().</span></div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span> <span class="comment"> *</span></div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span> <span class="comment"> * \param[in,out] operation The key derivation operation object to read from.</span></div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span> <span class="comment"> * \param[out] output       Buffer where the output will be written.</span></div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span> <span class="comment"> * \param output_length     Number of bytes to output.</span></div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span> <span class="comment"> *</span></div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_DATA</span></div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span> <span class="comment"> *                          The operation's capacity was less than</span></div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span> <span class="comment"> *                          \p output_length bytes. Note that in this case,</span></div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span> <span class="comment"> *                          no output is written to the output buffer.</span></div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span> <span class="comment"> *                          The operation's capacity is set to 0, thus</span></div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span> <span class="comment"> *                          subsequent calls to this function will not</span></div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span> <span class="comment"> *                          succeed, even with a smaller output buffer.</span></div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span> <span class="comment"> *         The operation state is not valid (it must be active and completed</span></div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span> <span class="comment"> *         all required input steps).</span></div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span> <span class="comment"> */</span></div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__key__derivation.html#ga06b7eb34a2fa88965f68e3d023fa12b9">psa_key_derivation_output_bytes</a>(</div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>     <a class="code" href="structpsa__key__derivation__s.html">psa_key_derivation_operation_t</a> *operation,</div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>     uint8_t *output,</div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>     <span class="keywordtype">size_t</span> output_length);</div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span> <span class="comment"></span></div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span> <span class="comment">/** Derive a key from an ongoing key derivation operation.</span></div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span> <span class="comment"> *</span></div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span> <span class="comment"> * This function calculates output bytes from a key derivation algorithm</span></div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span> <span class="comment"> * and uses those bytes to generate a key deterministically.</span></div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span> <span class="comment"> * The key's location, usage policy, type and size are taken from</span></div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span> <span class="comment"> * \p attributes.</span></div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span> <span class="comment"> *</span></div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span> <span class="comment"> * If you view the key derivation's output as a stream of bytes, this</span></div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span> <span class="comment"> * function destructively reads as many bytes as required from the</span></div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span> <span class="comment"> * stream.</span></div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span> <span class="comment"> * The operation's capacity decreases by the number of bytes read.</span></div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span> <span class="comment"> *</span></div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span> <span class="comment"> * If this function returns an error status other than</span></div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span> <span class="comment"> * #PSA_ERROR_INSUFFICIENT_DATA, the operation enters an error</span></div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span> <span class="comment"> * state and must be aborted by calling psa_key_derivation_abort().</span></div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span> <span class="comment"> *</span></div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span> <span class="comment"> * How much output is produced and consumed from the operation, and how</span></div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span> <span class="comment"> * the key is derived, depends on the key type:</span></div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span> <span class="comment"> *</span></div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span> <span class="comment"> * - For key types for which the key is an arbitrary sequence of bytes</span></div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span> <span class="comment"> *   of a given size, this function is functionally equivalent to</span></div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span> <span class="comment"> *   calling #psa_key_derivation_output_bytes</span></div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span> <span class="comment"> *   and passing the resulting output to #psa_import_key.</span></div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span> <span class="comment"> *   However, this function has a security benefit:</span></div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span> <span class="comment"> *   if the implementation provides an isolation boundary then</span></div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span> <span class="comment"> *   the key material is not exposed outside the isolation boundary.</span></div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span> <span class="comment"> *   As a consequence, for these key types, this function always consumes</span></div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span> <span class="comment"> *   exactly (\p bits / 8) bytes from the operation.</span></div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span> <span class="comment"> *   The following key types defined in this specification follow this scheme:</span></div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span> <span class="comment"> *</span></div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span> <span class="comment"> *     - #PSA_KEY_TYPE_AES;</span></div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span> <span class="comment"> *     - #PSA_KEY_TYPE_ARC4;</span></div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span> <span class="comment"> *     - #PSA_KEY_TYPE_CAMELLIA;</span></div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span> <span class="comment"> *     - #PSA_KEY_TYPE_DERIVE;</span></div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span> <span class="comment"> *     - #PSA_KEY_TYPE_HMAC.</span></div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span> <span class="comment"> *</span></div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span> <span class="comment"> * - For ECC keys on a Montgomery elliptic curve</span></div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span> <span class="comment"> *   (#PSA_KEY_TYPE_ECC_KEY_PAIR(\c curve) where \c curve designates a</span></div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span> <span class="comment"> *   Montgomery curve), this function always draws a byte string whose</span></div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span> <span class="comment"> *   length is determined by the curve, and sets the mandatory bits</span></div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span> <span class="comment"> *   accordingly. That is:</span></div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span> <span class="comment"> *</span></div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span> <span class="comment"> *     - #PSA_ECC_CURVE_CURVE25519: draw a 32-byte string</span></div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span> <span class="comment"> *       and process it as specified in RFC 7748 &amp;sect;5.</span></div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span> <span class="comment"> *     - #PSA_ECC_CURVE_CURVE448: draw a 56-byte string</span></div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span> <span class="comment"> *       and process it as specified in RFC 7748 &amp;sect;5.</span></div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span> <span class="comment"> *</span></div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span> <span class="comment"> * - For key types for which the key is represented by a single sequence of</span></div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span> <span class="comment"> *   \p bits bits with constraints as to which bit sequences are acceptable,</span></div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span> <span class="comment"> *   this function draws a byte string of length (\p bits / 8) bytes rounded</span></div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span> <span class="comment"> *   up to the nearest whole number of bytes. If the resulting byte string</span></div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span> <span class="comment"> *   is acceptable, it becomes the key, otherwise the drawn bytes are discarded.</span></div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span> <span class="comment"> *   This process is repeated until an acceptable byte string is drawn.</span></div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span> <span class="comment"> *   The byte string drawn from the operation is interpreted as specified</span></div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span> <span class="comment"> *   for the output produced by psa_export_key().</span></div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span> <span class="comment"> *   The following key types defined in this specification follow this scheme:</span></div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span> <span class="comment"> *</span></div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span> <span class="comment"> *     - #PSA_KEY_TYPE_DES.</span></div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span> <span class="comment"> *       Force-set the parity bits, but discard forbidden weak keys.</span></div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span> <span class="comment"> *       For 2-key and 3-key triple-DES, the three keys are generated</span></div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span> <span class="comment"> *       successively (for example, for 3-key triple-DES,</span></div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span> <span class="comment"> *       if the first 8 bytes specify a weak key and the next 8 bytes do not,</span></div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span> <span class="comment"> *       discard the first 8 bytes, use the next 8 bytes as the first key,</span></div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span> <span class="comment"> *       and continue reading output from the operation to derive the other</span></div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span> <span class="comment"> *       two keys).</span></div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span> <span class="comment"> *     - Finite-field Diffie-Hellman keys (#PSA_KEY_TYPE_DH_KEY_PAIR(\c group)</span></div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span> <span class="comment"> *       where \c group designates any Diffie-Hellman group) and</span></div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span> <span class="comment"> *       ECC keys on a Weierstrass elliptic curve</span></div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span> <span class="comment"> *       (#PSA_KEY_TYPE_ECC_KEY_PAIR(\c curve) where \c curve designates a</span></div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span> <span class="comment"> *       Weierstrass curve).</span></div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span> <span class="comment"> *       For these key types, interpret the byte string as integer</span></div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span> <span class="comment"> *       in big-endian order. Discard it if it is not in the range</span></div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span> <span class="comment"> *       [0, *N* - 2] where *N* is the boundary of the private key domain</span></div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span> <span class="comment"> *       (the prime *p* for Diffie-Hellman, the subprime *q* for DSA,</span></div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span> <span class="comment"> *       or the order of the curve's base point for ECC).</span></div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span> <span class="comment"> *       Add 1 to the resulting integer and use this as the private key *x*.</span></div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span> <span class="comment"> *       This method allows compliance to NIST standards, specifically</span></div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span> <span class="comment"> *       the methods titled "key-pair generation by testing candidates"</span></div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span> <span class="comment"> *       in NIST SP 800-56A &amp;sect;5.6.1.1.4 for Diffie-Hellman,</span></div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span> <span class="comment"> *       in FIPS 186-4 &amp;sect;B.1.2 for DSA, and</span></div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span> <span class="comment"> *       in NIST SP 800-56A &amp;sect;5.6.1.2.2 or</span></div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span> <span class="comment"> *       FIPS 186-4 &amp;sect;B.4.2 for elliptic curve keys.</span></div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span> <span class="comment"> *</span></div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span> <span class="comment"> * - For other key types, including #PSA_KEY_TYPE_RSA_KEY_PAIR,</span></div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span> <span class="comment"> *   the way in which the operation output is consumed is</span></div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span> <span class="comment"> *   implementation-defined.</span></div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span> <span class="comment"> *</span></div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span> <span class="comment"> * In all cases, the data that is read is discarded from the operation.</span></div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span> <span class="comment"> * The operation's capacity is decreased by the number of bytes read.</span></div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span> <span class="comment"> *</span></div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span> <span class="comment"> * For algorithms that take an input step #PSA_KEY_DERIVATION_INPUT_SECRET,</span></div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span> <span class="comment"> * the input to that step must be provided with psa_key_derivation_input_key().</span></div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span> <span class="comment"> * Future versions of this specification may include additional restrictions</span></div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span> <span class="comment"> * on the derived key based on the attributes and strength of the secret key.</span></div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span> <span class="comment"> *</span></div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span> <span class="comment"> * \param[in] attributes    The attributes for the new key.</span></div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span> <span class="comment"> * \param[in,out] operation The key derivation operation object to read from.</span></div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span> <span class="comment"> * \param[out] handle       On success, a handle to the newly created key.</span></div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span> <span class="comment"> *                          \c 0 on failure.</span></div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span> <span class="comment"> *</span></div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span> <span class="comment"> *         If the key is persistent, the key material and the key's metadata</span></div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span> <span class="comment"> *         have been saved to persistent storage.</span></div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span> <span class="comment"> * \retval #PSA_ERROR_ALREADY_EXISTS</span></div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span> <span class="comment"> *         This is an attempt to create a persistent key, and there is</span></div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span> <span class="comment"> *         already a persistent key with the given identifier.</span></div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_DATA</span></div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span> <span class="comment"> *         There was not enough data to create the desired key.</span></div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span> <span class="comment"> *         Note that in this case, no output is written to the output buffer.</span></div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span> <span class="comment"> *         The operation's capacity is set to 0, thus subsequent calls to</span></div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span> <span class="comment"> *         this function will not succeed, even with a smaller output buffer.</span></div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span> <span class="comment"> *         The key type or key size is not supported, either by the</span></div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span> <span class="comment"> *         implementation in general or in this particular location.</span></div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span> <span class="comment"> *         The provided key attributes are not valid for the operation.</span></div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span> <span class="comment"> *         The #PSA_KEY_DERIVATION_INPUT_SECRET input was not provided through</span></div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span> <span class="comment"> *         a key.</span></div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span> <span class="comment"> *         The operation state is not valid (it must be active and completed</span></div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span> <span class="comment"> *         all required input steps).</span></div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_STORAGE</span></div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span> <span class="comment"> */</span></div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__key__derivation.html#gada7a6e17222ea9e7a6be6864a00316e1">psa_key_derivation_output_key</a>(</div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>     <span class="keyword">const</span> <a class="code" href="structpsa__key__attributes__s.html">psa_key_attributes_t</a> *attributes,</div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>     <a class="code" href="structpsa__key__derivation__s.html">psa_key_derivation_operation_t</a> *operation,</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>     psa_key_handle_t *handle);</div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span> <span class="comment"></span></div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span> <span class="comment">/** Abort a key derivation operation.</span></div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span> <span class="comment"> *</span></div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span> <span class="comment"> * Aborting an operation frees all associated resources except for the \c</span></div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span> <span class="comment"> * operation structure itself. Once aborted, the operation object can be reused</span></div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span> <span class="comment"> * for another operation by calling psa_key_derivation_setup() again.</span></div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span> <span class="comment"> *</span></div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span> <span class="comment"> * This function may be called at any time after the operation</span></div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span> <span class="comment"> * object has been initialized as described in #psa_key_derivation_operation_t.</span></div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span> <span class="comment"> *</span></div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span> <span class="comment"> * In particular, it is valid to call psa_key_derivation_abort() twice, or to</span></div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span> <span class="comment"> * call psa_key_derivation_abort() on an operation that has not been set up.</span></div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span> <span class="comment"> *</span></div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span> <span class="comment"> * \param[in,out] operation    The operation to abort.</span></div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span> <span class="comment"> *</span></div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span> <span class="comment"> */</span></div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__key__derivation.html#ga90fdd2716124d0bd258826184824675f">psa_key_derivation_abort</a>(</div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>     <a class="code" href="structpsa__key__derivation__s.html">psa_key_derivation_operation_t</a> *operation);</div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span> <span class="comment"></span></div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span> <span class="comment">/** Perform a key agreement and return the raw shared secret.</span></div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span> <span class="comment"> *</span></div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span> <span class="comment"> * \warning The raw result of a key agreement algorithm such as finite-field</span></div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span> <span class="comment"> * Diffie-Hellman or elliptic curve Diffie-Hellman has biases and should</span></div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span> <span class="comment"> * not be used directly as key material. It should instead be passed as</span></div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span> <span class="comment"> * input to a key derivation algorithm. To chain a key agreement with</span></div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span> <span class="comment"> * a key derivation, use psa_key_derivation_key_agreement() and other</span></div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span> <span class="comment"> * functions from the key derivation interface.</span></div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span> <span class="comment"> *</span></div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span> <span class="comment"> * \param alg                     The key agreement algorithm to compute</span></div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span> <span class="comment"> *                                (\c PSA_ALG_XXX value such that</span></div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span> <span class="comment"> *                                #PSA_ALG_IS_RAW_KEY_AGREEMENT(\p alg)</span></div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span> <span class="comment"> *                                is true).</span></div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span> <span class="comment"> * \param private_key             Handle to the private key to use.</span></div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span> <span class="comment"> * \param[in] peer_key            Public key of the peer. It must be</span></div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span> <span class="comment"> *                                in the same format that psa_import_key()</span></div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span> <span class="comment"> *                                accepts. The standard formats for public</span></div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span> <span class="comment"> *                                keys are documented in the documentation</span></div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span> <span class="comment"> *                                of psa_export_public_key().</span></div><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span> <span class="comment"> * \param peer_key_length         Size of \p peer_key in bytes.</span></div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span> <span class="comment"> * \param[out] output             Buffer where the decrypted message is to</span></div><div class="line"><a name="l03639"></a><span class="lineno"> 3639</span> <span class="comment"> *                                be written.</span></div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span> <span class="comment"> * \param output_size             Size of the \c output buffer in bytes.</span></div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span> <span class="comment"> * \param[out] output_length      On success, the number of bytes</span></div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span> <span class="comment"> *                                that make up the returned output.</span></div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span> <span class="comment"> *</span></div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_HANDLE</span></div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span> <span class="comment"> * \retval #PSA_ERROR_NOT_PERMITTED</span></div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span> <span class="comment"> *         \p alg is not a key agreement algorithm</span></div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span> <span class="comment"> *         \p private_key is not compatible with \p alg,</span></div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span> <span class="comment"> *         or \p peer_key is not valid for \p alg or not compatible with</span></div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span> <span class="comment"> *         \p private_key.</span></div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span> <span class="comment"> * \retval #PSA_ERROR_BUFFER_TOO_SMALL</span></div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span> <span class="comment"> *         \p output_size is too small</span></div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span> <span class="comment"> *         \p alg is not a supported key agreement algorithm.</span></div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span> <span class="comment"> */</span></div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__key__derivation.html#ga165dda1ad80a10730cb538069d4cc7aa">psa_raw_key_agreement</a>(<a class="code" href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a> alg,</div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>                                    psa_key_handle_t private_key,</div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>                                    <span class="keyword">const</span> uint8_t *peer_key,</div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>                                    <span class="keywordtype">size_t</span> peer_key_length,</div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>                                    uint8_t *output,</div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>                                    <span class="keywordtype">size_t</span> output_size,</div><div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>                                    <span class="keywordtype">size_t</span> *output_length);</div><div class="line"><a name="l03675"></a><span class="lineno"> 3675</span> <span class="comment"></span></div><div class="line"><a name="l03676"></a><span class="lineno"> 3676</span> <span class="comment">/**@}*/</span></div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span> <span class="comment"></span></div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span> <span class="comment">/** \defgroup random Random generation</span></div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span> <span class="comment"> * @{</span></div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span> <span class="comment"> */</span></div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span> <span class="comment"></span></div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span> <span class="comment">/**</span></div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span> <span class="comment"> * \brief Generate random bytes.</span></div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span> <span class="comment"> *</span></div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span> <span class="comment"> * \warning This function **can** fail! Callers MUST check the return status</span></div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span> <span class="comment"> *          and MUST NOT use the content of the output buffer if the return</span></div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span> <span class="comment"> *          status is not #PSA_SUCCESS.</span></div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span> <span class="comment"> *</span></div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span> <span class="comment"> * \note    To generate a key, use psa_generate_key() instead.</span></div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span> <span class="comment"> *</span></div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span> <span class="comment"> * \param[out] output       Output buffer for the generated data.</span></div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span> <span class="comment"> * \param output_size       Number of bytes to generate and output.</span></div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span> <span class="comment"> *</span></div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_ENTROPY</span></div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span> <span class="comment"> */</span></div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__random.html#ga1985eae417dfbccedf50d5fff54ea8c5">psa_generate_random</a>(uint8_t *output,</div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>                                  <span class="keywordtype">size_t</span> output_size);</div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span> <span class="comment"></span></div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span> <span class="comment">/**</span></div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span> <span class="comment"> * \brief Generate a key or key pair.</span></div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span> <span class="comment"> *</span></div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span> <span class="comment"> * The key is generated randomly.</span></div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span> <span class="comment"> * Its location, usage policy, type and size are taken from \p attributes.</span></div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span> <span class="comment"> *</span></div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span> <span class="comment"> * Implementations must reject an attempt to generate a key of size 0.</span></div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span> <span class="comment"> *</span></div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span> <span class="comment"> * The following type-specific considerations apply:</span></div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span> <span class="comment"> * - For RSA keys (#PSA_KEY_TYPE_RSA_KEY_PAIR),</span></div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span> <span class="comment"> *   the public exponent is 65537.</span></div><div class="line"><a name="l03720"></a><span class="lineno"> 3720</span> <span class="comment"> *   The modulus is a product of two probabilistic primes</span></div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span> <span class="comment"> *   between 2^{n-1} and 2^n where n is the bit size specified in the</span></div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span> <span class="comment"> *   attributes.</span></div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span> <span class="comment"> *</span></div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span> <span class="comment"> * \param[in] attributes    The attributes for the new key.</span></div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span> <span class="comment"> * \param[out] handle       On success, a handle to the newly created key.</span></div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span> <span class="comment"> *                          \c 0 on failure.</span></div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span> <span class="comment"> *</span></div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span> <span class="comment"> * \retval #PSA_SUCCESS</span></div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span> <span class="comment"> *         Success.</span></div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span> <span class="comment"> *         If the key is persistent, the key material and the key's metadata</span></div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span> <span class="comment"> *         have been saved to persistent storage.</span></div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span> <span class="comment"> * \retval #PSA_ERROR_ALREADY_EXISTS</span></div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span> <span class="comment"> *         This is an attempt to create a persistent key, and there is</span></div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span> <span class="comment"> *         already a persistent key with the given identifier.</span></div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span> <span class="comment"> * \retval #PSA_ERROR_NOT_SUPPORTED</span></div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span> <span class="comment"> * \retval #PSA_ERROR_INVALID_ARGUMENT</span></div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_MEMORY</span></div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_ENTROPY</span></div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span> <span class="comment"> * \retval #PSA_ERROR_COMMUNICATION_FAILURE</span></div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span> <span class="comment"> * \retval #PSA_ERROR_HARDWARE_FAILURE</span></div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span> <span class="comment"> * \retval #PSA_ERROR_CORRUPTION_DETECTED</span></div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span> <span class="comment"> * \retval #PSA_ERROR_INSUFFICIENT_STORAGE</span></div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span> <span class="comment"> * \retval #PSA_ERROR_STORAGE_FAILURE</span></div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span> <span class="comment"> * \retval #PSA_ERROR_BAD_STATE</span></div><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span> <span class="comment"> *         The library has not been previously initialized by psa_crypto_init().</span></div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span> <span class="comment"> *         It is implementation-dependent whether a failure to initialize</span></div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span> <span class="comment"> *         results in this error code.</span></div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span> <span class="comment"> */</span></div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span> <a class="code" href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a> <a class="code" href="group__random.html#ga1f154687b24e5508d97681cdd17946a8">psa_generate_key</a>(<span class="keyword">const</span> <a class="code" href="structpsa__key__attributes__s.html">psa_key_attributes_t</a> *attributes,</div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>                               psa_key_handle_t *handle);</div><div class="line"><a name="l03751"></a><span class="lineno"> 3751</span> <span class="comment"></span></div><div class="line"><a name="l03752"></a><span class="lineno"> 3752</span> <span class="comment">/**@}*/</span></div><div class="line"><a name="l03753"></a><span class="lineno"> 3753</span> </div><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span> <span class="preprocessor">#ifdef __cplusplus</span></div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span> }</div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span> <span class="preprocessor">#endif</span></div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span> </div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span> <span class="comment">/* The file "crypto_sizes.h" contains definitions for size calculation</span></div><div class="line"><a name="l03759"></a><span class="lineno"> 3759</span> <span class="comment"> * macros whose definitions are implementation-specific. */</span></div><div class="line"><a name="l03760"></a><span class="lineno"> 3760</span> <span class="preprocessor">#include "psa/crypto_sizes.h"</span></div><div class="line"><a name="l03761"></a><span class="lineno"> 3761</span> </div><div class="line"><a name="l03762"></a><span class="lineno"> 3762</span> <span class="comment">/* The file "crypto_struct.h" contains definitions for</span></div><div class="line"><a name="l03763"></a><span class="lineno"> 3763</span> <span class="comment"> * implementation-specific structs that are declared above. */</span></div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span> <span class="preprocessor">#include "psa/crypto_struct.h"</span></div><div class="line"><a name="l03765"></a><span class="lineno"> 3765</span> </div><div class="line"><a name="l03766"></a><span class="lineno"> 3766</span> <span class="comment">/* The file "crypto_extra.h" contains vendor-specific definitions. This</span></div><div class="line"><a name="l03767"></a><span class="lineno"> 3767</span> <span class="comment"> * can include vendor-defined algorithms, extra functions, etc. */</span></div><div class="line"><a name="l03768"></a><span class="lineno"> 3768</span> <span class="preprocessor">#include "psa/crypto_extra.h"</span></div><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span> </div><div class="line"><a name="l03770"></a><span class="lineno"> 3770</span> <span class="preprocessor">#endif </span><span class="comment">/* PSA_CRYPTO_H */</span><span class="preprocessor"></span></div><div class="ttc" id="group__attributes_html_ga382b7f11fc6d706645cefea22c3bd458"><div class="ttname"><a href="group__attributes.html#ga382b7f11fc6d706645cefea22c3bd458">psa_reset_key_attributes</a></div><div class="ttdeci">void psa_reset_key_attributes(psa_key_attributes_t *attributes)</div><div class="ttdoc">Reset a key attribute structure to a freshly initialized state. </div></div>
<div class="ttc" id="group__cipher_html_gac3ca27ac6682917c48247d01fd96cd0f"><div class="ttname"><a href="group__cipher.html#gac3ca27ac6682917c48247d01fd96cd0f">psa_cipher_update</a></div><div class="ttdeci">psa_status_t psa_cipher_update(psa_cipher_operation_t *operation, const uint8_t *input, size_t input_length, uint8_t *output, size_t output_size, size_t *output_length)</div><div class="ttdoc">Encrypt or decrypt a message fragment in an active cipher operation. </div></div>
<div class="ttc" id="group__aead_html_ga2732c40ce8f3619d41359a329e9b46c4"><div class="ttname"><a href="group__aead.html#ga2732c40ce8f3619d41359a329e9b46c4">psa_aead_encrypt_setup</a></div><div class="ttdeci">psa_status_t psa_aead_encrypt_setup(psa_aead_operation_t *operation, mbedtls_svc_key_id_t key, psa_algorithm_t alg)</div><div class="ttdoc">Set the key for a multipart authenticated encryption operation. </div></div>
<div class="ttc" id="structpsa__key__attributes__s_html"><div class="ttname"><a href="structpsa__key__attributes__s.html">psa_key_attributes_s</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_a_r_g_e_t___m_b_e_d___p_s_a___s_r_v_2mbedtls_2crypto__struct_8h_source.html#l00352">TARGET_MBED_PSA_SRV/mbedtls/crypto_struct.h:352</a></div></div>
<div class="ttc" id="group__cipher_html_ga587374c0eb8137a572f8e2fc409bb2b4"><div class="ttname"><a href="group__cipher.html#ga587374c0eb8137a572f8e2fc409bb2b4">psa_cipher_encrypt_setup</a></div><div class="ttdeci">psa_status_t psa_cipher_encrypt_setup(psa_cipher_operation_t *operation, mbedtls_svc_key_id_t key, psa_algorithm_t alg)</div><div class="ttdoc">Set the key for a multipart symmetric encryption operation. </div></div>
<div class="ttc" id="group__random_html_ga1985eae417dfbccedf50d5fff54ea8c5"><div class="ttname"><a href="group__random.html#ga1985eae417dfbccedf50d5fff54ea8c5">psa_generate_random</a></div><div class="ttdeci">psa_status_t psa_generate_random(uint8_t *output, size_t output_size)</div><div class="ttdoc">Generate random bytes. </div></div>
<div class="ttc" id="group___m_a_c_html_gac22bc0125580c96724a09226cfbc97f2"><div class="ttname"><a href="group___m_a_c.html#gac22bc0125580c96724a09226cfbc97f2">psa_mac_sign_finish</a></div><div class="ttdeci">psa_status_t psa_mac_sign_finish(psa_mac_operation_t *operation, uint8_t *mac, size_t mac_size, size_t *mac_length)</div><div class="ttdoc">Finish the calculation of the MAC of a message. </div></div>
<div class="ttc" id="structpsa__aead__operation__s_html"><div class="ttname"><a href="structpsa__aead__operation__s.html">psa_aead_operation_s</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_a_r_g_e_t___m_b_e_d___p_s_a___s_r_v_2mbedtls_2crypto__struct_8h_source.html#l00189">TARGET_MBED_PSA_SRV/mbedtls/crypto_struct.h:189</a></div></div>
<div class="ttc" id="group__asymmetric_html_gaa17f61e4ddafd1823d2c834b3706c290"><div class="ttname"><a href="group__asymmetric.html#gaa17f61e4ddafd1823d2c834b3706c290">psa_asymmetric_encrypt</a></div><div class="ttdeci">psa_status_t psa_asymmetric_encrypt(mbedtls_svc_key_id_t key, psa_algorithm_t alg, const uint8_t *input, size_t input_length, const uint8_t *salt, size_t salt_length, uint8_t *output, size_t output_size, size_t *output_length)</div><div class="ttdoc">Encrypt a short message with a public key. </div></div>
<div class="ttc" id="structpsa__mac__operation__s_html"><div class="ttname"><a href="structpsa__mac__operation__s.html">psa_mac_operation_s</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_a_r_g_e_t___m_b_e_d___p_s_a___s_r_v_2mbedtls_2crypto__struct_8h_source.html#l00137">TARGET_MBED_PSA_SRV/mbedtls/crypto_struct.h:137</a></div></div>
<div class="ttc" id="group__key__derivation_html_ga8e06e993918a46032e92031f2a38bc52"><div class="ttname"><a href="group__key__derivation.html#ga8e06e993918a46032e92031f2a38bc52">psa_key_derivation_operation_init</a></div><div class="ttdeci">static psa_key_derivation_operation_t psa_key_derivation_operation_init(void)</div><div class="ttdoc">Return an initial value for a key derivation operation object. </div></div>
<div class="ttc" id="group__key__derivation_html_ga8c26178dc8e4581cb9fbce5650db3279"><div class="ttname"><a href="group__key__derivation.html#ga8c26178dc8e4581cb9fbce5650db3279">psa_key_derivation_set_capacity</a></div><div class="ttdeci">psa_status_t psa_key_derivation_set_capacity(psa_key_derivation_operation_t *operation, size_t capacity)</div><div class="ttdoc">Set the maximum capacity of a key derivation operation. </div></div>
<div class="ttc" id="group__cipher_html_gaa4ba3a167066eaef2ea49abc5dcd1d4b"><div class="ttname"><a href="group__cipher.html#gaa4ba3a167066eaef2ea49abc5dcd1d4b">psa_cipher_decrypt_setup</a></div><div class="ttdeci">psa_status_t psa_cipher_decrypt_setup(psa_cipher_operation_t *operation, mbedtls_svc_key_id_t key, psa_algorithm_t alg)</div><div class="ttdoc">Set the key for a multipart symmetric decryption operation. </div></div>
<div class="ttc" id="group__key__management_html_gaa09b720d299dfe6b9f41c36e448078eb"><div class="ttname"><a href="group__key__management.html#gaa09b720d299dfe6b9f41c36e448078eb">psa_close_key</a></div><div class="ttdeci">psa_status_t psa_close_key(psa_key_handle_t handle)</div><div class="ttdoc">Close a key handle. </div></div>
<div class="ttc" id="group__key__derivation_html_ga90fdd2716124d0bd258826184824675f"><div class="ttname"><a href="group__key__derivation.html#ga90fdd2716124d0bd258826184824675f">psa_key_derivation_abort</a></div><div class="ttdeci">psa_status_t psa_key_derivation_abort(psa_key_derivation_operation_t *operation)</div><div class="ttdoc">Abort a key derivation operation. </div></div>
<div class="ttc" id="group___m_a_c_html_gac92b2930d6728e1be4d011c05d485822"><div class="ttname"><a href="group___m_a_c.html#gac92b2930d6728e1be4d011c05d485822">psa_mac_verify_finish</a></div><div class="ttdeci">psa_status_t psa_mac_verify_finish(psa_mac_operation_t *operation, const uint8_t *mac, size_t mac_length)</div><div class="ttdoc">Finish the calculation of the MAC of a message and compare it with an expected value. </div></div>
<div class="ttc" id="group__attributes_html_gaf61683ac87f87687a40262b5afbfa018"><div class="ttname"><a href="group__attributes.html#gaf61683ac87f87687a40262b5afbfa018">psa_set_key_bits</a></div><div class="ttdeci">static void psa_set_key_bits(psa_key_attributes_t *attributes, size_t bits)</div><div class="ttdoc">Declare the size of a key. </div></div>
<div class="ttc" id="structpsa__cipher__operation__s_html"><div class="ttname"><a href="structpsa__cipher__operation__s.html">psa_cipher_operation_s</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_a_r_g_e_t___m_b_e_d___p_s_a___s_r_v_2mbedtls_2crypto__struct_8h_source.html#l00165">TARGET_MBED_PSA_SRV/mbedtls/crypto_struct.h:165</a></div></div>
<div class="ttc" id="group__import__export_html_gaf22ae73312217aaede2ea02cdebb6062"><div class="ttname"><a href="group__import__export.html#gaf22ae73312217aaede2ea02cdebb6062">psa_export_public_key</a></div><div class="ttdeci">psa_status_t psa_export_public_key(mbedtls_svc_key_id_t key, uint8_t *data, size_t data_size, size_t *data_length)</div><div class="ttdoc">Export a public key or the public part of a key pair in binary format. </div></div>
<div class="ttc" id="group__cipher_html_ga61f02fbfa681c2659546eca52277dbf1"><div class="ttname"><a href="group__cipher.html#ga61f02fbfa681c2659546eca52277dbf1">psa_cipher_encrypt</a></div><div class="ttdeci">psa_status_t psa_cipher_encrypt(mbedtls_svc_key_id_t key, psa_algorithm_t alg, const uint8_t *input, size_t input_length, uint8_t *output, size_t output_size, size_t *output_length)</div><div class="ttdoc">Encrypt a message using a symmetric cipher. </div></div>
<div class="ttc" id="group___m_a_c_html_gacd8dd54855ba1bc0a03f104f252884fd"><div class="ttname"><a href="group___m_a_c.html#gacd8dd54855ba1bc0a03f104f252884fd">psa_mac_abort</a></div><div class="ttdeci">psa_status_t psa_mac_abort(psa_mac_operation_t *operation)</div><div class="ttdoc">Abort a MAC operation. </div></div>
<div class="ttc" id="group__derivation_html_gaac4eeacd36596c548b3a48fc06c5048b"><div class="ttname"><a href="group__derivation.html#gaac4eeacd36596c548b3a48fc06c5048b">psa_key_derivation_step_t</a></div><div class="ttdeci">uint16_t psa_key_derivation_step_t</div><div class="ttdoc">Encoding of the step of a key derivation. </div><div class="ttdef"><b>Definition:</b> <a href="_t_a_r_g_e_t___m_b_e_d___p_s_a___s_r_v_2inc_2psa_2crypto__types_8h_source.html#l00391">TARGET_MBED_PSA_SRV/inc/psa/crypto_types.h:391</a></div></div>
<div class="ttc" id="group__import__export_html_ga668e35be8d2852ad3feeef74ac6f75bf"><div class="ttname"><a href="group__import__export.html#ga668e35be8d2852ad3feeef74ac6f75bf">psa_export_key</a></div><div class="ttdeci">psa_status_t psa_export_key(mbedtls_svc_key_id_t key, uint8_t *data, size_t data_size, size_t *data_length)</div><div class="ttdoc">Export a key in binary format. </div></div>
<div class="ttc" id="group__key__lifetimes_html_ga11e986351c65bd3dc3c0fe2cd9926e4b"><div class="ttname"><a href="group__key__lifetimes.html#ga11e986351c65bd3dc3c0fe2cd9926e4b">psa_key_id_t</a></div><div class="ttdeci">uint32_t psa_key_id_t</div><div class="ttdoc">Encoding of identifiers of persistent keys. </div><div class="ttdef"><b>Definition:</b> <a href="_t_a_r_g_e_t___m_b_e_d___p_s_a___s_r_v_2inc_2psa_2crypto__types_8h_source.html#l00231">TARGET_MBED_PSA_SRV/inc/psa/crypto_types.h:231</a></div></div>
<div class="ttc" id="group__hash_html_gac69f7f19d96a56c28cf3799d11b12156"><div class="ttname"><a href="group__hash.html#gac69f7f19d96a56c28cf3799d11b12156">psa_hash_compute</a></div><div class="ttdeci">psa_status_t psa_hash_compute(psa_algorithm_t alg, const uint8_t *input, size_t input_length, uint8_t *hash, size_t hash_size, size_t *hash_length)</div><div class="ttdoc">Calculate the hash (digest) of a message. </div></div>
<div class="ttc" id="group__attributes_html_gac255da850a00bbed925390044f016b34"><div class="ttname"><a href="group__attributes.html#gac255da850a00bbed925390044f016b34">psa_get_key_algorithm</a></div><div class="ttdeci">static psa_algorithm_t psa_get_key_algorithm(const psa_key_attributes_t *attributes)</div><div class="ttdoc">Retrieve the algorithm policy from key attributes. </div></div>
<div class="ttc" id="group__attributes_html_ga42a65b3c4522ce9b67ea5ea7720e17de"><div class="ttname"><a href="group__attributes.html#ga42a65b3c4522ce9b67ea5ea7720e17de">psa_set_key_usage_flags</a></div><div class="ttdeci">static void psa_set_key_usage_flags(psa_key_attributes_t *attributes, psa_key_usage_t usage_flags)</div><div class="ttdoc">Declare usage flags for a key. </div></div>
<div class="ttc" id="group__hash_html_ga65b16ef97d7f650899b7db4b7d1112ff"><div class="ttname"><a href="group__hash.html#ga65b16ef97d7f650899b7db4b7d1112ff">psa_hash_update</a></div><div class="ttdeci">psa_status_t psa_hash_update(psa_hash_operation_t *operation, const uint8_t *input, size_t input_length)</div><div class="ttdoc">Add a message fragment to a multipart hash operation. </div></div>
<div class="ttc" id="group__attributes_html_gac03ccf09ca6d36cc3d5b43f8303db6f7"><div class="ttname"><a href="group__attributes.html#gac03ccf09ca6d36cc3d5b43f8303db6f7">psa_set_key_lifetime</a></div><div class="ttdeci">static void psa_set_key_lifetime(psa_key_attributes_t *attributes, psa_key_lifetime_t lifetime)</div><div class="ttdoc">Set the location of a persistent key. </div></div>
<div class="ttc" id="group__hash_html_ga616458d010d961df3f41049ed38e51b9"><div class="ttname"><a href="group__hash.html#ga616458d010d961df3f41049ed38e51b9">psa_hash_operation_init</a></div><div class="ttdeci">static psa_hash_operation_t psa_hash_operation_init(void)</div><div class="ttdoc">Return an initial value for a hash operation object. </div></div>
<div class="ttc" id="group__key__derivation_html_ga165dda1ad80a10730cb538069d4cc7aa"><div class="ttname"><a href="group__key__derivation.html#ga165dda1ad80a10730cb538069d4cc7aa">psa_raw_key_agreement</a></div><div class="ttdeci">psa_status_t psa_raw_key_agreement(psa_algorithm_t alg, mbedtls_svc_key_id_t private_key, const uint8_t *peer_key, size_t peer_key_length, uint8_t *output, size_t output_size, size_t *output_length)</div><div class="ttdoc">Perform a key agreement and return the raw shared secret. </div></div>
<div class="ttc" id="group__aead_html_ga59132751a6f843d038924cb217b5e13b"><div class="ttname"><a href="group__aead.html#ga59132751a6f843d038924cb217b5e13b">psa_aead_set_nonce</a></div><div class="ttdeci">psa_status_t psa_aead_set_nonce(psa_aead_operation_t *operation, const uint8_t *nonce, size_t nonce_length)</div><div class="ttdoc">Set the nonce for an authenticated encryption or decryption operation. </div></div>
<div class="ttc" id="group__attributes_html_ga9ea8eae1b81e480cc56dec858859aff9"><div class="ttname"><a href="group__attributes.html#ga9ea8eae1b81e480cc56dec858859aff9">psa_get_key_lifetime</a></div><div class="ttdeci">static psa_key_lifetime_t psa_get_key_lifetime(const psa_key_attributes_t *attributes)</div><div class="ttdoc">Retrieve the lifetime from key attributes. </div></div>
<div class="ttc" id="group__key__derivation_html_ga9b0b6769491b25e0592fce0f1c96f842"><div class="ttname"><a href="group__key__derivation.html#ga9b0b6769491b25e0592fce0f1c96f842">psa_key_derivation_get_capacity</a></div><div class="ttdeci">psa_status_t psa_key_derivation_get_capacity(const psa_key_derivation_operation_t *operation, size_t *capacity)</div><div class="ttdoc">Retrieve the current capacity of a key derivation operation. </div></div>
<div class="ttc" id="group___m_a_c_html_gabf02ebd3595ea15436967092b5d52878"><div class="ttname"><a href="group___m_a_c.html#gabf02ebd3595ea15436967092b5d52878">psa_mac_compute</a></div><div class="ttdeci">psa_status_t psa_mac_compute(mbedtls_svc_key_id_t key, psa_algorithm_t alg, const uint8_t *input, size_t input_length, uint8_t *mac, size_t mac_size, size_t *mac_length)</div><div class="ttdoc">Calculate the MAC (message authentication code) of a message. </div></div>
<div class="ttc" id="group__attributes_html_ga6857ef0ecb3fa844d4536939d9c64025"><div class="ttname"><a href="group__attributes.html#ga6857ef0ecb3fa844d4536939d9c64025">psa_set_key_type</a></div><div class="ttdeci">static void psa_set_key_type(psa_key_attributes_t *attributes, psa_key_type_t type)</div><div class="ttdoc">Declare the type of a key. </div></div>
<div class="ttc" id="group__aead_html_ga759791bbe1763b377c3b5447641f1fc8"><div class="ttname"><a href="group__aead.html#ga759791bbe1763b377c3b5447641f1fc8">psa_aead_finish</a></div><div class="ttdeci">psa_status_t psa_aead_finish(psa_aead_operation_t *operation, uint8_t *ciphertext, size_t ciphertext_size, size_t *ciphertext_length, uint8_t *tag, size_t tag_size, size_t *tag_length)</div><div class="ttdoc">Finish encrypting a message in an AEAD operation. </div></div>
<div class="ttc" id="group__attributes_html_gae48fcfdc72a23e7499957d7f54ff5a64"><div class="ttname"><a href="group__attributes.html#gae48fcfdc72a23e7499957d7f54ff5a64">psa_set_key_id</a></div><div class="ttdeci">static void psa_set_key_id(psa_key_attributes_t *attributes, mbedtls_svc_key_id_t key)</div><div class="ttdoc">Declare a key as persistent and set its key identifier. </div></div>
<div class="ttc" id="structpsa__key__derivation__s_html"><div class="ttname"><a href="structpsa__key__derivation__s.html">psa_key_derivation_s</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_a_r_g_e_t___m_b_e_d___p_s_a___s_r_v_2mbedtls_2crypto__struct_8h_source.html#l00265">TARGET_MBED_PSA_SRV/mbedtls/crypto_struct.h:265</a></div></div>
<div class="ttc" id="group__attributes_html_ga5bee85c2164ad3d4c0d42501241eeb06"><div class="ttname"><a href="group__attributes.html#ga5bee85c2164ad3d4c0d42501241eeb06">psa_get_key_bits</a></div><div class="ttdeci">static size_t psa_get_key_bits(const psa_key_attributes_t *attributes)</div><div class="ttdoc">Retrieve the key size from key attributes. </div></div>
<div class="ttc" id="group__asymmetric_html_ga4f968756f6b22aab362b598b202d83d7"><div class="ttname"><a href="group__asymmetric.html#ga4f968756f6b22aab362b598b202d83d7">psa_asymmetric_decrypt</a></div><div class="ttdeci">psa_status_t psa_asymmetric_decrypt(mbedtls_svc_key_id_t key, psa_algorithm_t alg, const uint8_t *input, size_t input_length, const uint8_t *salt, size_t salt_length, uint8_t *output, size_t output_size, size_t *output_length)</div><div class="ttdoc">Decrypt a short message with a private key. </div></div>
<div class="ttc" id="group__cipher_html_ga1dcb58b8befe23f8a4d7a1d49c99249b"><div class="ttname"><a href="group__cipher.html#ga1dcb58b8befe23f8a4d7a1d49c99249b">psa_cipher_finish</a></div><div class="ttdeci">psa_status_t psa_cipher_finish(psa_cipher_operation_t *operation, uint8_t *output, size_t output_size, size_t *output_length)</div><div class="ttdoc">Finish encrypting or decrypting a message in a cipher operation. </div></div>
<div class="ttc" id="structpsa__hash__operation__s_html"><div class="ttname"><a href="structpsa__hash__operation__s.html">psa_hash_operation_s</a></div><div class="ttdef"><b>Definition:</b> <a href="_t_a_r_g_e_t___m_b_e_d___p_s_a___s_r_v_2mbedtls_2crypto__struct_8h_source.html#l00090">TARGET_MBED_PSA_SRV/mbedtls/crypto_struct.h:90</a></div></div>
<div class="ttc" id="group__aead_html_ga6d0eed03f832e5c9c91cb8adf2882569"><div class="ttname"><a href="group__aead.html#ga6d0eed03f832e5c9c91cb8adf2882569">psa_aead_update_ad</a></div><div class="ttdeci">psa_status_t psa_aead_update_ad(psa_aead_operation_t *operation, const uint8_t *input, size_t input_length)</div><div class="ttdoc">Pass additional data to an active AEAD operation. </div></div>
<div class="ttc" id="group__hash_html_ga7be923c5700c9c70ef77ee9b76d1a5c0"><div class="ttname"><a href="group__hash.html#ga7be923c5700c9c70ef77ee9b76d1a5c0">psa_hash_verify</a></div><div class="ttdeci">psa_status_t psa_hash_verify(psa_hash_operation_t *operation, const uint8_t *hash, size_t hash_length)</div><div class="ttdoc">Finish the calculation of the hash of a message and compare it with an expected value. </div></div>
<div class="ttc" id="group__aead_html_gad3431e28d05002c2a7b0760610176050"><div class="ttname"><a href="group__aead.html#gad3431e28d05002c2a7b0760610176050">psa_aead_set_lengths</a></div><div class="ttdeci">psa_status_t psa_aead_set_lengths(psa_aead_operation_t *operation, size_t ad_length, size_t plaintext_length)</div><div class="ttdoc">Declare the lengths of the message and additional data for AEAD. </div></div>
<div class="ttc" id="group___m_a_c_html_ga03bc3e3c0b7e55b20d2a238e418d46cd"><div class="ttname"><a href="group___m_a_c.html#ga03bc3e3c0b7e55b20d2a238e418d46cd">psa_mac_sign_setup</a></div><div class="ttdeci">psa_status_t psa_mac_sign_setup(psa_mac_operation_t *operation, mbedtls_svc_key_id_t key, psa_algorithm_t alg)</div><div class="ttdoc">Set up a multipart MAC calculation operation. </div></div>
<div class="ttc" id="group__asymmetric_html_gae2ffbf01e5266391aff22b101a49f5f5"><div class="ttname"><a href="group__asymmetric.html#gae2ffbf01e5266391aff22b101a49f5f5">psa_verify_hash</a></div><div class="ttdeci">psa_status_t psa_verify_hash(mbedtls_svc_key_id_t key, psa_algorithm_t alg, const uint8_t *hash, size_t hash_length, const uint8_t *signature, size_t signature_length)</div><div class="ttdoc">Verify the signature a hash or short message using a public key. </div></div>
<div class="ttc" id="group__asymmetric_html_ga785e746a31a7b2a35ae5175c5ace3c5c"><div class="ttname"><a href="group__asymmetric.html#ga785e746a31a7b2a35ae5175c5ace3c5c">psa_sign_hash</a></div><div class="ttdeci">psa_status_t psa_sign_hash(mbedtls_svc_key_id_t key, psa_algorithm_t alg, const uint8_t *hash, size_t hash_length, uint8_t *signature, size_t signature_size, size_t *signature_length)</div><div class="ttdoc">Sign a hash or short message with a private key. </div></div>
<div class="ttc" id="group__hash_html_ga39673348f3302b4646bd780034a5aeda"><div class="ttname"><a href="group__hash.html#ga39673348f3302b4646bd780034a5aeda">psa_hash_clone</a></div><div class="ttdeci">psa_status_t psa_hash_clone(const psa_hash_operation_t *source_operation, psa_hash_operation_t *target_operation)</div><div class="ttdoc">Clone a hash operation. </div></div>
<div class="ttc" id="group__random_html_ga1f154687b24e5508d97681cdd17946a8"><div class="ttname"><a href="group__random.html#ga1f154687b24e5508d97681cdd17946a8">psa_generate_key</a></div><div class="ttdeci">psa_status_t psa_generate_key(const psa_key_attributes_t *attributes, mbedtls_svc_key_id_t *key)</div><div class="ttdoc">Generate a key or key pair. </div></div>
<div class="ttc" id="group__key__management_html_gaac27a547ca634d439e89b17aacc99943"><div class="ttname"><a href="group__key__management.html#gaac27a547ca634d439e89b17aacc99943">psa_copy_key</a></div><div class="ttdeci">psa_status_t psa_copy_key(mbedtls_svc_key_id_t source_key, const psa_key_attributes_t *attributes, mbedtls_svc_key_id_t *target_key)</div><div class="ttdoc">Make a copy of a key. </div></div>
<div class="ttc" id="group__attributes_html_gacbbf5c11eac6cd70c87ffb936e1b9be2"><div class="ttname"><a href="group__attributes.html#gacbbf5c11eac6cd70c87ffb936e1b9be2">psa_get_key_attributes</a></div><div class="ttdeci">psa_status_t psa_get_key_attributes(mbedtls_svc_key_id_t key, psa_key_attributes_t *attributes)</div><div class="ttdoc">Retrieve the attributes of a key. </div></div>
<div class="ttc" id="group__key__derivation_html_ga2cd5a8ac906747d3204ec442db78745f"><div class="ttname"><a href="group__key__derivation.html#ga2cd5a8ac906747d3204ec442db78745f">psa_key_derivation_key_agreement</a></div><div class="ttdeci">psa_status_t psa_key_derivation_key_agreement(psa_key_derivation_operation_t *operation, psa_key_derivation_step_t step, mbedtls_svc_key_id_t private_key, const uint8_t *peer_key, size_t peer_key_length)</div><div class="ttdoc">Perform a key agreement and use the shared secret as input to a key derivation. </div></div>
<div class="ttc" id="group__crypto__types_html_gac2e4d47f1300d73c2f829a6d99252d69"><div class="ttname"><a href="group__crypto__types.html#gac2e4d47f1300d73c2f829a6d99252d69">psa_algorithm_t</a></div><div class="ttdeci">uint32_t psa_algorithm_t</div><div class="ttdoc">Encoding of a cryptographic algorithm. </div><div class="ttdef"><b>Definition:</b> <a href="_t_a_r_g_e_t___m_b_e_d___p_s_a___s_r_v_2inc_2psa_2crypto__types_8h_source.html#l00098">TARGET_MBED_PSA_SRV/inc/psa/crypto_types.h:98</a></div></div>
<div class="ttc" id="group__cipher_html_ga9caddac1a429a5032d6d4a907fb70ba1"><div class="ttname"><a href="group__cipher.html#ga9caddac1a429a5032d6d4a907fb70ba1">psa_cipher_set_iv</a></div><div class="ttdeci">psa_status_t psa_cipher_set_iv(psa_cipher_operation_t *operation, const uint8_t *iv, size_t iv_length)</div><div class="ttdoc">Set the IV for a symmetric encryption or decryption operation. </div></div>
<div class="ttc" id="group__aead_html_ga5799df1c555efd35970b65be51cb07d1"><div class="ttname"><a href="group__aead.html#ga5799df1c555efd35970b65be51cb07d1">psa_aead_generate_nonce</a></div><div class="ttdeci">psa_status_t psa_aead_generate_nonce(psa_aead_operation_t *operation, uint8_t *nonce, size_t nonce_size, size_t *nonce_length)</div><div class="ttdoc">Generate a random nonce for an authenticated encryption operation. </div></div>
<div class="ttc" id="group__cipher_html_gab3593f5f14d8c0431dd306d80929215e"><div class="ttname"><a href="group__cipher.html#gab3593f5f14d8c0431dd306d80929215e">psa_cipher_decrypt</a></div><div class="ttdeci">psa_status_t psa_cipher_decrypt(mbedtls_svc_key_id_t key, psa_algorithm_t alg, const uint8_t *input, size_t input_length, uint8_t *output, size_t output_size, size_t *output_length)</div><div class="ttdoc">Decrypt a message using a symmetric cipher. </div></div>
<div class="ttc" id="group__cipher_html_ga0e2a249d48ab4d4d9ef716d02e370ef9"><div class="ttname"><a href="group__cipher.html#ga0e2a249d48ab4d4d9ef716d02e370ef9">psa_cipher_operation_init</a></div><div class="ttdeci">static psa_cipher_operation_t psa_cipher_operation_init(void)</div><div class="ttdoc">Return an initial value for a cipher operation object. </div></div>
<div class="ttc" id="group__hash_html_ga8d72896cf70fc4d514c5c6b978912515"><div class="ttname"><a href="group__hash.html#ga8d72896cf70fc4d514c5c6b978912515">psa_hash_setup</a></div><div class="ttdeci">psa_status_t psa_hash_setup(psa_hash_operation_t *operation, psa_algorithm_t alg)</div><div class="ttdoc">Set up a multipart hash operation. </div></div>
<div class="ttc" id="group__cipher_html_ga29fd7d32a5729226a2f73e7b6487bd8a"><div class="ttname"><a href="group__cipher.html#ga29fd7d32a5729226a2f73e7b6487bd8a">psa_cipher_generate_iv</a></div><div class="ttdeci">psa_status_t psa_cipher_generate_iv(psa_cipher_operation_t *operation, uint8_t *iv, size_t iv_size, size_t *iv_length)</div><div class="ttdoc">Generate an IV for a symmetric encryption operation. </div></div>
<div class="ttc" id="group__policy_html_ga7bb9de71337e0e98de843aa7f9b55f25"><div class="ttname"><a href="group__policy.html#ga7bb9de71337e0e98de843aa7f9b55f25">psa_key_usage_t</a></div><div class="ttdeci">uint32_t psa_key_usage_t</div><div class="ttdoc">Encoding of permitted usage on a key. </div><div class="ttdef"><b>Definition:</b> <a href="_t_a_r_g_e_t___m_b_e_d___p_s_a___s_r_v_2inc_2psa_2crypto__types_8h_source.html#l00257">TARGET_MBED_PSA_SRV/inc/psa/crypto_types.h:257</a></div></div>
<div class="ttc" id="group__attributes_html_gaeb8341ca52baa0279475ea3fd3bcdc98"><div class="ttname"><a href="group__attributes.html#gaeb8341ca52baa0279475ea3fd3bcdc98">psa_set_key_algorithm</a></div><div class="ttdeci">static void psa_set_key_algorithm(psa_key_attributes_t *attributes, psa_algorithm_t alg)</div><div class="ttdoc">Declare the permitted algorithm policy for a key. </div></div>
<div class="ttc" id="group__crypto__types_html_ga63fce6880ca5933b5d6baa257febf1f6"><div class="ttname"><a href="group__crypto__types.html#ga63fce6880ca5933b5d6baa257febf1f6">psa_key_type_t</a></div><div class="ttdeci">uint16_t psa_key_type_t</div><div class="ttdoc">Encoding of a key type. </div><div class="ttdef"><b>Definition:</b> <a href="_t_a_r_g_e_t___m_b_e_d___p_s_a___s_r_v_2inc_2psa_2crypto__types_8h_source.html#l00066">TARGET_MBED_PSA_SRV/inc/psa/crypto_types.h:66</a></div></div>
<div class="ttc" id="group__initialization_html_ga2de150803fc2f7dc6101d5af7e921dd9"><div class="ttname"><a href="group__initialization.html#ga2de150803fc2f7dc6101d5af7e921dd9">psa_crypto_init</a></div><div class="ttdeci">psa_status_t psa_crypto_init(void)</div><div class="ttdoc">Library initialization. </div></div>
<div class="ttc" id="group__key__derivation_html_ga06b7eb34a2fa88965f68e3d023fa12b9"><div class="ttname"><a href="group__key__derivation.html#ga06b7eb34a2fa88965f68e3d023fa12b9">psa_key_derivation_output_bytes</a></div><div class="ttdeci">psa_status_t psa_key_derivation_output_bytes(psa_key_derivation_operation_t *operation, uint8_t *output, size_t output_length)</div><div class="ttdoc">Read some data from a key derivation operation. </div></div>
<div class="ttc" id="group__aead_html_ga286b61e83f1bdd5017568c4fd1939f89"><div class="ttname"><a href="group__aead.html#ga286b61e83f1bdd5017568c4fd1939f89">psa_aead_operation_init</a></div><div class="ttdeci">static psa_aead_operation_t psa_aead_operation_init(void)</div><div class="ttdoc">Return an initial value for an AEAD operation object. </div></div>
<div class="ttc" id="group__key__derivation_html_ga8fd934dfb0ca45cbf89542ef2a5494c2"><div class="ttname"><a href="group__key__derivation.html#ga8fd934dfb0ca45cbf89542ef2a5494c2">psa_key_derivation_input_bytes</a></div><div class="ttdeci">psa_status_t psa_key_derivation_input_bytes(psa_key_derivation_operation_t *operation, psa_key_derivation_step_t step, const uint8_t *data, size_t data_length)</div><div class="ttdoc">Provide an input for key derivation or key agreement. </div></div>
<div class="ttc" id="group__attributes_html_gae4fb812af4f57aa1ad85e335a865b918"><div class="ttname"><a href="group__attributes.html#gae4fb812af4f57aa1ad85e335a865b918">psa_get_key_type</a></div><div class="ttdeci">static psa_key_type_t psa_get_key_type(const psa_key_attributes_t *attributes)</div><div class="ttdoc">Retrieve the key type from key attributes. </div></div>
<div class="ttc" id="group__aead_html_gae0280e2e61a185b893c36d858453f0d0"><div class="ttname"><a href="group__aead.html#gae0280e2e61a185b893c36d858453f0d0">psa_aead_verify</a></div><div class="ttdeci">psa_status_t psa_aead_verify(psa_aead_operation_t *operation, uint8_t *plaintext, size_t plaintext_size, size_t *plaintext_length, const uint8_t *tag, size_t tag_length)</div><div class="ttdoc">Finish authenticating and decrypting a message in an AEAD operation. </div></div>
<div class="ttc" id="group__attributes_html_gaa1af20f142ca722222c6d98678a0c448"><div class="ttname"><a href="group__attributes.html#gaa1af20f142ca722222c6d98678a0c448">psa_get_key_usage_flags</a></div><div class="ttdeci">static psa_key_usage_t psa_get_key_usage_flags(const psa_key_attributes_t *attributes)</div><div class="ttdoc">Retrieve the usage flags from key attributes. </div></div>
<div class="ttc" id="group__key__derivation_html_gab2d7ce8705dd8e4a093f4b8a21a0c15a"><div class="ttname"><a href="group__key__derivation.html#gab2d7ce8705dd8e4a093f4b8a21a0c15a">psa_key_derivation_input_key</a></div><div class="ttdeci">psa_status_t psa_key_derivation_input_key(psa_key_derivation_operation_t *operation, psa_key_derivation_step_t step, mbedtls_svc_key_id_t key)</div><div class="ttdoc">Provide an input for key derivation in the form of a key. </div></div>
<div class="ttc" id="group__import__export_html_ga0336ea76bf30587ab204a8296462327b"><div class="ttname"><a href="group__import__export.html#ga0336ea76bf30587ab204a8296462327b">psa_import_key</a></div><div class="ttdeci">psa_status_t psa_import_key(const psa_key_attributes_t *attributes, const uint8_t *data, size_t data_length, mbedtls_svc_key_id_t *key)</div><div class="ttdoc">Import a key in binary format. </div></div>
<div class="ttc" id="group__hash_html_gab0b4d5f9912a615559497a467b532928"><div class="ttname"><a href="group__hash.html#gab0b4d5f9912a615559497a467b532928">psa_hash_abort</a></div><div class="ttdeci">psa_status_t psa_hash_abort(psa_hash_operation_t *operation)</div><div class="ttdoc">Abort a hash operation. </div></div>
<div class="ttc" id="group__attributes_html_ga06966a8812aacd323ccdf06dbb43667d"><div class="ttname"><a href="group__attributes.html#ga06966a8812aacd323ccdf06dbb43667d">psa_key_attributes_init</a></div><div class="ttdeci">static psa_key_attributes_t psa_key_attributes_init(void)</div><div class="ttdoc">Return an initial value for a key attributes structure. </div></div>
<div class="ttc" id="group__aead_html_gae799f6196a22d50c216c947e0320d3ba"><div class="ttname"><a href="group__aead.html#gae799f6196a22d50c216c947e0320d3ba">psa_aead_decrypt</a></div><div class="ttdeci">psa_status_t psa_aead_decrypt(mbedtls_svc_key_id_t key, psa_algorithm_t alg, const uint8_t *nonce, size_t nonce_length, const uint8_t *additional_data, size_t additional_data_length, const uint8_t *ciphertext, size_t ciphertext_length, uint8_t *plaintext, size_t plaintext_size, size_t *plaintext_length)</div><div class="ttdoc">Process an authenticated decryption operation. </div></div>
<div class="ttc" id="group__key__management_html_ga5f52644312291335682fbc0292c43cd2"><div class="ttname"><a href="group__key__management.html#ga5f52644312291335682fbc0292c43cd2">psa_destroy_key</a></div><div class="ttdeci">psa_status_t psa_destroy_key(mbedtls_svc_key_id_t key)</div><div class="ttdoc">Destroy a key. </div></div>
<div class="ttc" id="group__aead_html_gaaa5c5018e67a7a6514b7e76b9a14de26"><div class="ttname"><a href="group__aead.html#gaaa5c5018e67a7a6514b7e76b9a14de26">psa_aead_decrypt_setup</a></div><div class="ttdeci">psa_status_t psa_aead_decrypt_setup(psa_aead_operation_t *operation, mbedtls_svc_key_id_t key, psa_algorithm_t alg)</div><div class="ttdoc">Set the key for a multipart authenticated decryption operation. </div></div>
<div class="ttc" id="group__key__management_html_gac161d9a354209b0bdaf1f302bf4619d3"><div class="ttname"><a href="group__key__management.html#gac161d9a354209b0bdaf1f302bf4619d3">psa_open_key</a></div><div class="ttdeci">psa_status_t psa_open_key(psa_key_id_t id, psa_key_handle_t *handle)</div><div class="ttdoc">Open a handle to an existing persistent key. </div></div>
<div class="ttc" id="group__key__derivation_html_gac0b6a76e45cceb1862752bf041701859"><div class="ttname"><a href="group__key__derivation.html#gac0b6a76e45cceb1862752bf041701859">psa_key_derivation_setup</a></div><div class="ttdeci">psa_status_t psa_key_derivation_setup(psa_key_derivation_operation_t *operation, psa_algorithm_t alg)</div><div class="ttdoc">Set up a key derivation operation. </div></div>
<div class="ttc" id="group__attributes_html_gafd8a339ef75f9ec0f72c97edfc99a2a4"><div class="ttname"><a href="group__attributes.html#gafd8a339ef75f9ec0f72c97edfc99a2a4">psa_get_key_id</a></div><div class="ttdeci">static mbedtls_svc_key_id_t psa_get_key_id(const psa_key_attributes_t *attributes)</div><div class="ttdoc">Retrieve the key identifier from key attributes. </div></div>
<div class="ttc" id="group__aead_html_gae8a5f93d92318c8f592ee9fbb9d36ba0"><div class="ttname"><a href="group__aead.html#gae8a5f93d92318c8f592ee9fbb9d36ba0">psa_aead_abort</a></div><div class="ttdeci">psa_status_t psa_aead_abort(psa_aead_operation_t *operation)</div><div class="ttdoc">Abort an AEAD operation. </div></div>
<div class="ttc" id="group__aead_html_gaf6d49864951ca42136b4a9b71ea26e5c"><div class="ttname"><a href="group__aead.html#gaf6d49864951ca42136b4a9b71ea26e5c">psa_aead_update</a></div><div class="ttdeci">psa_status_t psa_aead_update(psa_aead_operation_t *operation, const uint8_t *input, size_t input_length, uint8_t *output, size_t output_size, size_t *output_length)</div><div class="ttdoc">Encrypt or decrypt a message fragment in an active AEAD operation. </div></div>
<div class="ttc" id="group__aead_html_gae72e1eb3c2da3ebd843bb9c8db8df509"><div class="ttname"><a href="group__aead.html#gae72e1eb3c2da3ebd843bb9c8db8df509">psa_aead_encrypt</a></div><div class="ttdeci">psa_status_t psa_aead_encrypt(mbedtls_svc_key_id_t key, psa_algorithm_t alg, const uint8_t *nonce, size_t nonce_length, const uint8_t *additional_data, size_t additional_data_length, const uint8_t *plaintext, size_t plaintext_length, uint8_t *ciphertext, size_t ciphertext_size, size_t *ciphertext_length)</div><div class="ttdoc">Process an authenticated encryption operation. </div></div>
<div class="ttc" id="group__key__lifetimes_html_ga6821ff6dd39dc2bc370ded760ad8b0cf"><div class="ttname"><a href="group__key__lifetimes.html#ga6821ff6dd39dc2bc370ded760ad8b0cf">psa_key_lifetime_t</a></div><div class="ttdeci">uint32_t psa_key_lifetime_t</div><div class="ttdoc">Encoding of key lifetimes. </div><div class="ttdef"><b>Definition:</b> <a href="_t_a_r_g_e_t___m_b_e_d___p_s_a___s_r_v_2inc_2psa_2crypto__types_8h_source.html#l00141">TARGET_MBED_PSA_SRV/inc/psa/crypto_types.h:141</a></div></div>
<div class="ttc" id="group___m_a_c_html_gaf6988545df5d5e2466c34d753443b15a"><div class="ttname"><a href="group___m_a_c.html#gaf6988545df5d5e2466c34d753443b15a">psa_mac_verify</a></div><div class="ttdeci">psa_status_t psa_mac_verify(mbedtls_svc_key_id_t key, psa_algorithm_t alg, const uint8_t *input, size_t input_length, const uint8_t *mac, size_t mac_length)</div><div class="ttdoc">Calculate the MAC of a message and compare it with a reference value. </div></div>
<div class="ttc" id="group___m_a_c_html_ga49c821435fb16fb462403795eaefc867"><div class="ttname"><a href="group___m_a_c.html#ga49c821435fb16fb462403795eaefc867">psa_mac_operation_init</a></div><div class="ttdeci">static psa_mac_operation_t psa_mac_operation_init(void)</div><div class="ttdoc">Return an initial value for a MAC operation object. </div></div>
<div class="ttc" id="group__key__derivation_html_gada7a6e17222ea9e7a6be6864a00316e1"><div class="ttname"><a href="group__key__derivation.html#gada7a6e17222ea9e7a6be6864a00316e1">psa_key_derivation_output_key</a></div><div class="ttdeci">psa_status_t psa_key_derivation_output_key(const psa_key_attributes_t *attributes, psa_key_derivation_operation_t *operation, mbedtls_svc_key_id_t *key)</div><div class="ttdoc">Derive a key from an ongoing key derivation operation. </div></div>
<div class="ttc" id="group__error_html_ga05676e70ba5c6a7565aff3c36677c1f9"><div class="ttname"><a href="group__error.html#ga05676e70ba5c6a7565aff3c36677c1f9">psa_status_t</a></div><div class="ttdeci">int32_t psa_status_t</div><div class="ttdoc">Function return status. </div><div class="ttdef"><b>Definition:</b> <a href="_t_a_r_g_e_t___m_b_e_d___p_s_a___s_r_v_2inc_2psa_2crypto__types_8h_source.html#l00055">TARGET_MBED_PSA_SRV/inc/psa/crypto_types.h:55</a></div></div>
<div class="ttc" id="group___m_a_c_html_ga5560af371497babefe03c9da4e8a1c05"><div class="ttname"><a href="group___m_a_c.html#ga5560af371497babefe03c9da4e8a1c05">psa_mac_update</a></div><div class="ttdeci">psa_status_t psa_mac_update(psa_mac_operation_t *operation, const uint8_t *input, size_t input_length)</div><div class="ttdoc">Add a message fragment to a multipart MAC operation. </div></div>
<div class="ttc" id="group__cipher_html_gaad482cdca2098bca0620596aaa02eaa4"><div class="ttname"><a href="group__cipher.html#gaad482cdca2098bca0620596aaa02eaa4">psa_cipher_abort</a></div><div class="ttdeci">psa_status_t psa_cipher_abort(psa_cipher_operation_t *operation)</div><div class="ttdoc">Abort a cipher operation. </div></div>
<div class="ttc" id="group__hash_html_ga0c08f4797bec96b886c8c8d7acc2a553"><div class="ttname"><a href="group__hash.html#ga0c08f4797bec96b886c8c8d7acc2a553">psa_hash_compare</a></div><div class="ttdeci">psa_status_t psa_hash_compare(psa_algorithm_t alg, const uint8_t *input, size_t input_length, const uint8_t *hash, size_t hash_length)</div><div class="ttdoc">Calculate the hash (digest) of a message and compare it with a reference value. </div></div>
<div class="ttc" id="group___m_a_c_html_ga08ae327fcbc5f8e201172fe11e536984"><div class="ttname"><a href="group___m_a_c.html#ga08ae327fcbc5f8e201172fe11e536984">psa_mac_verify_setup</a></div><div class="ttdeci">psa_status_t psa_mac_verify_setup(psa_mac_operation_t *operation, mbedtls_svc_key_id_t key, psa_algorithm_t alg)</div><div class="ttdoc">Set up a multipart MAC verification operation. </div></div>
<div class="ttc" id="group__hash_html_ga4795fd06a0067b0adcd92e9627b8c97e"><div class="ttname"><a href="group__hash.html#ga4795fd06a0067b0adcd92e9627b8c97e">psa_hash_finish</a></div><div class="ttdeci">psa_status_t psa_hash_finish(psa_hash_operation_t *operation, uint8_t *hash, size_t hash_size, size_t *hash_length)</div><div class="ttdoc">Finish the calculation of the hash of a message. </div></div>
</div><!-- fragment --></div><!-- contents -->
        
    


        
<footer class="global-footer">
    <ul class="global-footer-media global-footer-row">
        <li>
            <a class="footer-media-icon" title="Twitter" href="https://twitter.com/ArmSoftwareDev">
                <span class="fab fa-twitter-square fa-2x"></span>
                <span class="global-footer-show-on-large-screens">Twitter</span>
            </a>
        </li>
        <li>
            <a class="footer-media-icon" title="YouTube" href="https://www.youtube.com/c/ArmSoftwareDevelopers">
                <span class="fab fa-youtube-square fa-2x"></span>
                <span class="global-footer-show-on-large-screens">YouTube</span>
            </a>
        </li>
        <li>
            <a class="footer-media-icon" title="Forum" href="http://forums.mbed.com/">
                <span class="fas fa-comments fa-2x"></span>
                <span class="global-footer-show-on-large-screens">Forum</span>
            </a>
        </li>
        <li>
            <a class="footer-media-icon" title="Blog" href="http://blog.mbed.com/">
                <span class="fas fa-pen-square fa-2x"></span>
                <span class="global-footer-show-on-large-screens">Blog</span>
            </a>
        </li>
    </ul>

    <div class="global-footer-copyright global-footer-row">
        <div class="copyright-statement">Copyright © <script>document.write(new Date().getFullYear());</script> Arm Limited (or its affiliates).</div>
        <ul class="copyright-links">
            <li><a href="https://os.mbed.com/">Home</a></li>
            <li><a href="https://www.arm.com/company/policies/terms-and-conditions">Website Terms</a></li>
            <li><a href="https://www.arm.com/company/policies/privacy">Privacy</a></li>
            <li><a href="https://www.arm.com/company/policies/cookies">Cookies</a></li>
            <li><a href="http://www.arm.com/company/policies/trademarks">Trademarks</a></li>
        </ul>
    </div>
</footer>



    <div id="cookiemodule">
    <h5>Important Information for this Arm website</h5>
    <div id="cookiecontent">
        <p>
            This site uses cookies to store information on your computer.
            By continuing to use our site, you consent to our cookies.
            If you are not happy with the use of these cookies, please review our
            <a href="https://www.arm.com/company/policies/cookies">Cookie Policy</a>
            to learn how they can be disabled.
            By disabling cookies, some features of the site will not work.
        </p>
        <button id="acceptcookie">Accept and hide this message</button>
    </div>
</div>
<script src="../../../../static/js/cookie_law.js"></script>




    </body>

<!-- Mirrored from os.mbed.com/docs/mbed-os/v6.16/mbed-os-api-doxy/_t_a_r_g_e_t___t_f_m_2_t_a_r_g_e_t___t_f_m___v1__0_2include_2psa_2crypto_8h_source.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 16 Sep 2024 15:22:29 GMT -->
</html>
